/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/monaco-yaml@5.1.1/yaml.worker.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{initialize}from"monaco-worker-manager/worker";import{TextDocument as TextDocument2}from"vscode-languageserver-textdocument";import*as Json2 from"jsonc-parser";import{URI}from"vscode-uri";function startsWith(e,t){if(e.length<t.length)return!1;for(var r=0;r<t.length;r++)if(e[r]!==t[r])return!1;return!0}function endsWith(e,t){var r=e.length-t.length;return r>0?e.lastIndexOf(t)===r:0===r&&e===t}function extendedRegExp(e){return startsWith(e,"(?i)")?new RegExp(e.substring(4),"i"):new RegExp(e)}import*as Json from"jsonc-parser";function equals(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(typeof e!=typeof t)return!1;if("object"!=typeof e)return!1;if(Array.isArray(e)!==Array.isArray(t))return!1;var r,n;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(!equals(e[r],t[r]))return!1}else{var i=[];for(n in e)i.push(n);i.sort();var o=[];for(n in t)o.push(n);if(o.sort(),!equals(i,o))return!1;for(r=0;r<i.length;r++)if(!equals(e[i[r]],t[i[r]]))return!1}return!0}function isNumber(e){return"number"==typeof e}function isDefined(e){return void 0!==e}function isBoolean(e){return"boolean"==typeof e}function isString(e){return"string"==typeof e}import{Range,Position,MarkupContent,MarkupKind,Color,ColorInformation,ColorPresentation,FoldingRange,FoldingRangeKind,SelectionRange,Diagnostic,DiagnosticSeverity,CompletionItem,CompletionItemKind,CompletionList,CompletionItemTag,InsertTextFormat,SymbolInformation,SymbolKind,DocumentSymbol,Location,Hover,MarkedString,CodeActionContext,Command,CodeAction,DocumentHighlight,DocumentLink,WorkspaceEdit,TextEdit,CodeActionKind,TextDocumentEdit,VersionedTextDocumentIdentifier,DocumentHighlightKind}from"vscode-languageserver-types";import{TextDocument}from"vscode-languageserver-textdocument";var ErrorCode,ClientCapabilities;function format(e,t){return 0===t.length?e:e.replace(/{(\d+)}/g,((e,[r])=>r in t?t[r]:e))}!function(e){e[e.Undefined=0]="Undefined",e[e.EnumValueMismatch=1]="EnumValueMismatch",e[e.Deprecated=2]="Deprecated",e[e.UnexpectedEndOfComment=257]="UnexpectedEndOfComment",e[e.UnexpectedEndOfString=258]="UnexpectedEndOfString",e[e.UnexpectedEndOfNumber=259]="UnexpectedEndOfNumber",e[e.InvalidUnicode=260]="InvalidUnicode",e[e.InvalidEscapeCharacter=261]="InvalidEscapeCharacter",e[e.InvalidCharacter=262]="InvalidCharacter",e[e.PropertyExpected=513]="PropertyExpected",e[e.CommaExpected=514]="CommaExpected",e[e.ColonExpected=515]="ColonExpected",e[e.ValueExpected=516]="ValueExpected",e[e.CommaOrCloseBacketExpected=517]="CommaOrCloseBacketExpected",e[e.CommaOrCloseBraceExpected=518]="CommaOrCloseBraceExpected",e[e.TrailingComma=519]="TrailingComma",e[e.DuplicateKey=520]="DuplicateKey",e[e.CommentNotPermitted=521]="CommentNotPermitted",e[e.SchemaResolveError=768]="SchemaResolveError"}(ErrorCode||(ErrorCode={})),(ClientCapabilities||(ClientCapabilities={})).LATEST={textDocument:{completion:{completionItem:{documentationFormat:[MarkupKind.Markdown,MarkupKind.PlainText],commitCharactersSupport:!0}}}};var localize=(e,t,...r)=>format(t,r);function loadMessageBundle(){return localize}var EnumMatch,__extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),localize2=loadMessageBundle(),formats={"color-hex":{errorMessage:localize2("colorHexFormatWarning","Invalid color format. Use #RGB, #RGBA, #RRGGBB or #RRGGBBAA."),pattern:/^#([0-9A-Fa-f]{3,4}|([0-9A-Fa-f]{2}){3,4})$/},"date-time":{errorMessage:localize2("dateTimeFormatWarning","String is not a RFC3339 date-time."),pattern:/^(\d{4})-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])T([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)([01][0-9]|2[0-3]):([0-5][0-9]))$/i},date:{errorMessage:localize2("dateFormatWarning","String is not a RFC3339 date."),pattern:/^(\d{4})-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/i},time:{errorMessage:localize2("timeFormatWarning","String is not a RFC3339 time."),pattern:/^([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)([01][0-9]|2[0-3]):([0-5][0-9]))$/i},email:{errorMessage:localize2("emailFormatWarning","String is not an e-mail address."),pattern:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/}},ASTNodeImpl=function(){function e(e,t,r){void 0===r&&(r=0),this.offset=t,this.length=r,this.parent=e}return Object.defineProperty(e.prototype,"children",{get:function(){return[]},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"type: "+this.type+" ("+this.offset+"/"+this.length+")"+(this.parent?" parent: {"+this.parent.toString()+"}":"")},e}(),NullASTNodeImpl=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.type="null",n.value=null,n}return __extends(t,e),t}(ASTNodeImpl),BooleanASTNodeImpl=function(e){function t(t,r,n){var i=e.call(this,t,n)||this;return i.type="boolean",i.value=r,i}return __extends(t,e),t}(ASTNodeImpl),ArrayASTNodeImpl=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.type="array",n.items=[],n}return __extends(t,e),Object.defineProperty(t.prototype,"children",{get:function(){return this.items},enumerable:!1,configurable:!0}),t}(ASTNodeImpl),NumberASTNodeImpl=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.type="number",n.isInteger=!0,n.value=Number.NaN,n}return __extends(t,e),t}(ASTNodeImpl),StringASTNodeImpl=function(e){function t(t,r,n){var i=e.call(this,t,r,n)||this;return i.type="string",i.value="",i}return __extends(t,e),t}(ASTNodeImpl),PropertyASTNodeImpl=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.type="property",i.colonOffset=-1,i.keyNode=n,i}return __extends(t,e),Object.defineProperty(t.prototype,"children",{get:function(){return this.valueNode?[this.keyNode,this.valueNode]:[this.keyNode]},enumerable:!1,configurable:!0}),t}(ASTNodeImpl),ObjectASTNodeImpl=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.type="object",n.properties=[],n}return __extends(t,e),Object.defineProperty(t.prototype,"children",{get:function(){return this.properties},enumerable:!1,configurable:!0}),t}(ASTNodeImpl);function asSchema(e){return isBoolean(e)?e?{}:{not:{}}:e}!function(e){e[e.Key=0]="Key",e[e.Enum=1]="Enum"}(EnumMatch||(EnumMatch={}));var SchemaCollector=function(){function e(e,t){void 0===e&&(e=-1),this.focusOffset=e,this.exclude=t,this.schemas=[]}return e.prototype.add=function(e){this.schemas.push(e)},e.prototype.merge=function(e){Array.prototype.push.apply(this.schemas,e.schemas)},e.prototype.include=function(e){return(-1===this.focusOffset||contains(e,this.focusOffset))&&e!==this.exclude},e.prototype.newSub=function(){return new e(-1,this.exclude)},e}(),NoOpSchemaCollector=function(){function e(){}return Object.defineProperty(e.prototype,"schemas",{get:function(){return[]},enumerable:!1,configurable:!0}),e.prototype.add=function(e){},e.prototype.merge=function(e){},e.prototype.include=function(e){return!0},e.prototype.newSub=function(){return this},e.instance=new e,e}(),ValidationResult=function(){function e(){this.problems=[],this.propertiesMatches=0,this.propertiesValueMatches=0,this.primaryValueMatches=0,this.enumValueMatch=!1,this.enumValues=void 0}return e.prototype.hasProblems=function(){return!!this.problems.length},e.prototype.mergeAll=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this.merge(n)}},e.prototype.merge=function(e){this.problems=this.problems.concat(e.problems)},e.prototype.mergeEnumValues=function(e){if(!this.enumValueMatch&&!e.enumValueMatch&&this.enumValues&&e.enumValues){this.enumValues=this.enumValues.concat(e.enumValues);for(var t=0,r=this.problems;t<r.length;t++){var n=r[t];n.code===ErrorCode.EnumValueMismatch&&(n.message=localize2("enumWarning","Value is not accepted. Valid values: {0}.",this.enumValues.map((function(e){return JSON.stringify(e)})).join(", ")))}}},e.prototype.mergePropertyMatch=function(e){this.merge(e),this.propertiesMatches++,(e.enumValueMatch||!e.hasProblems()&&e.propertiesMatches)&&this.propertiesValueMatches++,e.enumValueMatch&&e.enumValues&&1===e.enumValues.length&&this.primaryValueMatches++},e.prototype.compare=function(e){var t=this.hasProblems();return t!==e.hasProblems()?t?-1:1:this.enumValueMatch!==e.enumValueMatch?e.enumValueMatch?-1:1:this.primaryValueMatches!==e.primaryValueMatches?this.primaryValueMatches-e.primaryValueMatches:this.propertiesValueMatches!==e.propertiesValueMatches?this.propertiesValueMatches-e.propertiesValueMatches:this.propertiesMatches-e.propertiesMatches},e}();function getNodeValue2(e){return Json.getNodeValue(e)}function getNodePath2(e){return Json.getNodePath(e)}function contains(e,t,r){return void 0===r&&(r=!1),t>=e.offset&&t<e.offset+e.length||r&&t===e.offset+e.length}var JSONDocument=function(){function e(e,t,r){void 0===t&&(t=[]),void 0===r&&(r=[]),this.root=e,this.syntaxErrors=t,this.comments=r}return e.prototype.getNodeFromOffset=function(e,t){if(void 0===t&&(t=!1),this.root)return Json.findNodeAtOffset(this.root,e,t)},e.prototype.visit=function(e){if(this.root){var t=function(r){var n=e(r),i=r.children;if(Array.isArray(i))for(var o=0;o<i.length&&n;o++)n=t(i[o]);return n};t(this.root)}},e.prototype.validate=function(e,t,r){if(void 0===r&&(r=DiagnosticSeverity.Warning),this.root&&t){var n=new ValidationResult;return validate(this.root,t,n,NoOpSchemaCollector.instance),n.problems.map((function(t){var n,i=Range.create(e.positionAt(t.location.offset),e.positionAt(t.location.offset+t.location.length));return Diagnostic.create(i,t.message,null!==(n=t.severity)&&void 0!==n?n:r,t.code)}))}},e.prototype.getMatchingSchemas=function(e,t,r){void 0===t&&(t=-1);var n=new SchemaCollector(t,r);return this.root&&e&&validate(this.root,e,new ValidationResult,n),n.schemas},e}();function validate(e,t,r,n){if(e&&n.include(e)){var i=e;switch(i.type){case"object":!function(e,t,r,n){for(var i=Object.create(null),o=[],s=0,a=e.properties;s<a.length;s++){i[L=(g=a[s]).keyNode.value]=g.valueNode,o.push(L)}if(Array.isArray(t.required))for(var l=0,c=t.required;l<c.length;l++){if(!i[A=c[l]]){var u=e.parent&&"property"===e.parent.type&&e.parent.keyNode,m=u?{offset:u.offset,length:u.length}:{offset:e.offset,length:1};r.problems.push({location:m,message:localize2("MissingRequiredPropWarning",'Missing property "{0}".',A)})}}var h=function(e){for(var t=o.indexOf(e);t>=0;)o.splice(t,1),t=o.indexOf(e)};if(t.properties)for(var p=0,f=Object.keys(t.properties);p<f.length;p++){h(A=f[p]);var d=t.properties[A];if(D=i[A])if(isBoolean(d))if(d)r.propertiesMatches++,r.propertiesValueMatches++;else{var g=D.parent;r.problems.push({location:{offset:g.keyNode.offset,length:g.keyNode.length},message:t.errorMessage||localize2("DisallowedExtraPropWarning","Property {0} is not allowed.",A)})}else validate(D,d,I=new ValidationResult,n),r.mergePropertyMatch(I)}if(t.patternProperties)for(var y=0,v=Object.keys(t.patternProperties);y<v.length;y++)for(var S=v[y],b=extendedRegExp(S),x=0,T=o.slice(0);x<T.length;x++){var A=T[x];if(b.test(A))if(h(A),D=i[A])if(isBoolean(d=t.patternProperties[S]))if(d)r.propertiesMatches++,r.propertiesValueMatches++;else{g=D.parent;r.problems.push({location:{offset:g.keyNode.offset,length:g.keyNode.length},message:t.errorMessage||localize2("DisallowedExtraPropWarning","Property {0} is not allowed.",A)})}else validate(D,d,I=new ValidationResult,n),r.mergePropertyMatch(I)}if("object"==typeof t.additionalProperties)for(var C=0,M=o;C<M.length;C++){if(D=i[A=M[C]]){var I=new ValidationResult;validate(D,t.additionalProperties,I,n),r.mergePropertyMatch(I)}}else if(!1===t.additionalProperties&&o.length>0)for(var O=0,P=o;O<P.length;O++){var D;if(D=i[A=P[O]]){g=D.parent;r.problems.push({location:{offset:g.keyNode.offset,length:g.keyNode.length},message:t.errorMessage||localize2("DisallowedExtraPropWarning","Property {0} is not allowed.",A)})}}isNumber(t.maxProperties)&&e.properties.length>t.maxProperties&&r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("MaxPropWarning","Object has more properties than limit of {0}.",t.maxProperties)});isNumber(t.minProperties)&&e.properties.length<t.minProperties&&r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("MinPropWarning","Object has fewer properties than the required number of {0}",t.minProperties)});if(t.dependencies)for(var N=0,k=Object.keys(t.dependencies);N<k.length;N++){if(i[L=k[N]]){var w=t.dependencies[L];if(Array.isArray(w))for(var V=0,E=w;V<E.length;V++){var R=E[V];i[R]?r.propertiesValueMatches++:r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("RequiredDependentPropWarning","Object is missing property {0} required by property {1}.",R,L)})}else if(d=asSchema(w))validate(e,d,I=new ValidationResult,n),r.mergePropertyMatch(I)}}var F=asSchema(t.propertyNames);if(F)for(var j=0,$=e.properties;j<$.length;j++){var L;(L=$[j].keyNode)&&validate(L,F,r,NoOpSchemaCollector.instance)}}(i,t,r,n);break;case"array":!function(e,t,r,n){if(Array.isArray(t.items)){for(var i=t.items,o=0;o<i.length;o++){var s=asSchema(i[o]),a=new ValidationResult;(h=e.items[o])?(validate(h,s,a,n),r.mergePropertyMatch(a)):e.items.length>=i.length&&r.propertiesValueMatches++}if(e.items.length>i.length)if("object"==typeof t.additionalItems)for(var l=i.length;l<e.items.length;l++){a=new ValidationResult;validate(e.items[l],t.additionalItems,a,n),r.mergePropertyMatch(a)}else!1===t.additionalItems&&r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("additionalItemsWarning","Array has too many items according to schema. Expected {0} or fewer.",i.length)})}else{var c=asSchema(t.items);if(c)for(var u=0,m=e.items;u<m.length;u++){var h;validate(h=m[u],c,a=new ValidationResult,n),r.mergePropertyMatch(a)}}var p=asSchema(t.contains);if(p){e.items.some((function(e){var t=new ValidationResult;return validate(e,p,t,NoOpSchemaCollector.instance),!t.hasProblems()}))||r.problems.push({location:{offset:e.offset,length:e.length},message:t.errorMessage||localize2("requiredItemMissingWarning","Array does not contain required item.")})}isNumber(t.minItems)&&e.items.length<t.minItems&&r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("minItemsWarning","Array has too few items. Expected {0} or more.",t.minItems)});isNumber(t.maxItems)&&e.items.length>t.maxItems&&r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("maxItemsWarning","Array has too many items. Expected {0} or fewer.",t.maxItems)});if(!0===t.uniqueItems){var f=getNodeValue2(e);f.some((function(e,t){return t!==f.lastIndexOf(e)}))&&r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("uniqueItemsWarning","Array has duplicate items.")})}}(i,t,r,n);break;case"string":!function(e,t,r,n){isNumber(t.minLength)&&e.value.length<t.minLength&&r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("minLengthWarning","String is shorter than the minimum length of {0}.",t.minLength)});isNumber(t.maxLength)&&e.value.length>t.maxLength&&r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("maxLengthWarning","String is longer than the maximum length of {0}.",t.maxLength)});if(isString(t.pattern)){extendedRegExp(t.pattern).test(e.value)||r.problems.push({location:{offset:e.offset,length:e.length},message:t.patternErrorMessage||t.errorMessage||localize2("patternWarning",'String does not match the pattern of "{0}".',t.pattern)})}if(t.format)switch(t.format){case"uri":case"uri-reference":var i=void 0;if(e.value){var o=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/.exec(e.value);o?o[2]||"uri"!==t.format||(i=localize2("uriSchemeMissing","URI with a scheme is expected.")):i=localize2("uriMissing","URI is expected.")}else i=localize2("uriEmpty","URI expected.");i&&r.problems.push({location:{offset:e.offset,length:e.length},message:t.patternErrorMessage||t.errorMessage||localize2("uriFormatWarning","String is not a URI: {0}",i)});break;case"color-hex":case"date-time":case"date":case"time":case"email":var s=formats[t.format];e.value&&s.pattern.exec(e.value)||r.problems.push({location:{offset:e.offset,length:e.length},message:t.patternErrorMessage||t.errorMessage||s.errorMessage})}}(i,t,r);break;case"number":!function(e,t,r,n){var i=e.value;function o(e){var t,r=/^(-?\d+)(?:\.(\d+))?(?:e([-+]\d+))?$/.exec(e.toString());return r&&{value:Number(r[1]+(r[2]||"")),multiplier:((null===(t=r[2])||void 0===t?void 0:t.length)||0)-(parseInt(r[3])||0)}}if(isNumber(t.multipleOf)){var s=-1;if(Number.isInteger(t.multipleOf))s=i%t.multipleOf;else{var a=o(t.multipleOf),l=o(i);if(a&&l){var c=Math.pow(10,Math.abs(l.multiplier-a.multiplier));l.multiplier<a.multiplier?l.value*=c:a.value*=c,s=l.value%a.value}}0!==s&&r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("multipleOfWarning","Value is not divisible by {0}.",t.multipleOf)})}function u(e,t){return isNumber(t)?t:isBoolean(t)&&t?e:void 0}function m(e,t){if(!isBoolean(t)||!t)return e}var h=u(t.minimum,t.exclusiveMinimum);isNumber(h)&&i<=h&&r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("exclusiveMinimumWarning","Value is below the exclusive minimum of {0}.",h)});var p=u(t.maximum,t.exclusiveMaximum);isNumber(p)&&i>=p&&r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("exclusiveMaximumWarning","Value is above the exclusive maximum of {0}.",p)});var f=m(t.minimum,t.exclusiveMinimum);isNumber(f)&&i<f&&r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("minimumWarning","Value is below the minimum of {0}.",f)});var d=m(t.maximum,t.exclusiveMaximum);isNumber(d)&&i>d&&r.problems.push({location:{offset:e.offset,length:e.length},message:localize2("maximumWarning","Value is above the maximum of {0}.",d)})}(i,t,r);break;case"property":return validate(i.valueNode,t,r,n)}!function(){function e(e){return i.type===e||"integer"===e&&"number"===i.type&&i.isInteger}Array.isArray(t.type)?t.type.some(e)||r.problems.push({location:{offset:i.offset,length:i.length},message:t.errorMessage||localize2("typeArrayMismatchWarning","Incorrect type. Expected one of {0}.",t.type.join(", "))}):t.type&&(e(t.type)||r.problems.push({location:{offset:i.offset,length:i.length},message:t.errorMessage||localize2("typeMismatchWarning",'Incorrect type. Expected "{0}".',t.type)}));if(Array.isArray(t.allOf))for(var o=0,s=t.allOf;o<s.length;o++){var a=s[o];validate(i,asSchema(a),r,n)}var l=asSchema(t.not);if(l){var c=new ValidationResult,u=n.newSub();validate(i,l,c,u),c.hasProblems()||r.problems.push({location:{offset:i.offset,length:i.length},message:localize2("notSchemaWarning","Matches a schema that is not allowed.")});for(var m=0,h=u.schemas;m<h.length;m++){var p=h[m];p.inverted=!p.inverted,n.add(p)}}var f=function(e,t){for(var o=[],s=void 0,a=0,l=e;a<l.length;a++){var c=asSchema(l[a]),u=new ValidationResult,m=n.newSub();if(validate(i,c,u,m),u.hasProblems()||o.push(c),s)if(t||u.hasProblems()||s.validationResult.hasProblems()){var h=u.compare(s.validationResult);h>0?s={schema:c,validationResult:u,matchingSchemas:m}:0===h&&(s.matchingSchemas.merge(m),s.validationResult.mergeEnumValues(u))}else s.matchingSchemas.merge(m),s.validationResult.propertiesMatches+=u.propertiesMatches,s.validationResult.propertiesValueMatches+=u.propertiesValueMatches;else s={schema:c,validationResult:u,matchingSchemas:m}}return o.length>1&&t&&r.problems.push({location:{offset:i.offset,length:1},message:localize2("oneOfWarning","Matches multiple schemas when only one must validate.")}),s&&(r.merge(s.validationResult),r.propertiesMatches+=s.validationResult.propertiesMatches,r.propertiesValueMatches+=s.validationResult.propertiesValueMatches,n.merge(s.matchingSchemas)),o.length};Array.isArray(t.anyOf)&&f(t.anyOf,!1);Array.isArray(t.oneOf)&&f(t.oneOf,!0);var d=function(e){var t=new ValidationResult,o=n.newSub();validate(i,asSchema(e),t,o),r.merge(t),r.propertiesMatches+=t.propertiesMatches,r.propertiesValueMatches+=t.propertiesValueMatches,n.merge(o)},g=asSchema(t.if);g&&(y=g,v=asSchema(t.then),S=asSchema(t.else),b=asSchema(y),x=new ValidationResult,T=n.newSub(),validate(i,b,x,T),n.merge(T),x.hasProblems()?S&&d(S):v&&d(v));var y,v,S,b,x,T;if(Array.isArray(t.enum)){for(var A=getNodeValue2(i),C=!1,M=0,I=t.enum;M<I.length;M++){if(equals(A,I[M])){C=!0;break}}r.enumValues=t.enum,r.enumValueMatch=C,C||r.problems.push({location:{offset:i.offset,length:i.length},code:ErrorCode.EnumValueMismatch,message:t.errorMessage||localize2("enumWarning","Value is not accepted. Valid values: {0}.",t.enum.map((function(e){return JSON.stringify(e)})).join(", "))})}if(isDefined(t.const)){equals(A=getNodeValue2(i),t.const)?r.enumValueMatch=!0:(r.problems.push({location:{offset:i.offset,length:i.length},code:ErrorCode.EnumValueMismatch,message:t.errorMessage||localize2("constWarning","Value must be {0}.",JSON.stringify(t.const))}),r.enumValueMatch=!1),r.enumValues=[t.const]}t.deprecationMessage&&i.parent&&r.problems.push({location:{offset:i.parent.offset,length:i.parent.length},severity:DiagnosticSeverity.Warning,message:t.deprecationMessage,code:ErrorCode.Deprecated})}(),n.add({node:i,schema:t})}}function createRegex(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");for(var r,n=String(e),i="",o=!!t&&!!t.extended,s=!!t&&!!t.globstar,a=!1,l=t&&"string"==typeof t.flags?t.flags:"",c=0,u=n.length;c<u;c++)switch(r=n[c]){case"/":case"$":case"^":case"+":case".":case"(":case")":case"=":case"!":case"|":i+="\\"+r;break;case"?":if(o){i+=".";break}case"[":case"]":if(o){i+=r;break}case"{":if(o){a=!0,i+="(";break}case"}":if(o){a=!1,i+=")";break}case",":if(a){i+="|";break}i+="\\"+r;break;case"*":for(var m=n[c-1],h=1;"*"===n[c+1];)h++,c++;var p=n[c+1];if(s)h>1&&("/"===m||void 0===m||"{"===m||","===m)&&("/"===p||void 0===p||","===p||"}"===p)?("/"===p?c++:"/"===m&&i.endsWith("\\/")&&(i=i.substr(0,i.length-2)),i+="((?:[^/]*(?:/|$))*)"):i+="([^/]*)";else i+=".*";break;default:i+=r}return l&&~l.indexOf("g")||(i="^"+i+"$"),new RegExp(i,l)}var localize3=loadMessageBundle(),BANG="!",PATH_SEP="/",FilePatternAssociation=function(){function e(e,t){this.globWrappers=[];try{for(var r=0,n=e;r<n.length;r++){var i=n[r],o=i[0]!==BANG;o||(i=i.substring(1)),i.length>0&&(i[0]===PATH_SEP&&(i=i.substring(1)),this.globWrappers.push({regexp:createRegex("**/"+i,{extended:!0,globstar:!0}),include:o}))}this.uris=t}catch(e){this.globWrappers.length=0,this.uris=[]}}return e.prototype.matchesPattern=function(e){for(var t=!1,r=0,n=this.globWrappers;r<n.length;r++){var i=n[r],o=i.regexp,s=i.include;o.test(e)&&(t=s)}return t},e.prototype.getURIs=function(){return this.uris},e}(),SchemaHandle=function(){function e(e,t,r){this.service=e,this.url=t,this.dependencies={},r&&(this.unresolvedSchema=this.service.promise.resolve(new UnresolvedSchema(r)))}return e.prototype.getUnresolvedSchema=function(){return this.unresolvedSchema||(this.unresolvedSchema=this.service.loadSchema(this.url)),this.unresolvedSchema},e.prototype.getResolvedSchema=function(){var e=this;return this.resolvedSchema||(this.resolvedSchema=this.getUnresolvedSchema().then((function(t){return e.service.resolveSchemaContent(t,e.url,e.dependencies)}))),this.resolvedSchema},e.prototype.clearSchema=function(){this.resolvedSchema=void 0,this.unresolvedSchema=void 0,this.dependencies={}},e}(),UnresolvedSchema=function(e,t){void 0===t&&(t=[]),this.schema=e,this.errors=t},ResolvedSchema=function(){function e(e,t){void 0===t&&(t=[]),this.schema=e,this.errors=t}return e.prototype.getSection=function(e){var t=this.getSectionRecursive(e,this.schema);if(t)return asSchema(t)},e.prototype.getSectionRecursive=function(e,t){if(!t||"boolean"==typeof t||0===e.length)return t;var r=e.shift();if(t.properties&&(t.properties[r],1))return this.getSectionRecursive(e,t.properties[r]);if(t.patternProperties)for(var n=0,i=Object.keys(t.patternProperties);n<i.length;n++){var o=i[n];if(extendedRegExp(o).test(r))return this.getSectionRecursive(e,t.patternProperties[o])}else{if("object"==typeof t.additionalProperties)return this.getSectionRecursive(e,t.additionalProperties);if(r.match("[0-9]+"))if(Array.isArray(t.items)){var s=parseInt(r,10);if(!isNaN(s)&&t.items[s])return this.getSectionRecursive(e,t.items[s])}else if(t.items)return this.getSectionRecursive(e,t.items)}},e}(),JSONSchemaService=function(){function e(e,t,r){this.contextService=t,this.requestService=e,this.promiseConstructor=r||Promise,this.callOnDispose=[],this.contributionSchemas={},this.contributionAssociations=[],this.schemasById={},this.filePatternAssociations=[],this.registeredSchemasIds={}}return e.prototype.getRegisteredSchemaIds=function(e){return Object.keys(this.registeredSchemasIds).filter((function(t){var r=URI.parse(t).scheme;return"schemaservice"!==r&&(!e||e(r))}))},Object.defineProperty(e.prototype,"promise",{get:function(){return this.promiseConstructor},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){for(;this.callOnDispose.length>0;)this.callOnDispose.pop()()},e.prototype.onResourceChange=function(e){var t=this;this.cachedSchemaForResource=void 0;for(var r=!1,n=[e=normalizeId(e)],i=Object.keys(this.schemasById).map((function(e){return t.schemasById[e]}));n.length;)for(var o=n.pop(),s=0;s<i.length;s++){var a=i[s];a&&(a.url===o||a.dependencies[o])&&(a.url!==o&&n.push(a.url),a.clearSchema(),i[s]=void 0,r=!0)}return r},e.prototype.setSchemaContributions=function(e){if(e.schemas){var t=e.schemas;for(var r in t){var n=normalizeId(r);this.contributionSchemas[n]=this.addSchemaHandle(n,t[r])}}if(Array.isArray(e.schemaAssociations))for(var i=0,o=e.schemaAssociations;i<o.length;i++){var s=o[i],a=s.uris.map(normalizeId),l=this.addFilePatternAssociation(s.pattern,a);this.contributionAssociations.push(l)}},e.prototype.addSchemaHandle=function(e,t){var r=new SchemaHandle(this,e,t);return this.schemasById[e]=r,r},e.prototype.getOrAddSchemaHandle=function(e,t){return this.schemasById[e]||this.addSchemaHandle(e,t)},e.prototype.addFilePatternAssociation=function(e,t){var r=new FilePatternAssociation(e,t);return this.filePatternAssociations.push(r),r},e.prototype.registerExternalSchema=function(e,t,r){var n=normalizeId(e);return this.registeredSchemasIds[n]=!0,this.cachedSchemaForResource=void 0,t&&this.addFilePatternAssociation(t,[e]),r?this.addSchemaHandle(n,r):this.getOrAddSchemaHandle(n)},e.prototype.clearExternalSchemas=function(){for(var e in this.schemasById={},this.filePatternAssociations=[],this.registeredSchemasIds={},this.cachedSchemaForResource=void 0,this.contributionSchemas)this.schemasById[e]=this.contributionSchemas[e],this.registeredSchemasIds[e]=!0;for(var t=0,r=this.contributionAssociations;t<r.length;t++){var n=r[t];this.filePatternAssociations.push(n)}},e.prototype.getResolvedSchema=function(e){var t=normalizeId(e),r=this.schemasById[t];return r?r.getResolvedSchema():this.promise.resolve(void 0)},e.prototype.loadSchema=function(e){if(!this.requestService){var t=localize3("json.schema.norequestservice","Unable to load schema from '{0}'. No schema request service available",toDisplayString(e));return this.promise.resolve(new UnresolvedSchema({},[t]))}return this.requestService(e).then((function(t){if(!t){var r=localize3("json.schema.nocontent","Unable to load schema from '{0}': No content.",toDisplayString(e));return new UnresolvedSchema({},[r])}var n,i=[];n=Json2.parse(t,i);var o=i.length?[localize3("json.schema.invalidFormat","Unable to parse content from '{0}': Parse error at offset {1}.",toDisplayString(e),i[0].offset)]:[];return new UnresolvedSchema(n,o)}),(function(t){var r=t.toString(),n=t.toString().split("Error: ");return n.length>1&&(r=n[1]),endsWith(r,".")&&(r=r.substr(0,r.length-1)),new UnresolvedSchema({},[localize3("json.schema.nocontent","Unable to load schema from '{0}': {1}.",toDisplayString(e),r)])}))},e.prototype.resolveSchemaContent=function(e,t,r){var n=this,i=e.errors.slice(0),o=e.schema;if(o.$schema){var s=normalizeId(o.$schema);if("http://json-schema.org/draft-03/schema"===s)return this.promise.resolve(new ResolvedSchema({},[localize3("json.schema.draft03.notsupported","Draft-03 schemas are not supported.")]));"https://json-schema.org/draft/2019-09/schema"===s&&i.push(localize3("json.schema.draft201909.notsupported","Draft 2019-09 schemas are not yet fully supported."))}var a=this.contextService,l=function(e,t,r,n){var o=n?decodeURIComponent(n):void 0,s=function(e,t){if(!t)return e;var r=e;return"/"===t[0]&&(t=t.substr(1)),t.split("/").some((function(e){return e=e.replace(/~1/g,"/").replace(/~0/g,"~"),!(r=r[e])})),r}(t,o);if(s)for(var a in s)s.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(e[a]=s[a]);else i.push(localize3("json.schema.invalidref","$ref '{0}' in '{1}' can not be resolved.",o,r))},c=function(e,t,r,o,s){a&&!/^[A-Za-z][A-Za-z0-9+\-.+]*:\/\/.*/.test(t)&&(t=a.resolveRelativePath(t,o)),t=normalizeId(t);var c=n.getOrAddSchemaHandle(t);return c.getUnresolvedSchema().then((function(n){if(s[t]=!0,n.errors.length){var o=r?t+"#"+r:t;i.push(localize3("json.schema.problemloadingref","Problems loading reference '{0}': {1}",o,n.errors[0]))}return l(e,n.schema,t,r),u(e,n.schema,t,c.dependencies)}))},u=function(e,t,r,i){if(!e||"object"!=typeof e)return Promise.resolve(null);for(var o=[e],s=[],a=[],u=function(e){for(var n=[];e.$ref;){var s=e.$ref,u=s.split("#",2);if(delete e.$ref,u[0].length>0)return void a.push(c(e,u[0],u[1],r,i));-1===n.indexOf(s)&&(l(e,t,r,u[1]),n.push(s))}!function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=e;r<n.length;r++){var i=n[r];"object"==typeof i&&o.push(i)}}(e.items,e.additionalItems,e.additionalProperties,e.not,e.contains,e.propertyNames,e.if,e.then,e.else),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=e;r<n.length;r++){var i=n[r];if("object"==typeof i)for(var s in i){var a=i[s];"object"==typeof a&&o.push(a)}}}(e.definitions,e.properties,e.patternProperties,e.dependencies),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=e;r<n.length;r++){var i=n[r];if(Array.isArray(i))for(var s=0,a=i;s<a.length;s++){var l=a[s];"object"==typeof l&&o.push(l)}}}(e.anyOf,e.allOf,e.oneOf,e.items)};o.length;){var m=o.pop();s.indexOf(m)>=0||(s.push(m),u(m))}return n.promise.all(a)};return u(o,o,t,r).then((function(e){return new ResolvedSchema(o,i)}))},e.prototype.getSchemaForResource=function(e,t){if(t&&t.root&&"object"===t.root.type){var r=t.root.properties.filter((function(e){return"$schema"===e.keyNode.value&&e.valueNode&&"string"===e.valueNode.type}));if(r.length>0){var n=r[0].valueNode;if(n&&"string"===n.type){var i=getNodeValue2(n);if(i&&startsWith(i,".")&&this.contextService&&(i=this.contextService.resolveRelativePath(i,e)),i){var o=normalizeId(i);return this.getOrAddSchemaHandle(o).getResolvedSchema()}}}}if(this.cachedSchemaForResource&&this.cachedSchemaForResource.resource===e)return this.cachedSchemaForResource.resolvedSchema;for(var s=Object.create(null),a=[],l=normalizeResourceForMatching(e),c=0,u=this.filePatternAssociations;c<u.length;c++){var m=u[c];if(m.matchesPattern(l))for(var h=0,p=m.getURIs();h<p.length;h++){var f=p[h];s[f]||(a.push(f),s[f]=!0)}}var d=a.length>0?this.createCombinedSchema(e,a).getResolvedSchema():this.promise.resolve(void 0);return this.cachedSchemaForResource={resource:e,resolvedSchema:d},d},e.prototype.createCombinedSchema=function(e,t){if(1===t.length)return this.getOrAddSchemaHandle(t[0]);var r="schemaservice://combinedSchema/"+encodeURIComponent(e),n={allOf:t.map((function(e){return{$ref:e}}))};return this.addSchemaHandle(r,n)},e.prototype.getMatchingSchemas=function(e,t,r){if(r){var n=r.id||"schemaservice://untitled/matchingSchemas/"+idCounter++;return this.resolveSchemaContent(new UnresolvedSchema(r),n,{}).then((function(e){return t.getMatchingSchemas(e.schema).filter((function(e){return!e.inverted}))}))}return this.getSchemaForResource(e.uri,t).then((function(e){return e?t.getMatchingSchemas(e.schema).filter((function(e){return!e.inverted})):[]}))},e}(),idCounter=0;function normalizeId(e){try{return URI.parse(e).toString()}catch(t){return e}}function normalizeResourceForMatching(e){try{return URI.parse(e).with({fragment:null,query:null}).toString()}catch(t){return e}}function toDisplayString(e){try{var t=URI.parse(e);if("file"===t.scheme)return t.fsPath}catch(e){}return e}import{URI as URI4}from"vscode-uri";function convertSimple2RegExpPattern(e){return e.replace(/[-\\{}+?|^$.,[\]()#\s]/g,"\\$&").replace(/[*]/g,".*")}function getIndentation(e,t){if(e.length<t)return 0;for(let r=0;r<t;r++){const t=e.charCodeAt(r);if(32!==t&&9!==t)return r}return t}function safeCreateUnicodeRegExp(e){try{return new RegExp(e,"u")}catch(t){return new RegExp(e)}}function getFirstNonWhitespaceCharacterAfterOffset(e,t){for(let r=++t;r<e.length;r++){const n=e.charAt(r);if(" "!==n&&"\t"!==n)return t;t++}return t}import{parse as parse4}from"yaml";import*as path2 from"path-browserify";import{Parser,Composer,LineCounter}from"yaml";function equals2(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(typeof e!=typeof t)return!1;if("object"!=typeof e)return!1;if(Array.isArray(e)!==Array.isArray(t))return!1;let r,n;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(!equals2(e[r],t[r]))return!1}else{const i=[];for(n in e)i.push(n);i.sort();const o=[];for(n in t)o.push(n);if(o.sort(),!equals2(i,o))return!1;for(r=0;r<i.length;r++)if(!equals2(e[i[r]],t[i[r]]))return!1}return!0}function isNumber2(e){return"number"==typeof e}function isDefined2(e){return void 0!==e}function isBoolean2(e){return"boolean"==typeof e}function isString2(e){return"string"==typeof e}function isIterable(e){return Symbol.iterator in Object(e)}function convertErrorToTelemetryMsg(e){var t;return e?e instanceof Error&&null!=(t=e.stack)?t:e.toString():"null"}import{URI as URI2}from"vscode-uri";import*as path from"path-browserify";function getSchemaTypeName(e){const t=e.type&&e.closestTitle;return e.title?e.title:e.$id?getSchemaRefTypeTitle(e.$id):e.$ref||e._$ref?getSchemaRefTypeTitle(e.$ref||e._$ref):Array.isArray(e.type)?e.type.join(" | "):t?e.type.concat("(",e.closestTitle,")"):e.type||e.closestTitle}function getSchemaRefTypeTitle(e){const t=e.match(/^(?:.*\/)?(.*?)(?:\.schema\.json)?$/);let r=!!t&&t[1];return r||(r="typeNotFound",console.error(`$ref (${e}) not parsed properly`)),r}function getSchemaTitle(e,t){const r=URI2.parse(t);let n=path.basename(r.fsPath);return path.extname(r.fsPath)||(n+=".json"),Object.getOwnPropertyDescriptor(e,"name")?Object.getOwnPropertyDescriptor(e,"name").value+` (${n})`:e.title?e.description?e.title+" - "+e.description+` (${n})`:e.title+` (${n})`:n}function isPrimitiveType(e){return"object"!==e.type&&!isAnyOfAllOfOneOfType(e)}function isAnyOfAllOfOneOfType(e){return!!(e.anyOf||e.allOf||e.oneOf)}import*as Json3 from"jsonc-parser";function stringifyObject(e,t,r){if(null!==e&&"object"==typeof e){var n=t+"\t";if(Array.isArray(e)){if(0===e.length)return"[]";for(var i="[\n",o=0;o<e.length;o++)i+=n+stringifyObject(e[o],n,r),o<e.length-1&&(i+=","),i+="\n";return i+=t+"]"}var s=Object.keys(e);if(0===s.length)return"{}";for(i="{\n",o=0;o<s.length;o++){var a=s[o];i+=n+JSON.stringify(a)+": "+stringifyObject(e[a],n,r),o<s.length-1&&(i+=","),i+="\n"}return i+=t+"}"}return r(e)}var localize4=loadMessageBundle(),valueCommitCharacters=[",","}","]"],propertyCommitCharacters=[":"],JSONCompletion=function(){function e(e,t,r,n){void 0===t&&(t=[]),void 0===r&&(r=Promise),void 0===n&&(n={}),this.schemaService=e,this.contributions=t,this.promiseConstructor=r,this.clientCapabilities=n}return e.prototype.doResolve=function(e){for(var t=this.contributions.length-1;t>=0;t--){var r=this.contributions[t].resolveCompletion;if(r){var n=r(e);if(n)return n}}return this.promiseConstructor.resolve(e)},e.prototype.doComplete=function(e,t,r){var n=this,i={items:[],isIncomplete:!1},o=e.getText(),s=e.offsetAt(t),a=r.getNodeFromOffset(s,!0);if(this.isInComment(e,a?a.offset:0,s))return Promise.resolve(i);if(a&&s===a.offset+a.length&&s>0){var l=o[s-1];("object"===a.type&&"}"===l||"array"===a.type&&"]"===l)&&(a=a.parent)}var c,u=this.getCurrentWord(e,s);if(!a||"string"!==a.type&&"number"!==a.type&&"boolean"!==a.type&&"null"!==a.type){var m=s-u.length;m>0&&'"'===o[m-1]&&m--,c=Range.create(e.positionAt(m),t)}else c=Range.create(e.positionAt(a.offset),e.positionAt(a.offset+a.length));var h={},p={add:function(e){var t=e.label,r=h[t];if(r)r.documentation||(r.documentation=e.documentation),r.detail||(r.detail=e.detail);else{if((t=t.replace(/[\n]/g,"↵")).length>60){var n=t.substr(0,57).trim()+"...";h[n]||(t=n)}c&&void 0!==e.insertText&&(e.textEdit=TextEdit.replace(c,e.insertText)),e.label=t,h[t]=e,i.items.push(e)}},setAsIncomplete:function(){i.isIncomplete=!0},error:function(e){console.error(e)},log:function(e){console.log(e)},getNumberOfProposals:function(){return i.items.length}};return this.schemaService.getSchemaForResource(e.uri,r).then((function(t){var l=[],m=!0,f="",d=void 0;if(a&&"string"===a.type){var g=a.parent;g&&"property"===g.type&&g.keyNode===a&&(m=!g.valueNode,d=g,f=o.substr(a.offset+1,a.length-2),g&&(a=g.parent))}if(a&&"object"===a.type){if(a.offset===s)return i;a.properties.forEach((function(e){d&&d===e||(h[e.keyNode.value]=CompletionItem.create("__"))}));var y="";m&&(y=n.evaluateSeparatorAfter(e,e.offsetAt(c.end))),t?n.getPropertyCompletions(t,r,a,m,y,p):n.getSchemaLessPropertyCompletions(r,a,f,p);var v=getNodePath2(a);n.contributions.forEach((function(t){var r=t.collectPropertyCompletions(e.uri,v,u,m,""===y,p);r&&l.push(r)})),!t&&u.length>0&&'"'!==o.charAt(s-u.length-1)&&(p.add({kind:CompletionItemKind.Property,label:n.getLabelForValue(u),insertText:n.getInsertTextForProperty(u,void 0,!1,y),insertTextFormat:InsertTextFormat.Snippet,documentation:""}),p.setAsIncomplete())}var S={};return t?n.getValueCompletions(t,r,a,s,e,p,S):n.getSchemaLessValueCompletions(r,a,s,e,p),n.contributions.length>0&&n.getContributedValueCompletions(r,a,s,e,p,l),n.promiseConstructor.all(l).then((function(){if(0===p.getNumberOfProposals()){var t=s;!a||"string"!==a.type&&"number"!==a.type&&"boolean"!==a.type&&"null"!==a.type||(t=a.offset+a.length);var r=n.evaluateSeparatorAfter(e,t);n.addFillerValueCompletions(S,r,p)}return i}))}))},e.prototype.getPropertyCompletions=function(e,t,r,n,i,o){var s=this;t.getMatchingSchemas(e.schema,r.offset).forEach((function(e){if(e.node===r&&!e.inverted){var t=e.schema.properties;t&&Object.keys(t).forEach((function(e){var r=t[e];if("object"==typeof r&&!r.deprecationMessage&&!r.doNotSuggest){var a={kind:CompletionItemKind.Property,label:e,insertText:s.getInsertTextForProperty(e,r,n,i),insertTextFormat:InsertTextFormat.Snippet,filterText:s.getFilterTextForValue(e),documentation:s.fromMarkup(r.markdownDescription)||r.description||""};void 0!==r.suggestSortText&&(a.sortText=r.suggestSortText),a.insertText&&endsWith(a.insertText,"$1"+i)&&(a.command={title:"Suggest",command:"editor.action.triggerSuggest"}),o.add(a)}}));var a=e.schema.propertyNames;if("object"==typeof a&&!a.deprecationMessage&&!a.doNotSuggest){var l=function(e,t){void 0===t&&(t=void 0);var r={kind:CompletionItemKind.Property,label:e,insertText:s.getInsertTextForProperty(e,void 0,n,i),insertTextFormat:InsertTextFormat.Snippet,filterText:s.getFilterTextForValue(e),documentation:t||s.fromMarkup(a.markdownDescription)||a.description||""};void 0!==a.suggestSortText&&(r.sortText=a.suggestSortText),r.insertText&&endsWith(r.insertText,"$1"+i)&&(r.command={title:"Suggest",command:"editor.action.triggerSuggest"}),o.add(r)};if(a.enum)for(var c=0;c<a.enum.length;c++){var u=void 0;a.markdownEnumDescriptions&&c<a.markdownEnumDescriptions.length?u=s.fromMarkup(a.markdownEnumDescriptions[c]):a.enumDescriptions&&c<a.enumDescriptions.length&&(u=a.enumDescriptions[c]),l(a.enum[c],u)}a.const&&l(a.const)}}}))},e.prototype.getSchemaLessPropertyCompletions=function(e,t,r,n){var i=this,o=function(e){e.properties.forEach((function(e){var t=e.keyNode.value;n.add({kind:CompletionItemKind.Property,label:t,insertText:i.getInsertTextForValue(t,""),insertTextFormat:InsertTextFormat.Snippet,filterText:i.getFilterTextForValue(t),documentation:""})}))};if(t.parent)if("property"===t.parent.type){var s=t.parent.keyNode.value;e.visit((function(e){return"property"===e.type&&e!==t.parent&&e.keyNode.value===s&&e.valueNode&&"object"===e.valueNode.type&&o(e.valueNode),!0}))}else"array"===t.parent.type&&t.parent.items.forEach((function(e){"object"===e.type&&e!==t&&o(e)}));else"object"===t.type&&n.add({kind:CompletionItemKind.Property,label:"$schema",insertText:this.getInsertTextForProperty("$schema",void 0,!0,""),insertTextFormat:InsertTextFormat.Snippet,documentation:"",filterText:this.getFilterTextForValue("$schema")})},e.prototype.getSchemaLessValueCompletions=function(e,t,r,n,i){var o=this,s=r;if(!t||"string"!==t.type&&"number"!==t.type&&"boolean"!==t.type&&"null"!==t.type||(s=t.offset+t.length,t=t.parent),!t)return i.add({kind:this.getSuggestionKind("object"),label:"Empty object",insertText:this.getInsertTextForValue({},""),insertTextFormat:InsertTextFormat.Snippet,documentation:""}),void i.add({kind:this.getSuggestionKind("array"),label:"Empty array",insertText:this.getInsertTextForValue([],""),insertTextFormat:InsertTextFormat.Snippet,documentation:""});var a=this.evaluateSeparatorAfter(n,s),l=function(e){e.parent&&!contains(e.parent,r,!0)&&i.add({kind:o.getSuggestionKind(e.type),label:o.getLabelTextForMatchingNode(e,n),insertText:o.getInsertTextForMatchingNode(e,n,a),insertTextFormat:InsertTextFormat.Snippet,documentation:""}),"boolean"===e.type&&o.addBooleanValueCompletion(!e.value,a,i)};if("property"===t.type&&r>(t.colonOffset||0)){var c=t.valueNode;if(c&&(r>c.offset+c.length||"object"===c.type||"array"===c.type))return;var u=t.keyNode.value;e.visit((function(e){return"property"===e.type&&e.keyNode.value===u&&e.valueNode&&l(e.valueNode),!0})),"$schema"===u&&t.parent&&!t.parent.parent&&this.addDollarSchemaCompletions(a,i)}if("array"===t.type)if(t.parent&&"property"===t.parent.type){var m=t.parent.keyNode.value;e.visit((function(e){return"property"===e.type&&e.keyNode.value===m&&e.valueNode&&"array"===e.valueNode.type&&e.valueNode.items.forEach(l),!0}))}else t.items.forEach(l)},e.prototype.getValueCompletions=function(e,t,r,n,i,o,s){var a=n,l=void 0,c=void 0;if(!r||"string"!==r.type&&"number"!==r.type&&"boolean"!==r.type&&"null"!==r.type||(a=r.offset+r.length,c=r,r=r.parent),r){if("property"===r.type&&n>(r.colonOffset||0)){var u=r.valueNode;if(u&&n>u.offset+u.length)return;l=r.keyNode.value,r=r.parent}if(r&&(void 0!==l||"array"===r.type)){for(var m=this.evaluateSeparatorAfter(i,a),h=0,p=t.getMatchingSchemas(e.schema,r.offset,c);h<p.length;h++){var f=p[h];if(f.node===r&&!f.inverted&&f.schema){if("array"===r.type&&f.schema.items)if(Array.isArray(f.schema.items)){var d=this.findItemAtOffset(r,i,n);d<f.schema.items.length&&this.addSchemaValueCompletions(f.schema.items[d],m,o,s)}else this.addSchemaValueCompletions(f.schema.items,m,o,s);if(void 0!==l){var g=!1;if(f.schema.properties)(b=f.schema.properties[l])&&(g=!0,this.addSchemaValueCompletions(b,m,o,s));if(f.schema.patternProperties&&!g)for(var y=0,v=Object.keys(f.schema.patternProperties);y<v.length;y++){var S=v[y];if(extendedRegExp(S).test(l)){g=!0;var b=f.schema.patternProperties[S];this.addSchemaValueCompletions(b,m,o,s)}}if(f.schema.additionalProperties&&!g){b=f.schema.additionalProperties;this.addSchemaValueCompletions(b,m,o,s)}}}}"$schema"!==l||r.parent||this.addDollarSchemaCompletions(m,o),s.boolean&&(this.addBooleanValueCompletion(!0,m,o),this.addBooleanValueCompletion(!1,m,o)),s.null&&this.addNullValueCompletion(m,o)}}else this.addSchemaValueCompletions(e.schema,"",o,s)},e.prototype.getContributedValueCompletions=function(e,t,r,n,i,o){if(t){if("string"!==t.type&&"number"!==t.type&&"boolean"!==t.type&&"null"!==t.type||(t=t.parent),t&&"property"===t.type&&r>(t.colonOffset||0)){var s=t.keyNode.value,a=t.valueNode;if((!a||r<=a.offset+a.length)&&t.parent){var l=getNodePath2(t.parent);this.contributions.forEach((function(e){var t=e.collectValueCompletions(n.uri,l,s,i);t&&o.push(t)}))}}}else this.contributions.forEach((function(e){var t=e.collectDefaultCompletions(n.uri,i);t&&o.push(t)}))},e.prototype.addSchemaValueCompletions=function(e,t,r,n){var i=this;"object"==typeof e&&(this.addEnumValueCompletions(e,t,r),this.addDefaultValueCompletions(e,t,r),this.collectTypes(e,n),Array.isArray(e.allOf)&&e.allOf.forEach((function(e){return i.addSchemaValueCompletions(e,t,r,n)})),Array.isArray(e.anyOf)&&e.anyOf.forEach((function(e){return i.addSchemaValueCompletions(e,t,r,n)})),Array.isArray(e.oneOf)&&e.oneOf.forEach((function(e){return i.addSchemaValueCompletions(e,t,r,n)})))},e.prototype.addDefaultValueCompletions=function(e,t,r,n){var i=this;void 0===n&&(n=0);var o=!1;if(isDefined(e.default)){for(var s=e.type,a=e.default,l=n;l>0;l--)a=[a],s="array";r.add({kind:this.getSuggestionKind(s),label:this.getLabelForValue(a),insertText:this.getInsertTextForValue(a,t),insertTextFormat:InsertTextFormat.Snippet,detail:localize4("json.suggest.default","Default value")}),o=!0}Array.isArray(e.examples)&&e.examples.forEach((function(s){for(var a=e.type,l=s,c=n;c>0;c--)l=[l],a="array";r.add({kind:i.getSuggestionKind(a),label:i.getLabelForValue(l),insertText:i.getInsertTextForValue(l,t),insertTextFormat:InsertTextFormat.Snippet}),o=!0})),Array.isArray(e.defaultSnippets)&&e.defaultSnippets.forEach((function(s){var a,l,c=e.type,u=s.body,m=s.label;if(isDefined(u)){e.type;for(var h=n;h>0;h--)u=[u],"array";a=i.getInsertTextForSnippetValue(u,t),l=i.getFilterTextForSnippetValue(u),m=m||i.getLabelForSnippetValue(u)}else{if("string"!=typeof s.bodyText)return;var p="",f="",d="";for(h=n;h>0;h--)p=p+d+"[\n",f=f+"\n"+d+"]",d+="\t",c="array";a=p+d+s.bodyText.split("\n").join("\n"+d)+f+t,m=m||a,l=a.replace(/[\n]/g,"")}r.add({kind:i.getSuggestionKind(c),label:m,documentation:i.fromMarkup(s.markdownDescription)||s.description,insertText:a,insertTextFormat:InsertTextFormat.Snippet,filterText:l}),o=!0})),!o&&"object"==typeof e.items&&!Array.isArray(e.items)&&n<5&&this.addDefaultValueCompletions(e.items,t,r,n+1)},e.prototype.addEnumValueCompletions=function(e,t,r){if(isDefined(e.const)&&r.add({kind:this.getSuggestionKind(e.type),label:this.getLabelForValue(e.const),insertText:this.getInsertTextForValue(e.const,t),insertTextFormat:InsertTextFormat.Snippet,documentation:this.fromMarkup(e.markdownDescription)||e.description}),Array.isArray(e.enum))for(var n=0,i=e.enum.length;n<i;n++){var o=e.enum[n],s=this.fromMarkup(e.markdownDescription)||e.description;e.markdownEnumDescriptions&&n<e.markdownEnumDescriptions.length&&this.doesSupportMarkdown()?s=this.fromMarkup(e.markdownEnumDescriptions[n]):e.enumDescriptions&&n<e.enumDescriptions.length&&(s=e.enumDescriptions[n]),r.add({kind:this.getSuggestionKind(e.type),label:this.getLabelForValue(o),insertText:this.getInsertTextForValue(o,t),insertTextFormat:InsertTextFormat.Snippet,documentation:s})}},e.prototype.collectTypes=function(e,t){if(!Array.isArray(e.enum)&&!isDefined(e.const)){var r=e.type;Array.isArray(r)?r.forEach((function(e){return t[e]=!0})):r&&(t[r]=!0)}},e.prototype.addFillerValueCompletions=function(e,t,r){e.object&&r.add({kind:this.getSuggestionKind("object"),label:"{}",insertText:this.getInsertTextForGuessedValue({},t),insertTextFormat:InsertTextFormat.Snippet,detail:localize4("defaults.object","New object"),documentation:""}),e.array&&r.add({kind:this.getSuggestionKind("array"),label:"[]",insertText:this.getInsertTextForGuessedValue([],t),insertTextFormat:InsertTextFormat.Snippet,detail:localize4("defaults.array","New array"),documentation:""})},e.prototype.addBooleanValueCompletion=function(e,t,r){r.add({kind:this.getSuggestionKind("boolean"),label:e?"true":"false",insertText:this.getInsertTextForValue(e,t),insertTextFormat:InsertTextFormat.Snippet,documentation:""})},e.prototype.addNullValueCompletion=function(e,t){t.add({kind:this.getSuggestionKind("null"),label:"null",insertText:"null"+e,insertTextFormat:InsertTextFormat.Snippet,documentation:""})},e.prototype.addDollarSchemaCompletions=function(e,t){var r=this,n=this.schemaService.getRegisteredSchemaIds((function(e){return"http"===e||"https"===e}));n.forEach((function(n){return t.add({kind:CompletionItemKind.Module,label:r.getLabelForValue(n),filterText:r.getFilterTextForValue(n),insertText:r.getInsertTextForValue(n,e),insertTextFormat:InsertTextFormat.Snippet,documentation:""})}))},e.prototype.getLabelForValue=function(e){return JSON.stringify(e)},e.prototype.getFilterTextForValue=function(e){return JSON.stringify(e)},e.prototype.getFilterTextForSnippetValue=function(e){return JSON.stringify(e).replace(/\$\{\d+:([^}]+)\}|\$\d+/g,"$1")},e.prototype.getLabelForSnippetValue=function(e){return JSON.stringify(e).replace(/\$\{\d+:([^}]+)\}|\$\d+/g,"$1")},e.prototype.getInsertTextForPlainText=function(e){return e.replace(/[\\\$\}]/g,"\\$&")},e.prototype.getInsertTextForValue=function(e,t){var r=JSON.stringify(e,null,"\t");return"{}"===r?"{$1}"+t:"[]"===r?"[$1]"+t:this.getInsertTextForPlainText(r+t)},e.prototype.getInsertTextForSnippetValue=function(e,t){return stringifyObject(e,"",(function(e){return"string"==typeof e&&"^"===e[0]?e.substr(1):JSON.stringify(e)}))+t},e.prototype.getInsertTextForGuessedValue=function(e,t){switch(typeof e){case"object":return null===e?"${1:null}"+t:this.getInsertTextForValue(e,t);case"string":var r=JSON.stringify(e);return r=r.substr(1,r.length-2),'"${1:'+(r=this.getInsertTextForPlainText(r))+'}"'+t;case"number":case"boolean":return"${1:"+JSON.stringify(e)+"}"+t}return this.getInsertTextForValue(e,t)},e.prototype.getSuggestionKind=function(e){if(Array.isArray(e)){var t=e;e=t.length>0?t[0]:void 0}if(!e)return CompletionItemKind.Value;switch(e){case"string":default:return CompletionItemKind.Value;case"object":return CompletionItemKind.Module;case"property":return CompletionItemKind.Property}},e.prototype.getLabelTextForMatchingNode=function(e,t){switch(e.type){case"array":return"[]";case"object":return"{}";default:return t.getText().substr(e.offset,e.length)}},e.prototype.getInsertTextForMatchingNode=function(e,t,r){switch(e.type){case"array":return this.getInsertTextForValue([],r);case"object":return this.getInsertTextForValue({},r);default:var n=t.getText().substr(e.offset,e.length)+r;return this.getInsertTextForPlainText(n)}},e.prototype.getInsertTextForProperty=function(e,t,r,n){var i=this.getInsertTextForValue(e,"");if(!r)return i;var o,s=i+": ",a=0;if(t){if(Array.isArray(t.defaultSnippets)){if(1===t.defaultSnippets.length){var l=t.defaultSnippets[0].body;isDefined(l)&&(o=this.getInsertTextForSnippetValue(l,""))}a+=t.defaultSnippets.length}if(t.enum&&(o||1!==t.enum.length||(o=this.getInsertTextForGuessedValue(t.enum[0],"")),a+=t.enum.length),isDefined(t.default)&&(o||(o=this.getInsertTextForGuessedValue(t.default,"")),a++),Array.isArray(t.examples)&&t.examples.length&&(o||(o=this.getInsertTextForGuessedValue(t.examples[0],"")),a+=t.examples.length),0===a){var c=Array.isArray(t.type)?t.type[0]:t.type;switch(c||(t.properties?c="object":t.items&&(c="array")),c){case"boolean":o="$1";break;case"string":o='"$1"';break;case"object":o="{$1}";break;case"array":o="[$1]";break;case"number":case"integer":o="${1:0}";break;case"null":o="${1:null}";break;default:return i}}}return(!o||a>1)&&(o="$1"),s+o+n},e.prototype.getCurrentWord=function(e,t){for(var r=t-1,n=e.getText();r>=0&&-1===' \t\n\r\v":{[,]}'.indexOf(n.charAt(r));)r--;return n.substring(r+1,t)},e.prototype.evaluateSeparatorAfter=function(e,t){var r=Json3.createScanner(e.getText(),!0);switch(r.setPosition(t),r.scan()){case 5:case 2:case 4:case 17:return"";default:return","}},e.prototype.findItemAtOffset=function(e,t,r){for(var n=Json3.createScanner(t.getText(),!0),i=e.items,o=i.length-1;o>=0;o--){var s=i[o];if(r>s.offset+s.length)return n.setPosition(s.offset+s.length),5===n.scan()&&r>=n.getTokenOffset()+n.getTokenLength()?o+1:o;if(r>=s.offset)return o}return 0},e.prototype.isInComment=function(e,t,r){var n=Json3.createScanner(e.getText(),!1);n.setPosition(t);for(var i=n.scan();17!==i&&n.getTokenOffset()+n.getTokenLength()<r;)i=n.scan();return(12===i||13===i)&&n.getTokenOffset()<=r},e.prototype.fromMarkup=function(e){if(e&&this.doesSupportMarkdown())return{kind:MarkupKind.Markdown,value:e}},e.prototype.doesSupportMarkdown=function(){if(!isDefined(this.supportsMarkdown)){var e=this.clientCapabilities.textDocument&&this.clientCapabilities.textDocument.completion;this.supportsMarkdown=e&&e.completionItem&&Array.isArray(e.completionItem.documentationFormat)&&-1!==e.completionItem.documentationFormat.indexOf(MarkupKind.Markdown)}return this.supportsMarkdown},e.prototype.doesSupportsCommitCharacters=function(){if(!isDefined(this.supportsCommitCharacters)){var e=this.clientCapabilities.textDocument&&this.clientCapabilities.textDocument.completion;this.supportsCommitCharacters=e&&e.completionItem&&!!e.completionItem.commitCharactersSupport}return this.supportsCommitCharacters},e}(),JSONHover=function(){function e(e,t,r){void 0===t&&(t=[]),this.schemaService=e,this.contributions=t,this.promise=r||Promise}return e.prototype.doHover=function(e,t,r){var n=e.offsetAt(t),i=r.getNodeFromOffset(n);if(!i||("object"===i.type||"array"===i.type)&&n>i.offset+1&&n<i.offset+i.length-1)return this.promise.resolve(null);var o=i;if("string"===i.type){var s=i.parent;if(s&&"property"===s.type&&s.keyNode===i&&!(i=s.valueNode))return this.promise.resolve(null)}for(var a=Range.create(e.positionAt(o.offset),e.positionAt(o.offset+o.length)),l=function(e){return{contents:e,range:a}},c=getNodePath2(i),u=this.contributions.length-1;u>=0;u--){var m=this.contributions[u].getInfoContribution(e.uri,c);if(m)return m.then((function(e){return l(e)}))}return this.schemaService.getSchemaForResource(e.uri,r).then((function(e){if(e&&i){var t=r.getMatchingSchemas(e.schema,i.offset),n=void 0,o=void 0,s=void 0,a=void 0;t.every((function(e){if(e.node===i&&!e.inverted&&e.schema&&(n=n||e.schema.title,o=o||e.schema.markdownDescription||toMarkdown(e.schema.description),e.schema.enum)){var t=e.schema.enum.indexOf(getNodeValue2(i));e.schema.markdownEnumDescriptions?s=e.schema.markdownEnumDescriptions[t]:e.schema.enumDescriptions&&(s=toMarkdown(e.schema.enumDescriptions[t])),s&&"string"!=typeof(a=e.schema.enum[t])&&(a=JSON.stringify(a))}return!0}));var c="";return n&&(c=toMarkdown(n)),o&&(c.length>0&&(c+="\n\n"),c+=o),s&&(c.length>0&&(c+="\n\n"),c+="`"+toMarkdownCodeBlock(a)+"`: "+s),l([c])}return null}))},e}();function toMarkdown(e){if(e)return e.replace(/([^\n\r])(\r?\n)([^\n\r])/gm,"$1\n\n$3").replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}function toMarkdownCodeBlock(e){return-1!==e.indexOf("`")?"`` "+e+" ``":e}var localize5=loadMessageBundle(),JSONValidation=function(){function e(e,t){this.jsonSchemaService=e,this.promise=t,this.validationEnabled=!0}return e.prototype.configure=function(e){e&&(this.validationEnabled=!1!==e.validate,this.commentSeverity=e.allowComments?void 0:DiagnosticSeverity.Error)},e.prototype.doValidation=function(e,t,r,n){var i=this;if(!this.validationEnabled)return this.promise.resolve([]);var o=[],s={},a=function(e){var t=e.range.start.line+" "+e.range.start.character+" "+e.message;s[t]||(s[t]=!0,o.push(e))},l=function(n){var s=(null==r?void 0:r.trailingCommas)?toDiagnosticSeverity(r.trailingCommas):DiagnosticSeverity.Error,l=(null==r?void 0:r.comments)?toDiagnosticSeverity(r.comments):i.commentSeverity,c=(null==r?void 0:r.schemaValidation)?toDiagnosticSeverity(r.schemaValidation):DiagnosticSeverity.Warning,u=(null==r?void 0:r.schemaRequest)?toDiagnosticSeverity(r.schemaRequest):DiagnosticSeverity.Warning;if(n){if(n.errors.length&&t.root&&u){var m=t.root,h="object"===m.type?m.properties[0]:void 0;if(h&&"$schema"===h.keyNode.value){var p=h.valueNode||h,f=Range.create(e.positionAt(p.offset),e.positionAt(p.offset+p.length));a(Diagnostic.create(f,n.errors[0],u,ErrorCode.SchemaResolveError))}else{f=Range.create(e.positionAt(m.offset),e.positionAt(m.offset+1));a(Diagnostic.create(f,n.errors[0],u,ErrorCode.SchemaResolveError))}}else if(c){var d=t.validate(e,n.schema,c);d&&d.forEach(a)}schemaAllowsComments(n.schema)&&(l=void 0),schemaAllowsTrailingCommas(n.schema)&&(s=void 0)}for(var g=0,y=t.syntaxErrors;g<y.length;g++){var v=y[g];if(v.code===ErrorCode.TrailingComma){if("number"!=typeof s)continue;v.severity=s}a(v)}if("number"==typeof l){var S=localize5("InvalidCommentToken","Comments are not permitted in JSON.");t.comments.forEach((function(e){a(Diagnostic.create(e,S,l,ErrorCode.CommentNotPermitted))}))}return o};if(n){var c=n.id||"schemaservice://untitled/"+idCounter2++;return this.jsonSchemaService.resolveSchemaContent(new UnresolvedSchema(n),c,{}).then((function(e){return l(e)}))}return this.jsonSchemaService.getSchemaForResource(e.uri,t).then((function(e){return l(e)}))},e}(),idCounter2=0;function schemaAllowsComments(e){if(e&&"object"==typeof e){if(isBoolean(e.allowComments))return e.allowComments;if(e.allOf)for(var t=0,r=e.allOf;t<r.length;t++){var n=schemaAllowsComments(r[t]);if(isBoolean(n))return n}}}function schemaAllowsTrailingCommas(e){if(e&&"object"==typeof e){if(isBoolean(e.allowTrailingCommas))return e.allowTrailingCommas;var t=e;if(isBoolean(t.allowsTrailingCommas))return t.allowsTrailingCommas;if(e.allOf)for(var r=0,n=e.allOf;r<n.length;r++){var i=schemaAllowsTrailingCommas(n[r]);if(isBoolean(i))return i}}}function toDiagnosticSeverity(e){switch(e){case"error":return DiagnosticSeverity.Error;case"warning":return DiagnosticSeverity.Warning;case"ignore":return}}var Digit0=48,Digit9=57,A=65,a=97,f=102;function hexDigit(e){return e<Digit0?0:e<=Digit9?e-Digit0:(e<a&&(e+=a-A),e>=a&&e<=f?e-a+10:0)}function colorFromHex(e){if("#"===e[0])switch(e.length){case 4:return{red:17*hexDigit(e.charCodeAt(1))/255,green:17*hexDigit(e.charCodeAt(2))/255,blue:17*hexDigit(e.charCodeAt(3))/255,alpha:1};case 5:return{red:17*hexDigit(e.charCodeAt(1))/255,green:17*hexDigit(e.charCodeAt(2))/255,blue:17*hexDigit(e.charCodeAt(3))/255,alpha:17*hexDigit(e.charCodeAt(4))/255};case 7:return{red:(16*hexDigit(e.charCodeAt(1))+hexDigit(e.charCodeAt(2)))/255,green:(16*hexDigit(e.charCodeAt(3))+hexDigit(e.charCodeAt(4)))/255,blue:(16*hexDigit(e.charCodeAt(5))+hexDigit(e.charCodeAt(6)))/255,alpha:1};case 9:return{red:(16*hexDigit(e.charCodeAt(1))+hexDigit(e.charCodeAt(2)))/255,green:(16*hexDigit(e.charCodeAt(3))+hexDigit(e.charCodeAt(4)))/255,blue:(16*hexDigit(e.charCodeAt(5))+hexDigit(e.charCodeAt(6)))/255,alpha:(16*hexDigit(e.charCodeAt(7))+hexDigit(e.charCodeAt(8)))/255}}}var JSONDocumentSymbols=function(){function e(e){this.schemaService=e}return e.prototype.findDocumentSymbols=function(e,t,r){var n=this;void 0===r&&(r={resultLimit:Number.MAX_VALUE});var i=t.root;if(!i)return[];var o=r.resultLimit||Number.MAX_VALUE,s=e.uri;if(("vscode://defaultsettings/keybindings.json"===s||endsWith(s.toLowerCase(),"/user/keybindings.json"))&&"array"===i.type){for(var a=[],l=0,c=i.items;l<c.length;l++){var u=c[l];if("object"===u.type)for(var m=0,h=u.properties;m<h.length;m++){var p=h[m];if("key"===p.keyNode.value&&p.valueNode){var f=Location.create(e.uri,getRange(e,u));if(a.push({name:getNodeValue2(p.valueNode),kind:SymbolKind.Function,location:f}),--o<=0)return r&&r.onResultLimitExceeded&&r.onResultLimitExceeded(s),a}}}return a}for(var d=[{node:i,containerName:""}],g=0,y=!1,v=[],S=function(t,r){"array"===t.type?t.items.forEach((function(e){e&&d.push({node:e,containerName:r})})):"object"===t.type&&t.properties.forEach((function(t){var i=t.valueNode;if(i)if(o>0){o--;var s=Location.create(e.uri,getRange(e,t)),a=r?r+"."+t.keyNode.value:t.keyNode.value;v.push({name:n.getKeyLabel(t),kind:n.getSymbolKind(i.type),location:s,containerName:r}),d.push({node:i,containerName:a})}else y=!0}))};g<d.length;){var b=d[g++];S(b.node,b.containerName)}return y&&r&&r.onResultLimitExceeded&&r.onResultLimitExceeded(s),v},e.prototype.findDocumentSymbols2=function(e,t,r){var n=this;void 0===r&&(r={resultLimit:Number.MAX_VALUE});var i=t.root;if(!i)return[];var o=r.resultLimit||Number.MAX_VALUE,s=e.uri;if(("vscode://defaultsettings/keybindings.json"===s||endsWith(s.toLowerCase(),"/user/keybindings.json"))&&"array"===i.type){for(var a=[],l=0,c=i.items;l<c.length;l++){var u=c[l];if("object"===u.type)for(var m=0,h=u.properties;m<h.length;m++){var p=h[m];if("key"===p.keyNode.value&&p.valueNode){var f=getRange(e,u),d=getRange(e,p.keyNode);if(a.push({name:getNodeValue2(p.valueNode),kind:SymbolKind.Function,range:f,selectionRange:d}),--o<=0)return r&&r.onResultLimitExceeded&&r.onResultLimitExceeded(s),a}}}return a}for(var g=[],y=[{node:i,result:g}],v=0,S=!1,b=function(t,r){"array"===t.type?t.items.forEach((function(t,i){if(t)if(o>0){o--;var s=getRange(e,t),a=s,l={name:String(i),kind:n.getSymbolKind(t.type),range:s,selectionRange:a,children:[]};r.push(l),y.push({result:l.children,node:t})}else S=!0})):"object"===t.type&&t.properties.forEach((function(t){var i=t.valueNode;if(i)if(o>0){o--;var s=getRange(e,t),a=getRange(e,t.keyNode),l=[],c={name:n.getKeyLabel(t),kind:n.getSymbolKind(i.type),range:s,selectionRange:a,children:l,detail:n.getDetail(i)};r.push(c),y.push({result:l,node:i})}else S=!0}))};v<y.length;){var x=y[v++];b(x.node,x.result)}return S&&r&&r.onResultLimitExceeded&&r.onResultLimitExceeded(s),g},e.prototype.getSymbolKind=function(e){switch(e){case"object":return SymbolKind.Module;case"string":return SymbolKind.String;case"number":return SymbolKind.Number;case"array":return SymbolKind.Array;case"boolean":return SymbolKind.Boolean;default:return SymbolKind.Variable}},e.prototype.getKeyLabel=function(e){var t=e.keyNode.value;return t&&(t=t.replace(/[\n]/g,"↵")),t&&t.trim()?t:'"'+t+'"'},e.prototype.getDetail=function(e){if(e)return"boolean"===e.type||"number"===e.type||"null"===e.type||"string"===e.type?String(e.value):"array"===e.type?e.children.length?void 0:"[]":"object"===e.type?e.children.length?void 0:"{}":void 0},e.prototype.findDocumentColors=function(e,t,r){return this.schemaService.getSchemaForResource(e.uri,t).then((function(n){var i=[];if(n)for(var o=r&&"number"==typeof r.resultLimit?r.resultLimit:Number.MAX_VALUE,s={},a=0,l=t.getMatchingSchemas(n.schema);a<l.length;a++){var c=l[a];if(!c.inverted&&c.schema&&("color"===c.schema.format||"color-hex"===c.schema.format)&&c.node&&"string"===c.node.type){var u=String(c.node.offset);if(!s[u]){var m=colorFromHex(getNodeValue2(c.node));if(m){var h=getRange(e,c.node);i.push({color:m,range:h})}if(s[u]=!0,--o<=0)return r&&r.onResultLimitExceeded&&r.onResultLimitExceeded(e.uri),i}}}return i}))},e.prototype.getColorPresentations=function(e,t,r,n){var i,o=[],s=Math.round(255*r.red),a=Math.round(255*r.green),l=Math.round(255*r.blue);function c(e){var t=e.toString(16);return 2!==t.length?"0"+t:t}return i=1===r.alpha?"#"+c(s)+c(a)+c(l):"#"+c(s)+c(a)+c(l)+c(Math.round(255*r.alpha)),o.push({label:i,textEdit:TextEdit.replace(n,JSON.stringify(i))}),o},e}();function getRange(e,t){return Range.create(e.positionAt(t.offset),e.positionAt(t.offset+t.length))}var schema,propertyObject,description,property,schemaName,localize6=loadMessageBundle(),schemaContributions={schemaAssociations:[],schemas:{"http://json-schema.org/schema#":{$ref:"http://json-schema.org/draft-07/schema#"},"http://json-schema.org/draft-04/schema#":{$schema:"http://json-schema.org/draft-04/schema#",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},positiveInteger:{type:"integer",minimum:0},positiveIntegerDefault0:{allOf:[{$ref:"#/definitions/positiveInteger"},{default:0}]},simpleTypes:{type:"string",enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},minItems:1,uniqueItems:!0}},type:"object",properties:{id:{type:"string",format:"uri"},$schema:{type:"string",format:"uri"},title:{type:"string"},description:{type:"string"},default:{},multipleOf:{type:"number",minimum:0,exclusiveMinimum:!0},maximum:{type:"number"},exclusiveMaximum:{type:"boolean",default:!1},minimum:{type:"number"},exclusiveMinimum:{type:"boolean",default:!1},maxLength:{allOf:[{$ref:"#/definitions/positiveInteger"}]},minLength:{allOf:[{$ref:"#/definitions/positiveIntegerDefault0"}]},pattern:{type:"string",format:"regex"},additionalItems:{anyOf:[{type:"boolean"},{$ref:"#"}],default:{}},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:{}},maxItems:{allOf:[{$ref:"#/definitions/positiveInteger"}]},minItems:{allOf:[{$ref:"#/definitions/positiveIntegerDefault0"}]},uniqueItems:{type:"boolean",default:!1},maxProperties:{allOf:[{$ref:"#/definitions/positiveInteger"}]},minProperties:{allOf:[{$ref:"#/definitions/positiveIntegerDefault0"}]},required:{allOf:[{$ref:"#/definitions/stringArray"}]},additionalProperties:{anyOf:[{type:"boolean"},{$ref:"#"}],default:{}},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},enum:{type:"array",minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{anyOf:[{type:"string",enum:["date-time","uri","email","hostname","ipv4","ipv6","regex"]},{type:"string"}]},allOf:{allOf:[{$ref:"#/definitions/schemaArray"}]},anyOf:{allOf:[{$ref:"#/definitions/schemaArray"}]},oneOf:{allOf:[{$ref:"#/definitions/schemaArray"}]},not:{allOf:[{$ref:"#"}]}},dependencies:{exclusiveMaximum:["maximum"],exclusiveMinimum:["minimum"]},default:{}},"http://json-schema.org/draft-07/schema#":{definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}}},descriptions={id:localize6("schema.json.id","A unique identifier for the schema."),$schema:localize6("schema.json.$schema","The schema to verify this document against."),title:localize6("schema.json.title","A descriptive title of the element."),description:localize6("schema.json.description","A long description of the element. Used in hover menus and suggestions."),default:localize6("schema.json.default","A default value. Used by suggestions."),multipleOf:localize6("schema.json.multipleOf","A number that should cleanly divide the current value (i.e. have no remainder)."),maximum:localize6("schema.json.maximum","The maximum numerical value, inclusive by default."),exclusiveMaximum:localize6("schema.json.exclusiveMaximum","Makes the maximum property exclusive."),minimum:localize6("schema.json.minimum","The minimum numerical value, inclusive by default."),exclusiveMinimum:localize6("schema.json.exclusiveMininum","Makes the minimum property exclusive."),maxLength:localize6("schema.json.maxLength","The maximum length of a string."),minLength:localize6("schema.json.minLength","The minimum length of a string."),pattern:localize6("schema.json.pattern","A regular expression to match the string against. It is not implicitly anchored."),additionalItems:localize6("schema.json.additionalItems","For arrays, only when items is set as an array. If it is a schema, then this schema validates items after the ones specified by the items array. If it is false, then additional items will cause validation to fail."),items:localize6("schema.json.items","For arrays. Can either be a schema to validate every element against or an array of schemas to validate each item against in order (the first schema will validate the first element, the second schema will validate the second element, and so on."),maxItems:localize6("schema.json.maxItems","The maximum number of items that can be inside an array. Inclusive."),minItems:localize6("schema.json.minItems","The minimum number of items that can be inside an array. Inclusive."),uniqueItems:localize6("schema.json.uniqueItems","If all of the items in the array must be unique. Defaults to false."),maxProperties:localize6("schema.json.maxProperties","The maximum number of properties an object can have. Inclusive."),minProperties:localize6("schema.json.minProperties","The minimum number of properties an object can have. Inclusive."),required:localize6("schema.json.required","An array of strings that lists the names of all properties required on this object."),additionalProperties:localize6("schema.json.additionalProperties","Either a schema or a boolean. If a schema, then used to validate all properties not matched by 'properties' or 'patternProperties'. If false, then any properties not matched by either will cause this schema to fail."),definitions:localize6("schema.json.definitions","Not used for validation. Place subschemas here that you wish to reference inline with $ref."),properties:localize6("schema.json.properties","A map of property names to schemas for each property."),patternProperties:localize6("schema.json.patternProperties","A map of regular expressions on property names to schemas for matching properties."),dependencies:localize6("schema.json.dependencies","A map of property names to either an array of property names or a schema. An array of property names means the property named in the key depends on the properties in the array being present in the object in order to be valid. If the value is a schema, then the schema is only applied to the object if the property in the key exists on the object."),enum:localize6("schema.json.enum","The set of literal values that are valid."),type:localize6("schema.json.type","Either a string of one of the basic schema types (number, integer, null, array, object, boolean, string) or an array of strings specifying a subset of those types."),format:localize6("schema.json.format","Describes the format expected for the value."),allOf:localize6("schema.json.allOf","An array of schemas, all of which must match."),anyOf:localize6("schema.json.anyOf","An array of schemas, where at least one must match."),oneOf:localize6("schema.json.oneOf","An array of schemas, exactly one of which must match."),not:localize6("schema.json.not","A schema which must not match."),$id:localize6("schema.json.$id","A unique identifier for the schema."),$ref:localize6("schema.json.$ref","Reference a definition hosted on any location."),$comment:localize6("schema.json.$comment","Comments from schema authors to readers or maintainers of the schema."),readOnly:localize6("schema.json.readOnly","Indicates that the value of the instance is managed exclusively by the owning authority."),examples:localize6("schema.json.examples","Sample JSON values associated with a particular schema, for the purpose of illustrating usage."),contains:localize6("schema.json.contains",'An array instance is valid against "contains" if at least one of its elements is valid against the given schema.'),propertyNames:localize6("schema.json.propertyNames","If the instance is an object, this keyword validates if every property name in the instance validates against the provided schema."),const:localize6("schema.json.const","An instance validates successfully against this keyword if its value is equal to the value of the keyword."),contentMediaType:localize6("schema.json.contentMediaType","Describes the media type of a string property."),contentEncoding:localize6("schema.json.contentEncoding","Describes the content encoding of a string property."),if:localize6("schema.json.if",'The validation outcome of the "if" subschema controls which of the "then" or "else" keywords are evaluated.'),then:localize6("schema.json.then",'The "if" subschema is used for validation when the "if" subschema succeeds.'),else:localize6("schema.json.else",'The "else" subschema is used for validation when the "if" subschema fails.')};for(schemaName in schemaContributions.schemas)for(property in(schema=schemaContributions.schemas[schemaName]).properties)"boolean"==typeof(propertyObject=schema.properties[property])&&(propertyObject=schema.properties[property]={}),(description=descriptions[property])?propertyObject.description=description:console.log(property+": localize('schema.json."+property+'\', "")');import{createScanner as createScanner3}from"jsonc-parser";import{createScanner as createScanner4}from"jsonc-parser";import{format as formatJSON}from"jsonc-parser";function findLinks(e,t){var r=[];return t.visit((function(n){var i;if("property"===n.type&&"$ref"===n.keyNode.value&&"string"===(null===(i=n.valueNode)||void 0===i?void 0:i.type)){var o=n.valueNode.value,s=findTargetNode(t,o);if(s){var a=e.positionAt(s.offset);r.push({target:e.uri+"#"+(a.line+1)+","+(a.character+1),range:createRange(e,n.valueNode)})}}return!0})),Promise.resolve(r)}function createRange(e,t){return Range.create(e.positionAt(t.offset+1),e.positionAt(t.offset+t.length-1))}function findTargetNode(e,t){var r=parseJSONPointer(t);return r?findNode(r,e.root):null}function findNode(e,t){if(!t)return null;if(0===e.length)return t;var r=e.shift();if(t&&"object"===t.type){var n=t.properties.find((function(e){return e.keyNode.value===r}));return n?findNode(e,n.valueNode):null}if(t&&"array"===t.type&&r.match(/^(0|[1-9][0-9]*)$/)){var i=Number.parseInt(r),o=t.items[i];return o?findNode(e,o):null}return null}function parseJSONPointer(e){return"#"===e?[]:"#"!==e[0]||"/"!==e[1]?null:e.substring(2).split(/\//).map(unescape)}function unescape(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}import{URI as URI3}from"vscode-uri";import{Diagnostic as Diagnostic2,DiagnosticSeverity as DiagnosticSeverity2,Range as Range2}from"vscode-languageserver-types";function matchOffsetToDocument(e,t){for(const r of t.documents)if(r.internalDocument&&r.internalDocument.range[0]<=e&&r.internalDocument.range[2]>=e)return r;return 1===t.documents.length?t.documents[0]:null}function filterInvalidCustomTags(e){const t=["mapping","scalar","sequence"];return e?e.filter((e=>{if("string"==typeof e){const r=e.split(" "),n=r[1]&&r[1].toLowerCase()||"scalar";return"map"!==n&&-1!==t.indexOf(n)}return!1})):[]}function isArrayEqual(e,t){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(let r=e.length-1;r>=0;r--)if(e[r]!==t[r])return!1;return!0}var ProblemType,localize7=loadMessageBundle(),MSG_PROPERTY_NOT_ALLOWED="Property {0} is not allowed.",formats2={"color-hex":{errorMessage:localize7("colorHexFormatWarning","Invalid color format. Use #RGB, #RGBA, #RRGGBB or #RRGGBBAA."),pattern:/^#([0-9A-Fa-f]{3,4}|([0-9A-Fa-f]{2}){3,4})$/},"date-time":{errorMessage:localize7("dateTimeFormatWarning","String is not a RFC3339 date-time."),pattern:/^(\d{4})-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])T([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)([01][0-9]|2[0-3]):([0-5][0-9]))$/i},date:{errorMessage:localize7("dateFormatWarning","String is not a RFC3339 date."),pattern:/^(\d{4})-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/i},time:{errorMessage:localize7("timeFormatWarning","String is not a RFC3339 time."),pattern:/^([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)([01][0-9]|2[0-3]):([0-5][0-9]))$/i},email:{errorMessage:localize7("emailFormatWarning","String is not an e-mail address."),pattern:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/},ipv4:{errorMessage:localize7("ipv4FormatWarning","String does not match IPv4 format."),pattern:/^((25[0-5]|(2[0-4]|1\d|[1-9]|)\d)\.?\b){4}$/},ipv6:{errorMessage:localize7("ipv6FormatWarning","String does not match IPv6 format."),pattern:/^([0-9a-f]|:){1,4}(:([0-9a-f]{0,4})*){1,7}$/i}},YAML_SOURCE="YAML",YAML_SCHEMA_PREFIX="yaml-schema: ";!function(e){e.missingRequiredPropWarning="missingRequiredPropWarning",e.typeMismatchWarning="typeMismatchWarning",e.constWarning="constWarning"}(ProblemType||(ProblemType={}));var EnumMatch2,ProblemTypeMessages={[ProblemType.missingRequiredPropWarning]:'Missing property "{0}".',[ProblemType.typeMismatchWarning]:'Incorrect type. Expected "{0}".',[ProblemType.constWarning]:"Value must be {0}."},ASTNodeImpl2=class{constructor(e,t,r,n){this.offset=r,this.length=n,this.parent=e,this.internalNode=t}getNodeFromOffsetEndInclusive(e){const t=[],r=n=>{if(e>=n.offset&&e<=n.offset+n.length){const i=n.children;for(let n=0;n<i.length&&i[n].offset<=e;n++){const e=r(i[n]);e&&t.push(e)}return n}return null},n=r(this);let i=Number.MAX_VALUE,o=null;for(const r of t){const t=r.length+r.offset-e+(e-r.offset);t<i&&(o=r,i=t)}return o||n}get children(){return[]}toString(){return"type: "+this.type+" ("+this.offset+"/"+this.length+")"+(this.parent?" parent: {"+this.parent.toString()+"}":"")}},NullASTNodeImpl2=class extends ASTNodeImpl2{constructor(e,t,r,n){super(e,t,r,n),this.type="null",this.value=null}},BooleanASTNodeImpl2=class extends ASTNodeImpl2{constructor(e,t,r,n,i){super(e,t,n,i),this.type="boolean",this.value=r}},ArrayASTNodeImpl2=class extends ASTNodeImpl2{constructor(e,t,r,n){super(e,t,r,n),this.type="array",this.items=[]}get children(){return this.items}},NumberASTNodeImpl2=class extends ASTNodeImpl2{constructor(e,t,r,n){super(e,t,r,n),this.type="number",this.isInteger=!0,this.value=Number.NaN}},StringASTNodeImpl2=class extends ASTNodeImpl2{constructor(e,t,r,n){super(e,t,r,n),this.type="string",this.value=""}},PropertyASTNodeImpl2=class extends ASTNodeImpl2{constructor(e,t,r,n){super(e,t,r,n),this.type="property",this.colonOffset=-1}get children(){return this.valueNode?[this.keyNode,this.valueNode]:[this.keyNode]}},ObjectASTNodeImpl2=class extends ASTNodeImpl2{constructor(e,t,r,n){super(e,t,r,n),this.type="object",this.properties=[]}get children(){return this.properties}};function asSchema2(e){if(void 0!==e)return isBoolean2(e)?e?{}:{not:{}}:("object"!=typeof e&&(console.warn(`Wrong schema: ${JSON.stringify(e)}, it MUST be an Object or Boolean`),e={type:e}),e)}!function(e){e[e.Key=0]="Key",e[e.Enum=1]="Enum"}(EnumMatch2||(EnumMatch2={}));var SchemaCollector2=class e{constructor(e=-1,t=null){this.focusOffset=e,this.exclude=t,this.schemas=[]}add(e){this.schemas.push(e)}merge(e){this.schemas.push(...e.schemas)}include(e){return(-1===this.focusOffset||contains2(e,this.focusOffset))&&e!==this.exclude}newSub(){return new e(-1,this.exclude)}},NoOpSchemaCollector2=class{constructor(){}get schemas(){return[]}add(e){}merge(e){}include(e){return!0}newSub(){return this}};NoOpSchemaCollector2.instance=new NoOpSchemaCollector2;var ValidationResult2=class{constructor(e){this.problems=[],this.propertiesMatches=0,this.propertiesValueMatches=0,this.primaryValueMatches=0,this.enumValueMatch=!1,this.enumValues=e?[]:null}hasProblems(){return!!this.problems.length}mergeAll(e){for(const t of e)this.merge(t)}merge(e){this.problems=this.problems.concat(e.problems)}mergeEnumValues(e){if(!this.enumValueMatch&&!e.enumValueMatch&&this.enumValues&&e.enumValues){this.enumValues=this.enumValues.concat(e.enumValues);for(const e of this.problems)e.code===ErrorCode.EnumValueMismatch&&(e.message=localize7("enumWarning","Value is not accepted. Valid values: {0}.",[...new Set(this.enumValues)].map((e=>JSON.stringify(e))).join(", ")))}}mergeWarningGeneric(e,t){var r,n;if(null==(r=this.problems)?void 0:r.length)for(const r of t){const t=this.problems.filter((e=>e.problemType===r));for(const i of t){const t=null==(n=e.problems)?void 0:n.find((e=>e.problemType===r&&i.location.offset===e.location.offset&&(r!==ProblemType.missingRequiredPropWarning||isArrayEqual(e.problemArgs,i.problemArgs))));t&&(t.problemArgs.length&&(t.problemArgs.filter((e=>!i.problemArgs.includes(e))).forEach((e=>i.problemArgs.push(e))),i.message=getWarningMessage(i.problemType,i.problemArgs)),this.mergeSources(t,i))}}}mergePropertyMatch(e){this.merge(e),this.propertiesMatches++,(e.enumValueMatch||!e.hasProblems()&&e.propertiesMatches)&&this.propertiesValueMatches++,e.enumValueMatch&&e.enumValues&&this.primaryValueMatches++}mergeSources(e,t){const r=e.source.replace(YAML_SCHEMA_PREFIX,"");t.source.includes(r)||(t.source=t.source+" | "+r),t.schemaUri.includes(e.schemaUri[0])||(t.schemaUri=t.schemaUri.concat(e.schemaUri))}compareGeneric(e){const t=this.hasProblems();return t!==e.hasProblems()?t?-1:1:this.enumValueMatch!==e.enumValueMatch?e.enumValueMatch?-1:1:this.propertiesValueMatches!==e.propertiesValueMatches?this.propertiesValueMatches-e.propertiesValueMatches:this.primaryValueMatches!==e.primaryValueMatches?this.primaryValueMatches-e.primaryValueMatches:this.propertiesMatches-e.propertiesMatches}compareKubernetes(e){const t=this.hasProblems();return this.propertiesMatches!==e.propertiesMatches?this.propertiesMatches-e.propertiesMatches:this.enumValueMatch!==e.enumValueMatch?e.enumValueMatch?-1:1:this.primaryValueMatches!==e.primaryValueMatches?this.primaryValueMatches-e.primaryValueMatches:this.propertiesValueMatches!==e.propertiesValueMatches?this.propertiesValueMatches-e.propertiesValueMatches:t!==e.hasProblems()?t?-1:1:this.propertiesMatches-e.propertiesMatches}};function getNodeValue3(e){switch(e.type){case"array":return e.children.map(getNodeValue3);case"object":{const t=Object.create(null);for(let r=0,n=e.children;r<n.length;r++){const e=n[r],i=e.children[1];i&&(t[e.children[0].value]=getNodeValue3(i))}return t}case"null":case"string":case"number":case"boolean":return e.value;default:return}}function contains2(e,t,r=!1){return t>=e.offset&&t<=e.offset+e.length||r&&t===e.offset+e.length}function findNodeAtOffset2(e,t,r){if(void 0===r&&(r=!1),contains2(e,t,r)){const n=e.children;if(Array.isArray(n))for(let e=0;e<n.length&&n[e].offset<=t;e++){const i=findNodeAtOffset2(n[e],t,r);if(i)return i}return e}}var JSONDocument2=class{constructor(e,t=[],r=[]){this.root=e,this.syntaxErrors=t,this.comments=r}getNodeFromOffset(e,t=!1){if(this.root)return findNodeAtOffset2(this.root,e,t)}getNodeFromOffsetEndInclusive(e){return this.root&&this.root.getNodeFromOffsetEndInclusive(e)}visit(e){if(this.root){const t=r=>{let n=e(r);const i=r.children;if(Array.isArray(i))for(let e=0;e<i.length&&n;e++)n=t(i[e]);return n};t(this.root)}}validate(e,t){if(this.root&&t){const r=new ValidationResult2(this.isKubernetes);return validate2(this.root,t,t,r,NoOpSchemaCollector2.instance,{isKubernetes:this.isKubernetes,disableAdditionalProperties:this.disableAdditionalProperties,uri:this.uri}),r.problems.map((t=>{const r=Range2.create(e.positionAt(t.location.offset),e.positionAt(t.location.offset+t.location.length)),n=Diagnostic2.create(r,t.message,t.severity,t.code?t.code:ErrorCode.Undefined,t.source);return n.data={schemaUri:t.schemaUri,...t.data},n}))}return null}getMatchingSchemas(e,t=-1,r=null,n){const i=new SchemaCollector2(t,r);return this.root&&e&&validate2(this.root,e,e,new ValidationResult2(this.isKubernetes),i,{isKubernetes:this.isKubernetes,disableAdditionalProperties:this.disableAdditionalProperties,uri:this.uri,callFromAutoComplete:n}),i.schemas}};function validate2(e,t,r,n,i,o){const{isKubernetes:s,callFromAutoComplete:a}=o;if(e&&"object"==typeof t){switch(t.url||(t.url=r.url),t.closestTitle=t.title||r.closestTitle,e.type){case"object":!function(e,t,n,i){var a;const l=Object.create(null),c=[],u=[...e.properties];for(;u.length>0;){const e=u.pop(),t=e.keyNode.value;if("<<"===t&&e.valueNode)switch(e.valueNode.type){case"object":u.push(...e.valueNode.properties);break;case"array":e.valueNode.items.forEach((e=>{e&&isIterable(e.properties)&&u.push(...e.properties)}))}else l[t]=e.valueNode,c.push(t)}if(Array.isArray(t.required))for(const i of t.required)if(void 0===l[i]){const o=e.parent&&"property"===e.parent.type&&e.parent.keyNode,s=o?{offset:o.offset,length:o.length}:{offset:e.offset,length:1};n.problems.push({location:s,severity:DiagnosticSeverity2.Warning,message:getWarningMessage(ProblemType.missingRequiredPropWarning,[i]),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r),problemArgs:[i],problemType:ProblemType.missingRequiredPropWarning})}const m=e=>{let t=c.indexOf(e);for(;t>=0;)c.splice(t,1),t=c.indexOf(e)};if(t.properties)for(const e of Object.keys(t.properties)){m(e);const c=t.properties[e],u=l[e];if(u)if(isBoolean2(c))if(c)n.propertiesMatches++,n.propertiesValueMatches++;else{const i=u.parent;n.problems.push({location:{offset:i.keyNode.offset,length:i.keyNode.length},severity:DiagnosticSeverity2.Warning,message:t.errorMessage||localize7("DisallowedExtraPropWarning",MSG_PROPERTY_NOT_ALLOWED,e),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)})}else{c.url=null!=(a=t.url)?a:r.url;const e=new ValidationResult2(s);validate2(u,c,t,e,i,o),n.mergePropertyMatch(e),n.mergeEnumValues(e)}}if(t.patternProperties)for(const e of Object.keys(t.patternProperties)){const a=safeCreateUnicodeRegExp(e);for(const u of c.slice(0))if(a.test(u)){m(u);const a=l[u];if(a){const l=t.patternProperties[e];if(isBoolean2(l))if(l)n.propertiesMatches++,n.propertiesValueMatches++;else{const e=a.parent;n.problems.push({location:{offset:e.keyNode.offset,length:e.keyNode.length},severity:DiagnosticSeverity2.Warning,message:t.errorMessage||localize7("DisallowedExtraPropWarning",MSG_PROPERTY_NOT_ALLOWED,u),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)})}else{const e=new ValidationResult2(s);validate2(a,l,t,e,i,o),n.mergePropertyMatch(e),n.mergeEnumValues(e)}}}}if("object"==typeof t.additionalProperties)for(const e of c){const r=l[e];if(r){const e=new ValidationResult2(s);validate2(r,t.additionalProperties,t,e,i,o),n.mergePropertyMatch(e),n.mergeEnumValues(e)}}else if((!1===t.additionalProperties||"object"===t.type&&void 0===t.additionalProperties&&!0===o.disableAdditionalProperties)&&c.length>0){const e=t.properties&&Object.keys(t.properties).filter((e=>!l[e]));for(const i of c){const o=l[i];if(o){let s=null;"property"!==o.type?(s=o.parent,"object"===s.type&&(s=s.properties[0])):s=o;const a={location:{offset:s.keyNode.offset,length:s.keyNode.length},severity:DiagnosticSeverity2.Warning,message:t.errorMessage||localize7("DisallowedExtraPropWarning",MSG_PROPERTY_NOT_ALLOWED,i),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)};(null==e?void 0:e.length)&&(a.data={properties:e}),n.problems.push(a)}}}isNumber2(t.maxProperties)&&e.properties.length>t.maxProperties&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("MaxPropWarning","Object has more properties than limit of {0}.",t.maxProperties),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)});isNumber2(t.minProperties)&&e.properties.length<t.minProperties&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("MinPropWarning","Object has fewer properties than the required number of {0}",t.minProperties),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)});if(t.dependencies)for(const a of Object.keys(t.dependencies)){if(l[a]){const c=t.dependencies[a];if(Array.isArray(c))for(const i of c)l[i]?n.propertiesValueMatches++:n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("RequiredDependentPropWarning","Object is missing property {0} required by property {1}.",i,a),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)});else{const r=asSchema2(c);if(r){const a=new ValidationResult2(s);validate2(e,r,t,a,i,o),n.mergePropertyMatch(a),n.mergeEnumValues(a)}}}}const h=asSchema2(t.propertyNames);if(h)for(const r of e.properties){const e=r.keyNode;e&&validate2(e,h,t,n,NoOpSchemaCollector2.instance,o)}}(e,t,n,i);break;case"array":!function(e,t,n,i){if(Array.isArray(t.items)){const a=t.items;for(let r=0;r<a.length;r++){const l=asSchema2(a[r]),c=new ValidationResult2(s),u=e.items[r];u?(validate2(u,l,t,c,i,o),n.mergePropertyMatch(c),n.mergeEnumValues(c)):e.items.length>=a.length&&n.propertiesValueMatches++}if(e.items.length>a.length)if("object"==typeof t.additionalItems)for(let r=a.length;r<e.items.length;r++){const a=new ValidationResult2(s);validate2(e.items[r],t.additionalItems,t,a,i,o),n.mergePropertyMatch(a),n.mergeEnumValues(a)}else!1===t.additionalItems&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("additionalItemsWarning","Array has too many items according to schema. Expected {0} or fewer.",a.length),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)})}else{const r=asSchema2(t.items);if(r){const a=new ValidationResult2(s);e.items.forEach((e=>{if(r.oneOf&&1===r.oneOf.length){const s={...asSchema2(r.oneOf[0])};s.title=t.title,s.closestTitle=t.closestTitle,validate2(e,s,t,a,i,o),n.mergePropertyMatch(a),n.mergeEnumValues(a)}else validate2(e,r,t,a,i,o),n.mergePropertyMatch(a),n.mergeEnumValues(a)}))}}const a=asSchema2(t.contains);if(a){e.items.some((e=>{const r=new ValidationResult2(s);return validate2(e,a,t,r,NoOpSchemaCollector2.instance,o),!r.hasProblems()}))||n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:t.errorMessage||localize7("requiredItemMissingWarning","Array does not contain required item."),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)})}isNumber2(t.minItems)&&e.items.length<t.minItems&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("minItemsWarning","Array has too few items. Expected {0} or more.",t.minItems),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)});isNumber2(t.maxItems)&&e.items.length>t.maxItems&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("maxItemsWarning","Array has too many items. Expected {0} or fewer.",t.maxItems),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)});if(!0===t.uniqueItems){const i=getNodeValue3(e);i.some(((e,t)=>t!==i.lastIndexOf(e)))&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("uniqueItemsWarning","Array has duplicate items."),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)})}}(e,t,n,i);break;case"string":!function(e,t,n){isNumber2(t.minLength)&&e.value.length<t.minLength&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("minLengthWarning","String is shorter than the minimum length of {0}.",t.minLength),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)});isNumber2(t.maxLength)&&e.value.length>t.maxLength&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("maxLengthWarning","String is longer than the maximum length of {0}.",t.maxLength),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)});if(isString2(t.pattern)){safeCreateUnicodeRegExp(t.pattern).test(e.value)||n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:t.patternErrorMessage||t.errorMessage||localize7("patternWarning",'String does not match the pattern of "{0}".',t.pattern),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)})}if(t.format)switch(t.format){case"uri":case"uri-reference":{let i;if(e.value)try{URI3.parse(e.value).scheme||"uri"!==t.format||(i=localize7("uriSchemeMissing","URI with a scheme is expected."))}catch(e){i=e.message}else i=localize7("uriEmpty","URI expected.");i&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:t.patternErrorMessage||t.errorMessage||localize7("uriFormatWarning","String is not a URI: {0}",i),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)})}break;case"color-hex":case"date-time":case"date":case"time":case"email":case"ipv4":case"ipv6":{const i=formats2[t.format];e.value&&i.pattern.test(e.value)||n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:t.patternErrorMessage||t.errorMessage||i.errorMessage,source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)})}}}(e,t,n);break;case"number":!function(e,t,n){const i=e.value;isNumber2(t.multipleOf)&&i%t.multipleOf!=0&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("multipleOfWarning","Value is not divisible by {0}.",t.multipleOf),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)});function o(e,t){return isNumber2(t)?t:isBoolean2(t)&&t?e:void 0}function s(e,t){if(!isBoolean2(t)||!t)return e}const a=o(t.minimum,t.exclusiveMinimum);isNumber2(a)&&i<=a&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("exclusiveMinimumWarning","Value is below the exclusive minimum of {0}.",a),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)});const l=o(t.maximum,t.exclusiveMaximum);isNumber2(l)&&i>=l&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("exclusiveMaximumWarning","Value is above the exclusive maximum of {0}.",l),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)});const c=s(t.minimum,t.exclusiveMinimum);isNumber2(c)&&i<c&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("minimumWarning","Value is below the minimum of {0}.",c),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)});const u=s(t.maximum,t.exclusiveMaximum);isNumber2(u)&&i>u&&n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("maximumWarning","Value is above the maximum of {0}.",u),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)})}(e,t,n);break;case"property":return validate2(e.valueNode,t,t,n,i,o)}!function(){function u(t){return e.type===t||"integer"===t&&"number"===e.type&&e.isInteger}if(Array.isArray(t.type))t.type.some(u)||n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:t.errorMessage||localize7("typeArrayMismatchWarning","Incorrect type. Expected one of {0}.",t.type.join(", ")),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)});else if(t.type&&!u(t.type)){const i="object"===t.type?getSchemaTypeName(t):t.type;n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:t.errorMessage||getWarningMessage(ProblemType.typeMismatchWarning,[i]),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r),problemType:ProblemType.typeMismatchWarning,problemArgs:[i]})}if(Array.isArray(t.allOf))for(const r of t.allOf)validate2(e,asSchema2(r),t,n,i,o);const m=asSchema2(t.not);if(m){const a=new ValidationResult2(s),l=i.newSub();validate2(e,m,t,a,l,o),a.hasProblems()||n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("notSchemaWarning","Matches a schema that is not allowed."),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)});for(const e of l.schemas)e.inverted=!e.inverted,i.add(e)}const h=(u,m)=>{var h;const p=[],f=[],d=[];let g=null;for(const r of u){const n={...asSchema2(r)},u=new ValidationResult2(s),h=i.newSub();validate2(e,n,t,u,h,o),u.hasProblems()&&!a||(p.push(n),f.push(n),0===u.propertiesMatches&&d.push(n),n.format&&f.pop()),g=g?s?l(u,g,n,h):c(e,m,u,g,n,h):{schema:n,validationResult:u,matchingSchemas:h}}return f.length>1&&(f.length>1||0===d.length)&&m&&n.problems.push({location:{offset:e.offset,length:1},severity:DiagnosticSeverity2.Warning,message:localize7("oneOfWarning","Matches multiple schemas when only one must validate."),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)}),null!==g&&(n.merge(g.validationResult),n.propertiesMatches+=g.validationResult.propertiesMatches,n.propertiesValueMatches+=g.validationResult.propertiesValueMatches,n.enumValueMatch=n.enumValueMatch||g.validationResult.enumValueMatch,(null==(h=g.validationResult.enumValues)?void 0:h.length)&&(n.enumValues=(n.enumValues||[]).concat(g.validationResult.enumValues)),i.merge(g.matchingSchemas)),p.length};Array.isArray(t.anyOf)&&h(t.anyOf,!1);Array.isArray(t.oneOf)&&h(t.oneOf,!0);const p=(t,r)=>{const a=new ValidationResult2(s),l=i.newSub();validate2(e,asSchema2(t),r,a,l,o),n.merge(a),n.propertiesMatches+=a.propertiesMatches,n.propertiesValueMatches+=a.propertiesValueMatches,i.merge(l)},f=asSchema2(t.if);f&&((r,n,a,l)=>{const c=asSchema2(r),u=new ValidationResult2(s),m=i.newSub();validate2(e,c,n,u,m,o),i.merge(m);const{filePatternAssociation:h}=c;h&&(new FilePatternAssociation2(h).matchesPattern(o.uri)||u.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,message:localize7("ifFilePatternAssociation",`filePatternAssociation '${h}' does not match with doc uri '${o.uri}'.`),source:getSchemaSource(t,n),schemaUri:getSchemaUri(t,n)}));u.hasProblems()?l&&p(l,n):a&&p(a,n)})(f,t,asSchema2(t.then),asSchema2(t.else));if(Array.isArray(t.enum)){const i=getNodeValue3(e);let o=!1;for(const e of t.enum)if(equals2(i,e)||a&&isString2(i)&&isString2(e)&&i&&e.startsWith(i)){o=!0;break}n.enumValues=t.enum,n.enumValueMatch=o,o||n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,code:ErrorCode.EnumValueMismatch,message:t.errorMessage||localize7("enumWarning","Value is not accepted. Valid values: {0}.",t.enum.map((e=>JSON.stringify(e))).join(", ")),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)})}if(isDefined2(t.const)){const i=getNodeValue3(e);equals2(i,t.const)||a&&isString2(i)&&isString2(t.const)&&t.const.startsWith(i)?n.enumValueMatch=!0:(n.problems.push({location:{offset:e.offset,length:e.length},severity:DiagnosticSeverity2.Warning,code:ErrorCode.EnumValueMismatch,problemType:ProblemType.constWarning,message:t.errorMessage||getWarningMessage(ProblemType.constWarning,[JSON.stringify(t.const)]),source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r),problemArgs:[JSON.stringify(t.const)]}),n.enumValueMatch=!1),n.enumValues=[t.const]}t.deprecationMessage&&e.parent&&n.problems.push({location:{offset:e.parent.offset,length:e.parent.length},severity:DiagnosticSeverity2.Warning,message:t.deprecationMessage,source:getSchemaSource(t,r),schemaUri:getSchemaUri(t,r)})}(),i.add({node:e,schema:t})}function l(e,t,r,n){const i=e.compareKubernetes(t.validationResult);return i>0?t={schema:r,validationResult:e,matchingSchemas:n}:0===i&&(t.matchingSchemas.merge(n),t.validationResult.mergeEnumValues(e)),t}function c(e,t,r,n,i,o){if(t||r.hasProblems()||n.validationResult.hasProblems()&&!a){const s=r.compareGeneric(n.validationResult);s>0||0===s&&t&&"object"===n.schema.type&&"null"!==e.type&&e.type!==n.schema.type?n={schema:i,validationResult:r,matchingSchemas:o}:0===s&&(n.matchingSchemas.merge(o),n.validationResult.mergeEnumValues(r),n.validationResult.mergeWarningGeneric(r,[ProblemType.missingRequiredPropWarning,ProblemType.typeMismatchWarning,ProblemType.constWarning]))}else n.matchingSchemas.merge(o),n.validationResult.propertiesMatches+=r.propertiesMatches,n.validationResult.propertiesValueMatches+=r.propertiesValueMatches;return n}}function getSchemaSource(e,t){var r;if(e){let n;if(e.title)n=e.title;else if(e.closestTitle)n=e.closestTitle;else if(t.closestTitle)n=t.closestTitle;else{const i=null!=(r=e.url)?r:t.url;if(i){const e=URI3.parse(i);"file"===e.scheme&&(n=e.fsPath),n=e.toString()}}if(n)return`${YAML_SCHEMA_PREFIX}${n}`}return YAML_SOURCE}function getSchemaUri(e,t){var r;const n=null!=(r=e.url)?r:t.url;return n?[n]:[]}function getWarningMessage(e,t){return localize7(e,ProblemTypeMessages[e],t.join(" | "))}import{isNode as isNode2,isPair as isPair2,isScalar as isScalar3,visit as visit2}from"yaml";import{isScalar,isMap,isPair,isSeq,isNode,isAlias}from"yaml";var maxRefCount=1e3,refDepth=0,seenAlias=new Set;function convertAST(e,t,r,n){if(e||(refDepth=0),!t)return null;if(isMap(t))return convertMap(t,e,r,n);if(isPair(t))return convertPair(t,e,r,n);if(isSeq(t))return convertSeq(t,e,r,n);if(isScalar(t))return convertScalar(t,e);if(isAlias(t)&&!seenAlias.has(t)&&refDepth<maxRefCount){seenAlias.add(t);const i=convertAlias(t,e,r,n);return seenAlias.delete(t),i}}function convertMap(e,t,r,n){let i;i=e.flow&&!e.range?collectFlowMapRange(e):e.range;const o=new ObjectASTNodeImpl2(t,e,...toFixedOffsetLength(i,n));for(const t of e.items)isPair(t)&&o.properties.push(convertAST(o,t,r,n));return o}function convertPair(e,t,r,n){const i=e.key,o=e.value,s=i.range[0];let a=i.range[1],l=i.range[2];o&&(a=o.range[1],l=o.range[2]);const c=new PropertyASTNodeImpl2(t,e,...toFixedOffsetLength([s,a,l],n));if(isAlias(i)){const e=new StringASTNodeImpl2(t,i,...toOffsetLength(i.range));e.value=i.source,c.keyNode=e}else c.keyNode=convertAST(c,i,r,n);return c.valueNode=convertAST(c,o,r,n),c}function convertSeq(e,t,r,n){const i=new ArrayASTNodeImpl2(t,e,...toOffsetLength(e.range));for(const t of e.items)if(isNode(t)){const e=convertAST(i,t,r,n);e&&i.children.push(e)}return i}function convertScalar(e,t){if(null===e.value)return new NullASTNodeImpl2(t,e,...toOffsetLength(e.range));switch(typeof e.value){case"string":{const r=new StringASTNodeImpl2(t,e,...toOffsetLength(e.range));return r.value=e.value,r}case"boolean":return new BooleanASTNodeImpl2(t,e,e.value,...toOffsetLength(e.range));case"number":{const r=new NumberASTNodeImpl2(t,e,...toOffsetLength(e.range));return r.value=e.value,r.isInteger=Number.isInteger(r.value),r}default:{const r=new StringASTNodeImpl2(t,e,...toOffsetLength(e.range));return r.value=e.source,r}}}function convertAlias(e,t,r,n){refDepth++;const i=e.resolve(r);if(i)return convertAST(t,i,r,n);{const r=new StringASTNodeImpl2(t,e,...toOffsetLength(e.range));return r.value=e.source,r}}function toOffsetLength(e){return[e[0],e[1]-e[0]]}function toFixedOffsetLength(e,t){const r=t.linePos(e[0]),n=t.linePos(e[1]),i=[e[0],e[1]-e[0]];return r.line===n.line||t.lineStarts.length===n.line&&1!==n.col||i[1]--,i}function collectFlowMapRange(e){let t=Number.MAX_SAFE_INTEGER,r=0;for(const n of e.items)isPair(n)&&(isNode(n.key)&&n.key.range&&n.key.range[0]<=t&&(t=n.key.range[0]),isNode(n.value)&&n.value.range&&n.value.range[2]>=r&&(r=n.value.range[2]));return[t,r,r]}import{isDocument,isScalar as isScalar2,visit}from"yaml";function getParent(e,t){let r;if(visit(e,((e,n,i)=>{if(n===t)return r=i[i.length-1],visit.BREAK})),!isDocument(r))return r}function isMapContainsEmptyPair(e){if(e.items.length>1)return!1;const t=e.items[0];return isScalar2(t.key)&&isScalar2(t.value)&&""===t.key.value&&!t.value.value}function indexOf(e,t){for(const[r,n]of e.items.entries())if(t===n)return r}function isInComment(e,t){let r=!1;for(const n of e){if("document"===n.type)_visit([],n,(e=>{var i;if(isCollectionItem(e)&&"comment"===(null==(i=e.value)?void 0:i.type)){if(n.offset<=t&&e.value.source.length+e.value.offset>=t)return r=!0,visit.BREAK}else if("comment"===e.type&&e.offset<=t&&e.offset+e.source.length>=t)return r=!0,visit.BREAK}));else if("comment"===n.type&&n.offset<=t&&n.source.length+n.offset>=t)return!0;if(r)break}return r}function isCollectionItem(e){return void 0!==e.start}function _visit(e,t,r){let n=r(t,e);if("symbol"==typeof n)return n;for(const i of["key","value"]){const o=t[i];if(o&&"items"in o){for(let t=0;t<o.items.length;++t){const n=_visit(Object.freeze(e.concat([[i,t]])),o.items[t],r);if("number"==typeof n)t=n-1;else{if(n===visit.BREAK)return visit.BREAK;n===visit.REMOVE&&(o.items.splice(t,1),t-=1)}}"function"==typeof n&&"key"===i&&(n=n(t,e))}}const i=t.sep;if(i)for(let t=0;t<i.length;++t){const n=_visit(Object.freeze(e),i[t],r);if("number"==typeof n)t=n-1;else{if(n===visit.BREAK)return visit.BREAK;n===visit.REMOVE&&(i.items.splice(t,1),t-=1)}}return"function"==typeof n?n(t,e):n}var SingleYAMLDocument=class e extends JSONDocument2{constructor(e){super(null,[]),this.lineCounter=e}clone(){const t=new e(this.lineCounter);return t.isKubernetes=this.isKubernetes,t.disableAdditionalProperties=this.disableAdditionalProperties,t.uri=this.uri,t.currentDocIndex=this.currentDocIndex,t._lineComments=this.lineComments.slice(),t.internalDocument=this._internalDocument.clone(),t}collectLineComments(){if(this._lineComments=[],this._internalDocument.commentBefore){this._internalDocument.commentBefore.split("\n").forEach((e=>this._lineComments.push(`#${e}`)))}visit2(this.internalDocument,((e,t)=>{if(null==t?void 0:t.commentBefore){(null==t?void 0:t.commentBefore.split("\n")).forEach((e=>this._lineComments.push(`#${e}`)))}(null==t?void 0:t.comment)&&this._lineComments.push(`#${t.comment}`)})),this._internalDocument.comment&&this._lineComments.push(`#${this._internalDocument.comment}`)}updateFromInternalDocument(){this.root=convertAST(null,this._internalDocument.contents,this._internalDocument,this.lineCounter)}set internalDocument(e){this._internalDocument=e,this.updateFromInternalDocument()}get internalDocument(){return this._internalDocument}get lineComments(){return this._lineComments||this.collectLineComments(),this._lineComments}set lineComments(e){this._lineComments=e}get errors(){return this.internalDocument.errors.map(YAMLErrorToYamlDocDiagnostics)}get warnings(){return this.internalDocument.warnings.map(YAMLErrorToYamlDocDiagnostics)}getNodeFromPosition(e,t,r){const n=t.getPosition(e),i=t.getLineContent(n.line);if(0===i.trim().length)return[this.findClosestNode(e,t,r),!0];const o=i.substring(n.character).match(/^([ ]+)\n?$/),s=!!o,a=null==o?void 0:o[1].length;let l;return visit2(this.internalDocument,((t,r)=>{if(!r)return;const n=r.range;if(!n)return;if(!(n[0]<=e&&n[1]>=e||s&&e+a===n[2]&&isScalar3(r)&&null===r.value))return visit2.SKIP;l=r})),[l,!1]}findClosestNode(e,t,r){let n,i=this.internalDocument.range[2],o=this.internalDocument.range[0];visit2(this.internalDocument,((t,r)=>{if(!r)return;const s=r.range;if(!s)return;const a=s[1]-e;o<=s[0]&&a<=0&&Math.abs(a)<=i&&(i=Math.abs(a),o=s[0],n=r)}));const s=t.getPosition(e),a=getIndentation(t.getLineContent(s.line),s.character);return isScalar3(n)&&null===n.value||a===s.character&&(n=this.getProperParentByIndentation(a,n,t,"",r)),n}getProperParentByIndentation(e,t,r,n,i,o){if(!t)return this.internalDocument.contents;if(i=i||2,isNode2(t)&&t.range){const s=r.getPosition(t.range[0]),a=r.getLineContent(s.line);if((n=""===n?a.trim():n).startsWith("-")&&e===i&&n===a.trim()&&(s.character+=e),s.character>e&&s.character>0){const s=this.getParent(t);if(s)return this.getProperParentByIndentation(e,s,r,n,i,o)}else{if(!(s.character<e))return t;{const e=this.getParent(t);if(isPair2(e)&&isNode2(e.value))return e.value;if(isPair2(o)&&isNode2(o.value))return o.value}}}else if(isPair2(t)){o=t;const s=this.getParent(t);return this.getProperParentByIndentation(e,s,r,n,i,o)}return t}getParent(e){return getParent(this.internalDocument,e)}},YAMLDocument=class{constructor(e,t){this.documents=e,this.tokens=t,this.errors=[],this.warnings=[]}},YamlDocuments=class{constructor(){this.cache=new Map}getYamlDocument(e,t,r=!1){return this.ensureCache(e,null!=t?t:defaultOptions,r),this.cache.get(e.uri).document}clear(){this.cache.clear()}ensureCache(e,t,r){const n=e.uri;this.cache.has(n)||this.cache.set(n,{version:-1,document:new YAMLDocument([],[]),parserOptions:defaultOptions});const i=this.cache.get(n);if(i.version!==e.version||t.customTags&&!isArrayEqual(i.parserOptions.customTags,t.customTags)){let n=e.getText();r&&!/\S/.test(n)&&(n=`{${n}}`);const o=parse3(n,t,e);i.document=o,i.version=e.version,i.parserOptions=t}}},yamlDocumentsCache=new YamlDocuments;function YAMLErrorToYamlDocDiagnostics(e){return{message:e.message,location:{start:e.pos[0],end:e.pos[1],toLineEnd:!0},severity:1,code:ErrorCode.Undefined}}import{isSeq as isSeq2,isMap as isMap2}from"yaml";var CommonTagImpl=class{constructor(e,t){this.tag=e,this.type=t}get collection(){return"mapping"===this.type?"map":"sequence"===this.type?"seq":void 0}resolve(e){return isMap2(e)&&"mapping"===this.type||isSeq2(e)&&"sequence"===this.type||"string"==typeof e&&"scalar"===this.type?e:void 0}},IncludeTag=class{constructor(){this.tag="!include",this.type="scalar"}resolve(e,t){if(e&&e.length>0&&e.trim())return e;t("!include without value")}};function getCustomTags(e){const t=[],r=filterInvalidCustomTags(e);for(const e of r){const r=e.split(" "),n=r[0],i=r[1]&&r[1].toLowerCase()||"scalar";t.push(new CommonTagImpl(n,i))}return t.push(new IncludeTag),t}import{Range as Range3}from"vscode-languageserver-types";var TextBuffer=class{constructor(e){this.doc=e}getLineCount(){return this.doc.lineCount}getLineLength(e){const t=this.doc.getLineOffsets();if(e>=t.length)return this.doc.getText().length;if(e<0)return 0;return(e+1<t.length?t[e+1]:this.doc.getText().length)-t[e]}getLineContent(e){const t=this.doc.getLineOffsets();if(e>=t.length)return this.doc.getText();if(e<0)return"";const r=e+1<t.length?t[e+1]:this.doc.getText().length;return this.doc.getText().substring(t[e],r)}getLineCharCode(e,t){return this.doc.getText(Range3.create(e-1,t,e-1,t+1)).charCodeAt(0)}getText(e){return this.doc.getText(e)}getPosition(e){return this.doc.positionAt(e)}},defaultOptions={customTags:[],yamlVersion:"1.2"};function parse3(e,t=defaultOptions,r){var n;const i={strict:!1,customTags:getCustomTags(t.customTags),version:null!=(n=t.yamlVersion)?n:defaultOptions.yamlVersion,keepSourceTokens:!0},o=new Composer(i),s=new LineCounter;let a=!1;if(r){const t=new TextBuffer(r),n=t.getPosition(e.length);a=0===t.getLineContent(n.line).trim().length}const l=(a?new Parser:new Parser(s.addNewLine)).parse(e),c=Array.from(l),u=o.compose(c,!0,e.length),m=Array.from(u,(e=>parsedDocToSingleYAMLDocument(e,s)));return new YAMLDocument(m,c)}function parsedDocToSingleYAMLDocument(e,t){const r=new SingleYAMLDocument(t);return r.internalDocument=e,r}function getSchemaFromModeline(e){if(e instanceof SingleYAMLDocument){const t=e.lineComments.find((e=>isModeline(e)));if(null!=t){const e=t.match(/\$schema=\S+/g);if(null!==e&&e.length>=1)return e.length>=2&&console.log("Several $schema attributes have been found on the yaml-language-server modeline. The first one will be picked."),e[0].substring(8)}}}function isModeline(e){const t=e.match(/^#\s+yaml-language-server\s*:/g);return null!==t&&1===t.length}var MODIFICATION_ACTIONS,AJVStub=class{compile(){return()=>!0}},localize8=loadMessageBundle(),ajv=new AJVStub,jsonSchema07=void 0,schema07Validator=ajv.compile(jsonSchema07);!function(e){e[e.delete=0]="delete",e[e.add=1]="add",e[e.deleteAll=2]="deleteAll"}(MODIFICATION_ACTIONS||(MODIFICATION_ACTIONS={}));var FilePatternAssociation2=class{constructor(e){try{this.patternRegExp=new RegExp(convertSimple2RegExpPattern(e)+"$")}catch(e){this.patternRegExp=null}this.schemas=[]}addSchema(e){this.schemas.push(e)}matchesPattern(e){return this.patternRegExp&&this.patternRegExp.test(e)}getSchemas(){return this.schemas}},YAMLSchemaService=class extends JSONSchemaService{constructor(e,t,r){super(e,t,r),this.schemaUriToNameAndDescription=new Map,this.customSchemaProvider=void 0,this.requestService=e,this.schemaPriorityMapping=new Map}registerCustomSchemaProvider(e){this.customSchemaProvider=e}getAllSchemas(){const e=[],t=new Set;for(const r of this.filePatternAssociations){const n=r.uris[0];if(t.has(n))continue;t.add(n);const i={uri:n,fromStore:!1,usedForCurrentFile:!1};if(this.schemaUriToNameAndDescription.has(n)){const{name:e,description:t,versions:r}=this.schemaUriToNameAndDescription.get(n);i.name=e,i.description=t,i.fromStore=!0,i.versions=r}e.push(i)}return e}async resolveSchemaContent(e,t,r){const n=e.errors.slice(0);let i=e.schema;const o=this.contextService;if(!schema07Validator(i)){const r=[];for(const e of schema07Validator.errors)r.push(`${e.instancePath} : ${e.message}`);n.push(`Schema '${getSchemaTitle(e.schema,t)}' is not valid:\n${r.join("\n")}`)}const s=(e,t,r,i)=>{const o=((e,t)=>{if(!t)return e;let r=e;return"/"===t[0]&&(t=t.substr(1)),t.split("/").some((e=>(r=r[e],!r))),r})(t,i);if(o)for(const t in o)Object.prototype.hasOwnProperty.call(o,t)&&!Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=o[t]);else n.push(localize8("json.schema.invalidref","$ref '{0}' in '{1}' can not be resolved.",i,r))},a=(e,t,r,i,a)=>{o&&!/^\w+:\/\/.*/.test(t)&&(t=o.resolveRelativePath(t,i)),t=this.normalizeId(t);const c=this.getOrAddSchemaHandle(t);return c.getUnresolvedSchema().then((i=>{if(a[t]=!0,i.errors.length){const e=r?t+"#"+r:t;n.push(localize8("json.schema.problemloadingref","Problems loading reference '{0}': {1}",e,i.errors[0]))}return s(e,i.schema,t,r),e.url=t,l(e,i.schema,t,c.dependencies)}))},l=async(e,t,r,n)=>{if(!e||"object"!=typeof e)return null;const o=[e],l=[],c=[],u=e=>{const i=[];for(;e.$ref;){const o=e.$ref,l=o.split("#",2);if(e._$ref=e.$ref,delete e.$ref,l[0].length>0)return void c.push(a(e,l[0],l[1],r,n));-1===i.indexOf(o)&&(s(e,t,r,l[1]),i.push(o))}((...e)=>{for(const t of e)"object"==typeof t&&o.push(t)})(e.items,e.additionalItems,e.additionalProperties,e.not,e.contains,e.propertyNames,e.if,e.then,e.else),((...e)=>{for(const t of e)if("object"==typeof t)for(const e in t){const r=t[e];"object"==typeof r&&o.push(r)}})(e.definitions,e.properties,e.patternProperties,e.dependencies),((...e)=>{for(const t of e)if(Array.isArray(t))for(const e of t)"object"==typeof e&&o.push(e)})(e.anyOf,e.allOf,e.oneOf,e.items,e.schemaSequence)};if(r.indexOf("#")>0){const e=r.split("#",2);if(e[0].length>0&&e[1].length>0){const t={};await a(t,e[0],e[1],r,n);for(const e in i)"required"!==e&&Object.prototype.hasOwnProperty.call(i,e)&&!Object.prototype.hasOwnProperty.call(t,e)&&(t[e]=i[e]);i=t}}for(;o.length;){const e=o.pop();l.indexOf(e)>=0||(l.push(e),u(e))}return Promise.all(c)};return await l(i,i,t,r),new ResolvedSchema(i,n)}getSchemaForResource(e,t){const r=r=>{const n=super.createCombinedSchema(e,r);return n.getResolvedSchema().then((e=>(e.schema&&"object"==typeof e.schema&&(e.schema.url=n.url),e.schema&&e.schema.schemaSequence&&e.schema.schemaSequence[t.currentDocIndex]?new ResolvedSchema(e.schema.schemaSequence[t.currentDocIndex]):e)))},n=()=>{const t=Object.create(null),n=[];for(const r of this.filePatternAssociations)if(r.matchesPattern(e))for(const e of r.getURIs())t[e]||(n.push(e),t[e]=!0);if(n.length>0){const e=this.highestPrioritySchemas(n);return r(e)}return Promise.resolve(null)},i=(()=>{let r=getSchemaFromModeline(t);if(void 0!==r){if(!r.startsWith("file:")&&!r.startsWith("http")){let t="";if(r.indexOf("#")>0){const e=r.split("#",2);r=e[0],t=e[1]}if(path2.isAbsolute(r))r=URI4.file(r).toString();else{const t=URI4.parse(e);r=URI4.file(path2.resolve(path2.parse(t.fsPath).dir,r)).toString()}t.length>0&&(r+="#"+t)}return r}})();return i?r([i]):this.customSchemaProvider?this.customSchemaProvider(e).then((e=>Array.isArray(e)?0===e.length?n():Promise.all(e.map((e=>this.resolveCustomSchema(e,t)))).then((e=>({errors:[],schema:{allOf:e.map((e=>e.schema))}})),(()=>n())):e?this.resolveCustomSchema(e,t):n())).then((e=>e),(()=>n())):n()}addSchemaPriority(e,t){let r=this.schemaPriorityMapping.get(e);r?(r=r.add(t),this.schemaPriorityMapping.set(e,r)):this.schemaPriorityMapping.set(e,(new Set).add(t))}highestPrioritySchemas(e){let t=0;const r=new Map;return e.forEach((e=>{(this.schemaPriorityMapping.get(e)||[0]).forEach((n=>{n>t&&(t=n);let i=r.get(n);i?(i=i.concat(e),r.set(n,i)):r.set(n,[e])}))})),r.get(t)||[]}async resolveCustomSchema(e,t){const r=await this.loadSchema(e),n=await this.resolveSchemaContent(r,e,[]);return n.schema&&"object"==typeof n.schema&&(n.schema.url=e),n.schema&&n.schema.schemaSequence&&n.schema.schemaSequence[t.currentDocIndex]?new ResolvedSchema(n.schema.schemaSequence[t.currentDocIndex],n.errors):n}async saveSchema(e,t){const r=this.normalizeId(e);return this.getOrAddSchemaHandle(r,t),this.schemaPriorityMapping.set(r,(new Set).add(SchemaPriority.Settings)),Promise.resolve(void 0)}async deleteSchemas(e){return e.schemas.forEach((e=>{this.deleteSchema(e)})),Promise.resolve(void 0)}async deleteSchema(e){const t=this.normalizeId(e);return this.schemasById[t]&&delete this.schemasById[t],this.schemaPriorityMapping.delete(t),Promise.resolve(void 0)}async addContent(e){const t=await this.getResolvedSchema(e.schema);if(t){const r=this.resolveJSONSchemaToSection(t.schema,e.path);"object"==typeof r&&(r[e.key]=e.content),await this.saveSchema(e.schema,t.schema)}}async deleteContent(e){const t=await this.getResolvedSchema(e.schema);if(t){const r=this.resolveJSONSchemaToSection(t.schema,e.path);"object"==typeof r&&delete r[e.key],await this.saveSchema(e.schema,t.schema)}}resolveJSONSchemaToSection(e,t){const r=t.split("/");let n=e;for(const e of r)""!==e&&(this.resolveNext(n,e),n=n[e]);return n}resolveNext(e,t){if(Array.isArray(e)&&isNaN(t))throw new Error("Expected a number after the array object");if("object"==typeof e&&"string"!=typeof t)throw new Error("Expected a string after the object")}normalizeId(e){try{return URI4.parse(e).toString()}catch(t){return e}}getOrAddSchemaHandle(e,t){return super.getOrAddSchemaHandle(e,t)}loadSchema(e){const t=this.requestService;return super.loadSchema(e).then((r=>{if(r.errors&&void 0===r.schema)return t(e).then((t=>{if(!t){const t=localize8("json.schema.nocontent","Unable to load schema from '{0}': No content. {1}",toDisplayString2(e),r.errors);return new UnresolvedSchema({},[t])}try{const e=parse4(t);return new UnresolvedSchema(e,[])}catch(t){const r=localize8("json.schema.invalidFormat","Unable to parse content from '{0}': {1}.",toDisplayString2(e),t);return new UnresolvedSchema({},[r])}}),(e=>{let t=e.toString();const r=e.toString().split("Error: ");return r.length>1&&(t=r[1]),new UnresolvedSchema({},[t])}));if(r.uri=e,this.schemaUriToNameAndDescription.has(e)){const{name:t,description:n,versions:i}=this.schemaUriToNameAndDescription.get(e);r.schema.title=null!=t?t:r.schema.title,r.schema.description=null!=n?n:r.schema.description,r.schema.versions=null!=i?i:r.schema.versions}return r}))}registerExternalSchema(e,t,r,n,i,o){return(n||i)&&this.schemaUriToNameAndDescription.set(e,{name:n,description:i,versions:o}),super.registerExternalSchema(e,t,r)}clearExternalSchemas(){super.clearExternalSchemas()}setSchemaContributions(e){super.setSchemaContributions(e)}getRegisteredSchemaIds(e){return super.getRegisteredSchemaIds(e)}getResolvedSchema(e){return super.getResolvedSchema(e)}onResourceChange(e){return super.onResourceChange(e)}};function toDisplayString2(e){try{const t=URI4.parse(e);if("file"===t.scheme)return t.fsPath}catch(e){}return e}import{isMap as isMap3,isSeq as isSeq3}from"yaml";var YAMLDocumentSymbols=class{constructor(e,t){this.telemetry=t,this.jsonDocumentSymbols=new JSONDocumentSymbols(e),this.jsonDocumentSymbols.getKeyLabel=e=>{const t=e.keyNode.internalNode;let r="";return r=isMap3(t)?"{}":isSeq3(t)?"[]":t.source,r}}findDocumentSymbols(e,t={resultLimit:Number.MAX_VALUE}){var r;let n=[];try{const r=yamlDocumentsCache.getYamlDocument(e);if(!r||0===r.documents.length)return null;for(const i of r.documents)i.root&&(n=n.concat(this.jsonDocumentSymbols.findDocumentSymbols(e,i,t)))}catch(e){null==(r=this.telemetry)||r.sendError("yaml.documentSymbols.error",{error:convertErrorToTelemetryMsg(e)})}return n}findHierarchicalDocumentSymbols(e,t={resultLimit:Number.MAX_VALUE}){var r;let n=[];try{const r=yamlDocumentsCache.getYamlDocument(e);if(!r||0===r.documents.length)return null;for(const i of r.documents)i.root&&(n=n.concat(this.jsonDocumentSymbols.findDocumentSymbols2(e,i,t)))}catch(e){null==(r=this.telemetry)||r.sendError("yaml.hierarchicalDocumentSymbols.error",{error:convertErrorToTelemetryMsg(e)})}return n}};import{MarkupKind as MarkupKind2,Range as Range4}from"vscode-languageserver-types";function setKubernetesParserOption(e,t){for(const r of e)r.isKubernetes=t}import{URI as URI5}from"vscode-uri";import*as path3 from"path-browserify";var YAMLHover=class{constructor(e,t){this.telemetry=t,this.shouldHover=!0,this.schemaService=e}configure(e){e&&(this.shouldHover=e.hover,this.indentation=e.indentation)}doHover(e,t,r=!1){var n;try{if(!this.shouldHover||!e)return Promise.resolve(void 0);const n=yamlDocumentsCache.getYamlDocument(e),i=matchOffsetToDocument(e.offsetAt(t),n);if(null===i)return Promise.resolve(void 0);setKubernetesParserOption(n.documents,r);const o=n.documents.indexOf(i);return i.currentDocIndex=o,this.getHover(e,t,i)}catch(e){null==(n=this.telemetry)||n.sendError("yaml.hover.error",{error:convertErrorToTelemetryMsg(e)})}}getHover(e,t,r){const n=e.offsetAt(t);let i=r.getNodeFromOffset(n);if(!i||("object"===i.type||"array"===i.type)&&n>i.offset+1&&n<i.offset+i.length-1)return Promise.resolve(null);const o=i;if("string"===i.type){const e=i.parent;if(e&&"property"===e.type&&e.keyNode===i&&(i=e.valueNode,!i))return Promise.resolve(null)}const s=Range4.create(e.positionAt(o.offset),e.positionAt(o.offset+o.length)),a=e=>{if(void 0!==this.indentation){const t=new RegExp(` {${this.indentation.length}}`,"g");e=e.replace(t,"&emsp;")}return{contents:{kind:MarkupKind2.Markdown,value:e},range:s}},l=e=>e.replace(/\|\|\s*$/,"");return this.schemaService.getSchemaForResource(e.uri,r).then((e=>{if(e&&i&&!e.errors.length){const t=r.getMatchingSchemas(e.schema,i.offset);let n,o,s,c;const u=[];t.every((e=>{if((e.node===i||"property"===i.type&&i.valueNode===e.node)&&!e.inverted&&e.schema){if(n=n||e.schema.title||e.schema.closestTitle,o=o||e.schema.markdownDescription||toMarkdown2(e.schema.description),e.schema.enum){const t=e.schema.enum.indexOf(getNodeValue3(i));e.schema.markdownEnumDescriptions?s=e.schema.markdownEnumDescriptions[t]:e.schema.enumDescriptions&&(s=toMarkdown2(e.schema.enumDescriptions[t])),s&&(c=e.schema.enum[t],"string"!=typeof c&&(c=JSON.stringify(c)))}e.schema.anyOf&&isAllSchemasMatched(i,t,e.schema)&&(n="",o="",e.schema.anyOf.forEach(((t,r)=>{n+=t.title||e.schema.closestTitle||"",o+=t.markdownDescription||toMarkdown2(t.description)||"",r!==e.schema.anyOf.length-1&&(n+=" || ",o+=" || ")})),n=l(n),o=l(o)),e.schema.examples&&e.schema.examples.forEach((e=>{u.push(JSON.stringify(e,null,2))}))}return!0}));let m="";return n&&(m="#### "+toMarkdown2(n)),o&&(m.length>0&&(m+="\n\n"),m+=o),s&&(m.length>0&&(m+="\n\n"),m+=`\`${toMarkdownCodeBlock2(c)}\`: ${s}`),0!==u.length&&(m.length>0&&(m+="\n\n"),m+="Examples:",u.forEach((e=>{m+=`\n\n\`\`\`${e}\`\`\``}))),m.length>0&&e.schema.url&&(m+=`\n\nSource: [${getSchemaName(e.schema)}](${e.schema.url})`),a(m)}return null}))}};function getSchemaName(e){let t="JSON Schema";const r=e.url;if(r){const e=URI5.parse(r);t=path3.basename(e.fsPath)}else e.title&&(t=e.title);return t}function toMarkdown2(e){if(e){return e.replace(/([^\n\r])(\r?\n)([^\n\r])/gm,"$1\n\n$3").replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}}function toMarkdownCodeBlock2(e){return-1!==e.indexOf("`")?"`` "+e+" ``":e}function isAllSchemasMatched(e,t,r){let n=0;for(const i of t)e===i.node&&i.schema!==r&&r.anyOf.forEach((e=>{i.schema.title===e.title&&i.schema.description===e.description&&i.schema.properties===e.properties&&n++}));return n===r.anyOf.length}import{Diagnostic as Diagnostic6,Position as Position2}from"vscode-languageserver-types";import{Diagnostic as Diagnostic3,DiagnosticSeverity as DiagnosticSeverity3,DiagnosticTag,Range as Range5}from"vscode-languageserver-types";import{isAlias as isAlias2,isCollection,isNode as isNode3,isScalar as isScalar4,visit as visit3,CST}from"yaml";var UnusedAnchorsValidator=class{validate(e,t){const r=[],n=new Set,i=new Set,o=new Map;visit3(t.internalDocument,((e,r,s)=>{isNode3(r)&&((isCollection(r)||isScalar4(r))&&r.anchor&&(n.add(r),o.set(r,s[s.length-1])),isAlias2(r)&&i.add(r.resolve(t.internalDocument)))}));for(const t of n)if(!i.has(t)){const n=this.getAnchorNode(o.get(t),t);if(n){const t=Range5.create(e.positionAt(n.offset),e.positionAt(n.offset+n.source.length)),i=Diagnostic3.create(t,`Unused anchor "${n.source}"`,DiagnosticSeverity3.Hint,0);i.tags=[DiagnosticTag.Unnecessary],r.push(i)}}return r}getAnchorNode(e,t){if(e&&e.srcToken){const r=e.srcToken;if(isCollectionItem(r))return getAnchorFromCollectionItem(r);if(CST.isCollection(r))for(const e of r.items){if(t.srcToken!==e.value)continue;const r=getAnchorFromCollectionItem(e);if(r)return r}}}};function getAnchorFromCollectionItem(e){for(const t of e.start)if("anchor"===t.type)return t;if(e.sep&&Array.isArray(e.sep))for(const t of e.sep)if("anchor"===t.type)return t}import{Diagnostic as Diagnostic4,DiagnosticSeverity as DiagnosticSeverity4,Range as Range6}from"vscode-languageserver-types";import{isMap as isMap4,isSeq as isSeq4,visit as visit4}from"yaml";var YAMLStyleValidator=class{constructor(e){this.forbidMapping="forbid"===e.flowMapping,this.forbidSequence="forbid"===e.flowSequence}validate(e,t){const r=[];return visit4(t.internalDocument,((t,n)=>{var i,o;this.forbidMapping&&isMap4(n)&&"flow-collection"===(null==(i=n.srcToken)?void 0:i.type)&&r.push(Diagnostic4.create(this.getRangeOf(e,n.srcToken),"Flow style mapping is forbidden",DiagnosticSeverity4.Error,"flowMap")),this.forbidSequence&&isSeq4(n)&&"flow-collection"===(null==(o=n.srcToken)?void 0:o.type)&&r.push(Diagnostic4.create(this.getRangeOf(e,n.srcToken),"Flow style sequence is forbidden",DiagnosticSeverity4.Error,"flowSeq"))})),r}getRangeOf(e,t){return Range6.create(e.positionAt(t.start.offset),e.positionAt(t.end.pop().offset))}};import{Diagnostic as Diagnostic5,DiagnosticSeverity as DiagnosticSeverity5,Range as Range7}from"vscode-languageserver-types";import{isMap as isMap5,visit as visit5}from"yaml";var MapKeyOrderValidator=class{validate(e,t){const r=[];return visit5(t.internalDocument,((t,n)=>{if(isMap5(n))for(let t=1;t<n.items.length;t++)if(compare(n.items[t-1],n.items[t])>0){const i=createRange2(e,n.items[t-1]);r.push(Diagnostic5.create(i,`Wrong ordering of key "${n.items[t-1].key}" in mapping`,DiagnosticSeverity5.Error,"mapKeyOrder"))}})),r}};function createRange2(e,t){var r,n,i,o,s,a,l,c,u,m,h;const p=null!=(a=null!=(i=null==(r=null==t?void 0:t.srcToken.start[0])?void 0:r.offset)?i:null==(n=null==t?void 0:t.srcToken)?void 0:n.key.offset)?a:null==(s=null==(o=null==t?void 0:t.srcToken)?void 0:o.sep[0])?void 0:s.offset,f=(null==(l=null==t?void 0:t.srcToken)?void 0:l.value.offset)||(null==(u=null==(c=null==t?void 0:t.srcToken)?void 0:c.sep[0])?void 0:u.offset)||(null==(m=null==t?void 0:t.srcToken)?void 0:m.key.offset)||(null==(h=null==t?void 0:t.srcToken.start[t.srcToken.start.length-1])?void 0:h.offset);return Range7.create(e.positionAt(p),e.positionAt(f))}function compare(e,t){const r=String(t.key);return String(e.key).localeCompare(r)}var yamlDiagToLSDiag=(e,t)=>{const r=t.positionAt(e.location.start),n={start:r,end:e.location.toLineEnd?Position2.create(r.line,new TextBuffer(t).getLineLength(r.line)):t.positionAt(e.location.end)};return Diagnostic6.create(n,e.message,e.severity,e.code,YAML_SOURCE)},YAMLValidation=class{constructor(e,t){this.telemetry=t,this.validators=[],this.MATCHES_MULTIPLE="Matches multiple schemas when only one must validate.",this.validationEnabled=!0,this.jsonValidation=new JSONValidation(e,Promise)}configure(e){this.validators=[],e&&(this.validationEnabled=e.validate,this.customTags=e.customTags,this.disableAdditionalProperties=e.disableAdditionalProperties,this.yamlVersion=e.yamlVersion,"forbid"!==e.flowMapping&&"forbid"!==e.flowSequence||this.validators.push(new YAMLStyleValidator(e)),e.keyOrdering&&this.validators.push(new MapKeyOrderValidator)),this.validators.push(new UnusedAnchorsValidator)}async doValidation(e,t=!1){var r;if(!this.validationEnabled)return Promise.resolve([]);const n=[];try{const r=yamlDocumentsCache.getYamlDocument(e,{customTags:this.customTags,yamlVersion:this.yamlVersion},!0);let i=0;for(const o of r.documents){o.isKubernetes=t,o.currentDocIndex=i,o.disableAdditionalProperties=this.disableAdditionalProperties,o.uri=e.uri;const r=await this.jsonValidation.doValidation(e,o),s=o;s.errors.length>0&&n.push(...s.errors),s.warnings.length>0&&n.push(...s.warnings),n.push(...r),n.push(...this.runAdditionalValidators(e,o)),i++}}catch(e){null==(r=this.telemetry)||r.sendError("yaml.validation.error",{error:convertErrorToTelemetryMsg(e)})}let i;const o=new Set,s=[];for(let r of n){if(t&&r.message===this.MATCHES_MULTIPLE)continue;if(Object.prototype.hasOwnProperty.call(r,"location")&&(r=yamlDiagToLSDiag(r,e)),r.source||(r.source=YAML_SOURCE),i&&i.message===r.message&&i.range.end.line===r.range.start.line&&Math.abs(i.range.end.character-r.range.end.character)>=1){i.range.end=r.range.end;continue}i=r;const n=r.range.start.line+" "+r.range.start.character+" "+r.message;o.has(n)||(s.push(r),o.add(n))}return s}runAdditionalValidators(e,t){const r=[];for(const n of this.validators)r.push(...n.validate(e,t));return r}};import{Range as Range8,Position as Position3,TextEdit as TextEdit2}from"vscode-languageserver-types";import*as prettier from"prettier/standalone.js";import*as parser from"prettier/parser-yaml.js";var YamlCommands,YAMLFormatter=class{constructor(){this.formatterEnabled=!0}configure(e){e&&(this.formatterEnabled=e.format)}format(e,t){if(!this.formatterEnabled)return[];try{const r=e.getText(),n={parser:"yaml",plugins:[parser],tabWidth:t.tabWidth||t.tabSize,singleQuote:t.singleQuote,bracketSpacing:t.bracketSpacing,proseWrap:"always"===t.proseWrap?"always":"never"===t.proseWrap?"never":"preserve",printWidth:t.printWidth},i=prettier.format(r,n);return[TextEdit2.replace(Range8.create(Position3.create(0,0),e.positionAt(r.length)),i)]}catch(e){return[]}}},YamlLinks=class{constructor(e){this.telemetry=e}findLinks(e){var t;try{const t=yamlDocumentsCache.getYamlDocument(e),r=[];for(const n of t.documents)r.push(findLinks(e,n));return Promise.all(r).then((e=>[].concat(...e)))}catch(e){null==(t=this.telemetry)||t.sendError("yaml.documentLink.error",{error:convertErrorToTelemetryMsg(e)})}}};import{FoldingRange as FoldingRange2,Range as Range9}from"vscode-languageserver-types";function getFoldingRanges2(e,t){if(!e)return;const r=[],n=yamlDocumentsCache.getYamlDocument(e);for(const t of n.documents)n.documents.length>1&&r.push(createNormalizedFolding(e,t.root)),t.visit((t=>{var n;if("object"===t.type&&"array"===(null==(n=t.parent)?void 0:n.type)&&r.push(createNormalizedFolding(e,t)),"property"===t.type&&t.valueNode)switch(t.valueNode.type){case"array":case"object":r.push(createNormalizedFolding(e,t));break;case"string":{const n=e.positionAt(t.offset),i=e.positionAt(t.valueNode.offset+t.valueNode.length);n.line!==i.line&&r.push(createNormalizedFolding(e,t));break}default:return!0}return!0}));const i=t&&t.rangeLimit;return"number"!=typeof i||r.length<=i?r:(t&&t.onRangeLimitExceeded&&t.onRangeLimitExceeded(e.uri),r.slice(0,t.rangeLimit))}function createNormalizedFolding(e,t){const r=e.positionAt(t.offset);let n=e.positionAt(t.offset+t.length);const i=e.getText(Range9.create(r,n)),o=i.length-i.trimRight().length;return o>0&&(n=e.positionAt(t.offset+t.length-o)),FoldingRange2.create(r.line,n.line,r.character,n.character)}import{CodeAction as CodeAction2,CodeActionKind as CodeActionKind2,Command as Command2,Position as Position4,Range as Range10,TextEdit as TextEdit3}from"vscode-languageserver-types";(YamlCommands||(YamlCommands={})).JUMP_TO_SCHEMA="jumpToSchema";import*as path4 from"path-browserify";import{CST as CST3,isMap as isMap6,isSeq as isSeq5}from"yaml";import{CST as CST2,visit as visit6}from"yaml";var FlowStyleRewriter=class{constructor(e){this.indentation=e}write(e){if("flow-collection"!==e.internalNode.srcToken.type)return null;const t=e.internalNode.srcToken,r="flow-map-start"===t.start.type?"block-map":"block-seq",n=e.parent.type,i={type:r,offset:t.offset,indent:t.indent,items:[]};for(const e of t.items)CST2.visit(e,(({key:e,sep:t,value:o})=>{if("block-map"===r){const r=[{type:"space",indent:0,offset:e.offset,source:this.indentation}];"property"===n&&r.unshift({type:"newline",indent:0,offset:e.offset,source:"\n"}),i.items.push({start:r,key:e,sep:t,value:o})}else"block-seq"===r&&i.items.push({start:[{type:"newline",indent:0,offset:o.offset,source:"\n"},{type:"space",indent:0,offset:o.offset,source:this.indentation},{type:"seq-item-ind",indent:0,offset:o.offset,source:"-"},{type:"space",indent:0,offset:o.offset,source:" "}],value:o});if("flow-collection"===o.type)return visit6.SKIP}));return CST2.stringify(i)}},cloneDeep=structuredClone,YamlCodeActions=class{constructor(e){this.clientCapabilities=e,this.indentation="  "}configure(e){this.indentation=e.indentation}getCodeAction(e,t){if(!t.context.diagnostics)return;const r=[];return r.push(...this.getConvertToBooleanActions(t.context.diagnostics,e)),r.push(...this.getJumpToSchemaActions(t.context.diagnostics)),r.push(...this.getTabToSpaceConverting(t.context.diagnostics,e)),r.push(...this.getUnusedAnchorsDelete(t.context.diagnostics,e)),r.push(...this.getConvertToBlockStyleActions(t.context.diagnostics,e)),r.push(...this.getKeyOrderActions(t.context.diagnostics,e)),r}getJumpToSchemaActions(e){var t,r,n,i,o;if(!(null!=(i=null==(n=null==(r=null==(t=this.clientCapabilities)?void 0:t.window)?void 0:r.showDocument)?void 0:n.support)&&i))return[];const s=new Map;for(const t of e){const e=(null==(o=t.data)?void 0:o.schemaUri)||[];for(const r of e)r&&(s.has(r)||s.set(r,[]),s.get(r).push(t))}const a=[];for(const e of s.keys()){const t=CodeAction2.create(`Jump to schema location (${path4.basename(e)})`,Command2.create("JumpToSchema",YamlCommands.JUMP_TO_SCHEMA,e));t.diagnostics=s.get(e),a.push(t)}return a}getTabToSpaceConverting(e,t){const r=[],n=new TextBuffer(t),i=[];for(const o of e)if("Using tabs can lead to unpredictable results"===o.message){if(i.includes(o.range.start.line))continue;const e=n.getLineContent(o.range.start.line);let s=0,a="";for(let t=o.range.start.character;t<=o.range.end.character;t++){if("\t"!==e.charAt(t))break;s++,a+=this.indentation}i.push(o.range.start.line);let l=o.range;s!==o.range.end.character-o.range.start.character&&(l=Range10.create(o.range.start,Position4.create(o.range.end.line,o.range.start.character+s))),r.push(CodeAction2.create("Convert Tab to Spaces",createWorkspaceEdit(t.uri,[TextEdit3.replace(l,a)]),CodeActionKind2.QuickFix))}if(0!==r.length){const e=[];for(let t=0;t<=n.getLineCount();t++){const r=n.getLineContent(t);let i=0,o="";for(let n=0;n<r.length;n++){const s=r.charAt(n);if(" "!==s&&"\t"!==s){0!==i&&(e.push(TextEdit3.replace(Range10.create(t,n-i,t,n),o)),i=0,o="");break}" "!==s||0===i?"\t"===s&&(o+=this.indentation,i++):(e.push(TextEdit3.replace(Range10.create(t,n-i,t,n),o)),i=0,o="")}0!==i&&e.push(TextEdit3.replace(Range10.create(t,0,t,n.getLineLength(t)),o))}e.length>0&&r.push(CodeAction2.create("Convert all Tabs to Spaces",createWorkspaceEdit(t.uri,e),CodeActionKind2.QuickFix))}return r}getUnusedAnchorsDelete(e,t){const r=[],n=new TextBuffer(t);for(const i of e)if(i.message.startsWith("Unused anchor")&&i.source===YAML_SOURCE){const e=Range10.create(i.range.start,i.range.end),o=n.getText(e),s=getFirstNonWhitespaceCharacterAfterOffset(n.getLineContent(e.end.line),e.end.character);e.end.character=s;const a=CodeAction2.create(`Delete unused anchor: ${o}`,createWorkspaceEdit(t.uri,[TextEdit3.del(e)]),CodeActionKind2.QuickFix);a.diagnostics=[i],r.push(a)}return r}getConvertToBooleanActions(e,t){const r=[];for(const n of e)if('Incorrect type. Expected "boolean".'===n.message){const e=t.getText(n.range).toLocaleLowerCase();if('"true"'===e||'"false"'===e||"'true'"===e||"'false'"===e){const i=e.includes("true")?"true":"false";r.push(CodeAction2.create("Convert to boolean",createWorkspaceEdit(t.uri,[TextEdit3.replace(n.range,i)]),CodeActionKind2.QuickFix))}}return r}getConvertToBlockStyleActions(e,t){const r=[];for(const n of e)if("flowMap"===n.code||"flowSeq"===n.code){const e=getNodeforDiagnostic(t,n);if(isMap6(e.internalNode)||isSeq5(e.internalNode)){const i=isMap6(e.internalNode)?"map":"sequence",o=new FlowStyleRewriter(this.indentation);r.push(CodeAction2.create(`Convert to block style ${i}`,createWorkspaceEdit(t.uri,[TextEdit3.replace(n.range,o.write(e))]),CodeActionKind2.QuickFix))}}return r}getKeyOrderActions(e,t){var r,n,i,o,s,a,l,c,u,m,h,p,f,d;const g=[];for(const y of e)if("mapKeyOrder"===(null==y?void 0:y.code)){let e=getNodeforDiagnostic(t,y);for(;e&&"object"!==e.type;)e=e.parent;if(e&&isMap6(e.internalNode)){const y=cloneDeep(e.internalNode);if(!("block-map"!==y.srcToken.type&&"flow-collection"!==y.srcToken.type||"block-map"!==e.internalNode.srcToken.type&&"flow-collection"!==e.internalNode.srcToken.type)){y.srcToken.items.sort(((e,t)=>e.key&&t.key&&CST3.isScalar(e.key)&&CST3.isScalar(t.key)?e.key.source.localeCompare(t.key.source):!e.key&&t.key?-1:e.key&&!t.key?1:e.key||t.key?void 0:0));for(let t=0;t<y.srcToken.items.length;t++){const g=y.srcToken.items[t],v=e.internalNode.srcToken.items[t];if(g.start=v.start,"alias"===(null==(r=g.value)?void 0:r.type)||"scalar"===(null==(n=g.value)?void 0:n.type)||"single-quoted-scalar"===(null==(i=g.value)?void 0:i.type)||"double-quoted-scalar"===(null==(o=g.value)?void 0:o.type)){const e=null!=(l=null==(a=null==(s=g.value)?void 0:s.end)?void 0:a.findIndex((e=>"newline"===e.type)))?l:-1;let t=null;"block-scalar"===(null==(c=v.value)?void 0:c.type)?t=null==(m=null==(u=v.value)?void 0:u.props)?void 0:m.find((e=>"newline"===e.type)):CST3.isScalar(v.value)&&(t=null==(p=null==(h=v.value)?void 0:h.end)?void 0:p.find((e=>"newline"===e.type))),t&&e<0&&(g.value.end=null!=(f=g.value.end)?f:[],g.value.end.push(t)),!t&&e>-1&&g.value.end.splice(e,1)}else if("block-scalar"===(null==(d=g.value)?void 0:d.type)){g.value.props.find((e=>"newline"===e.type))||g.value.props.push({type:"newline",indent:0,offset:g.value.offset,source:"\n"})}}}const v=Range10.create(t.positionAt(e.offset),t.positionAt(e.offset+e.length));g.push(CodeAction2.create("Fix key order for this map",createWorkspaceEdit(t.uri,[TextEdit3.replace(v,CST3.stringify(y.srcToken))]),CodeActionKind2.QuickFix))}}return g}};function getNodeforDiagnostic(e,t){const r=yamlDocumentsCache.getYamlDocument(e),n=e.offsetAt(t.range.start);return matchOffsetToDocument(n,r).getNodeFromOffset(n)}function createWorkspaceEdit(e,t){const r={};r[e]=t;return{changes:r}}import{Position as Position5,Range as Range11,TextEdit as TextEdit4}from"vscode-languageserver-types";function doDocumentOnTypeFormatting(e,t){const{position:r}=t,n=new TextBuffer(e);if("\n"===t.ch){const e=n.getLineContent(r.line-1);if(e.trimRight().endsWith(":")){const i=n.getLineContent(r.line),o=i.substring(r.character,i.length),s=-1!==e.indexOf(" - ");if(0===o.trimRight().length){const n=r.character-(e.length-e.trimLeft().length);if(n===t.options.tabSize&&!s)return;const o=[];return i.length>0&&o.push(TextEdit4.del(Range11.create(r,Position5.create(r.line,i.length-1)))),o.push(TextEdit4.insert(r," ".repeat(t.options.tabSize+(s?2-n:0)))),o}if(s)return[TextEdit4.insert(r," ".repeat(t.options.tabSize))]}if(e.trimRight().endsWith("|"))return[TextEdit4.insert(r," ".repeat(t.options.tabSize))];if(e.includes(" - ")&&!e.includes(": "))return[TextEdit4.insert(r,"- ")];if(e.includes(" - ")&&e.includes(": "))return[TextEdit4.insert(r,"  ")]}}import{CodeLens,Range as Range12}from"vscode-languageserver-types";import{URI as URI6}from"vscode-uri";function getSchemaUrls(e){const t=new Map;return e?(e.url?e.url.startsWith("schemaservice://combinedSchema/")?addSchemasForOf(e,t):t.set(e.url,e):addSchemasForOf(e,t),t):t}function addSchemasForOf(e,t){e.allOf&&addInnerSchemaUrls(e.allOf,t),e.anyOf&&addInnerSchemaUrls(e.anyOf,t),e.oneOf&&addInnerSchemaUrls(e.oneOf,t)}function addInnerSchemaUrls(e,t){for(const r of e)isBoolean2(r)||!r.url||t.has(r.url)||t.set(r.url,r)}var YamlCodeLens=class{constructor(e,t){this.schemaService=e,this.telemetry=t}async getCodeLens(e){var t;const r=[];try{const t=yamlDocumentsCache.getYamlDocument(e);let n=new Map;for(const r of t.documents){const t=await this.schemaService.getSchemaForResource(e.uri,r);(null==t?void 0:t.schema)&&(n=new Map([...getSchemaUrls(null==t?void 0:t.schema),...n]))}for(const e of n){const t=CodeLens.create(Range12.create(0,0,0,0));t.command={title:getSchemaTitle(e[1],e[0]),command:YamlCommands.JUMP_TO_SCHEMA,arguments:[e[0]]},r.push(t)}}catch(e){null==(t=this.telemetry)||t.sendError("yaml.codeLens.error",{error:convertErrorToTelemetryMsg(e)})}return r}resolveCodeLens(e){return e}};import{CompletionItem as CompletionItemBase,CompletionItemKind as CompletionItemKind2,CompletionList as CompletionList2,InsertTextFormat as InsertTextFormat2,InsertTextMode,MarkupKind as MarkupKind3,Position as Position6,Range as Range13,TextEdit as TextEdit5}from"vscode-languageserver-types";import{isPair as isPair3,isScalar as isScalar5,isMap as isMap7,isSeq as isSeq6,isNode as isNode4}from"yaml";var SpacesDiffResult=class{constructor(){this.spacesDiff=0,this.looksLikeAlignment=!1}};function spacesDiff(e,t,r,n,i){let o;for(i.spacesDiff=0,i.looksLikeAlignment=!1,o=0;o<t&&o<n;o++){if(e.charCodeAt(o)!==r.charCodeAt(o))break}let s=0,a=0;for(let r=o;r<t;r++){32===e.charCodeAt(r)?s++:a++}let l=0,c=0;for(let e=o;e<n;e++){32===r.charCodeAt(e)?l++:c++}if(s>0&&a>0)return;if(l>0&&c>0)return;const u=Math.abs(a-c),m=Math.abs(s-l);if(0===u)return i.spacesDiff=m,void(m>0&&0<=l-1&&l-1<e.length&&l<r.length&&32!==r.charCodeAt(l)&&32===e.charCodeAt(l-1)&&44===e.charCodeAt(e.length-1)&&(i.looksLikeAlignment=!0));m%u==0&&(i.spacesDiff=m/u)}function guessIndentation(e,t,r){const n=Math.min(e.getLineCount(),1e4);let i=0,o=0,s="",a=0;const l=[2,4,6,8,3,5,7],c=[0,0,0,0,0,0,0,0,0],u=new SpacesDiffResult;for(let l=1;l<=n;l++){const n=e.getLineLength(l),m=e.getLineContent(l),h=n<=65536;let p=!1,f=0,d=0,g=0;for(let t=0,r=n;t<r;t++){const r=h?m.charCodeAt(t):e.getLineCharCode(l,t);if(9===r)g++;else{if(32!==r){p=!0,f=t;break}d++}}if(!p)continue;if(g>0?i++:d>1&&o++,spacesDiff(s,a,m,f,u),u.looksLikeAlignment&&(!r||t!==u.spacesDiff))continue;const y=u.spacesDiff;y<=8&&c[y]++,s=m,a=f}let m=r;i!==o&&(m=i<o);let h=t;if(m){let e=m?0:.1*n;l.forEach((t=>{const r=c[t];r>e&&(e=r,h=t)})),4===h&&c[4]>0&&c[2]>0&&c[2]>=c[4]/2&&(h=2)}return{insertSpaces:m,tabSize:h}}function stringifyObject2(e,t,r,n,i=0,o=0){if(null!==e&&"object"==typeof e){const s=0===i&&n.shouldIndentWithTab||i>0?t+n.indentation:"";if(Array.isArray(e)){if(o+=1,0===e.length)return"";let a="";for(let l=0;l<e.length;l++){let c=e[l];"object"==typeof e[l]?(Array.isArray(e[l])||(c=prependToObject(e[l],o)),a+=stringifyObject2(c,t,r,n,i+=1,o)):a+="\n"+s+"- "+r(e[l])}return a}{const o=Object.keys(e);if(0===o.length)return"";let a=0===i&&n.newLineFirst||i>0?"\n":"",l=!0;for(let c=0;c<o.length;c++){const u=o[c];if(0===i&&n.existingProps.includes(u))continue;const m="object"==typeof e[u],h=m?":":": ",p=s+(m&&/^\s|-/.test(u)?n.indentation:""),f=l?"":"\n";if(0===i&&l&&!n.indentFirstObject){a+=f+t+u+h+stringifyObject2(e[u],p,r,n,i+1,0)}else{a+=f+s+u+h+stringifyObject2(e[u],p,r,n,i+1,0)}l=!1}return a}}return r(e)}function prependToObject(e,t){const r={};for(let n=0;n<Object.keys(e).length;n++){const i=Object.keys(e)[n];0===n?r["- ".repeat(t)+i]=e[i]:r["  ".repeat(t)+i]=e[i]}return r}var localize9=loadMessageBundle(),doubleQuotesEscapeRegExp=/[\\]+"/g,parentCompletionKind=CompletionItemKind2.Class,existingProposeItem="__",YamlCompletion=class{constructor(e,t={},r,n){this.schemaService=e,this.clientCapabilities=t,this.yamlDocument=r,this.telemetry=n,this.completionEnabled=!0,this.arrayPrefixIndentation=""}configure(e){e&&(this.completionEnabled=e.completion),this.customTags=e.customTags,this.yamlVersion=e.yamlVersion,this.configuredIndentation=e.indentation,this.disableDefaultProperties=e.disableDefaultProperties,this.parentSkeletonSelectedFirst=e.parentSkeletonSelectedFirst}async doComplete(e,t,r=!1,n=!0){var i;const o=CompletionList2.create([],!1);if(!this.completionEnabled)return o;const s=this.yamlDocument.getYamlDocument(e,{customTags:this.customTags,yamlVersion:this.yamlVersion},!0),a=new TextBuffer(e);if(this.configuredIndentation)this.indentation=this.configuredIndentation;else{const e=guessIndentation(a,2,!0);this.indentation=e.insertSpaces?" ".repeat(e.tabSize):"\t"}setKubernetesParserOption(s.documents,r);for(const t of s.documents)t.uri=e.uri;const l=e.offsetAt(t),c=e.getText();if(":"===c.charAt(l-1))return Promise.resolve(o);let u=matchOffsetToDocument(l,s);if(null===u)return Promise.resolve(o);u=u.clone();let[m,h]=u.getNodeFromPosition(l,a,this.indentation.length);const p=this.getCurrentWord(e,l);let f=a.getLineContent(t.line);const d=f.substring(t.character),g=/^[ ]+\n?$/.test(d);this.arrayPrefixIndentation="";let y=null;if(g){y=Range13.create(t,Position6.create(t.line,f.length));const e=0===f.trim().length,r=f.match(/^\s*(-)\s*$/);if(m&&isScalar5(m)&&!e&&!r){const e=f.substring(0,t.character),r=e.match(/^[\s-]*([^:]+)?$/)||e.match(/:[ \t]((?!:[ \t]).*)$/);(null==r?void 0:r[1])&&(y=Range13.create(Position6.create(t.line,t.character-r[1].length),Position6.create(t.line,f.length)))}}else if(m&&isScalar5(m)&&"null"===m.value){const t=e.positionAt(m.range[0]);t.character+=1;const r=e.positionAt(m.range[2]);r.character+=1,y=Range13.create(t,r)}else if(m&&isScalar5(m)&&m.value){const t=e.positionAt(m.range[0]);y=Range13.create(t,e.positionAt(m.range[1]))}else if(m&&isScalar5(m)&&null===m.value&&"-"===p)y=Range13.create(t,t),this.arrayPrefixIndentation=" ";else{let r=l-p.length;r>0&&'"'===c[r-1]&&r--,y=Range13.create(e.positionAt(r),t)}const v={},S={add:(e,t)=>{const r=!!e.parent;let n=e.label;if(!n)return void console.warn(`Ignoring CompletionItem without label: ${JSON.stringify(e)}`);if(isString2(n)||(n=String(n)),n=n.replace(/[\n]/g,"↵"),n.length>60){const e=n.substr(0,57).trim()+"...";v[e]||(n=e)}if(e.insertText.endsWith("$1")&&!r&&(e.insertText=e.insertText.substr(0,e.insertText.length-2)),y&&y.start.line===y.end.line&&(e.textEdit=TextEdit5.replace(y,e.insertText)),e.label=n,r)return void function(e){var t;if((null==(t=v[e.label])?void 0:t.label)===existingProposeItem)return;const r=e.parent.schema,n=getSchemaTypeName(r),i=r.markdownDescription||r.description;let s=o.items.find((e=>{var t;return(null==(t=e.parent)?void 0:t.schema)===r&&e.kind===parentCompletionKind}));s&&s.parent.insertTexts.includes(e.insertText)||(s?s.parent.insertTexts.push(e.insertText):(s={...e,label:n,documentation:i,sortText:"_"+n,kind:parentCompletionKind},s.label=s.label||e.label,s.parent.insertTexts=[e.insertText],o.items.push(s)))}(e);this.arrayPrefixIndentation&&this.updateCompletionText(e,this.arrayPrefixIndentation+e.insertText);const i=v[n],s=(null==i?void 0:i.label)!==existingProposeItem&&(null==i?void 0:i.insertText)!==e.insertText;if(i){if(s){const r=this.mergeSimpleInsertTexts(n,i.insertText,e.insertText,t);r?this.updateCompletionText(i,r):(v[n]=e,o.items.push(e))}}else v[n]=e,o.items.push(e);i&&!i.documentation&&e.documentation&&(i.documentation=e.documentation)},error:e=>{var t;null==(t=this.telemetry)||t.sendError("yaml.completion.error",{error:convertErrorToTelemetryMsg(e)})},log:e=>{console.log(e)},getNumberOfProposals:()=>o.items.length,result:o,proposed:v};this.customTags.length>0&&this.getCustomTagValueCompletions(S),f.endsWith("\n")&&(f=f.substr(0,f.length-1));try{const r=await this.schemaService.getSchemaForResource(e.uri,u);if((!r||r.errors.length)&&0===t.line&&0===t.character&&!isModeline(f)){const e={kind:CompletionItemKind2.Text,label:"Inline schema",insertText:"# yaml-language-server: $schema=",insertTextFormat:InsertTextFormat2.PlainText};o.items.push(e)}if(isModeline(f)||isInComment(s.tokens,l)){const e=f.indexOf("$schema=");return-1!==e&&e+8<=t.character&&this.schemaService.getAllSchemas().forEach((e=>{var t;const r={kind:CompletionItemKind2.Constant,label:null!=(t=e.name)?t:e.uri,detail:e.description,insertText:e.uri,insertTextFormat:InsertTextFormat2.PlainText,insertTextMode:InsertTextMode.asIs};o.items.push(r)})),o}if(!r||r.errors.length)return o;let i=null;if(!m)if(!u.internalDocument.contents||isScalar5(u.internalDocument.contents)){const e=u.internalDocument.createNode({});e.range=[l,l+1,l+1],u.internalDocument.contents=e,u.updateFromInternalDocument(),m=e}else m=u.findClosestNode(l,a),h=!0;const d=m;if(m)if(0===f.length)m=u.internalDocument.contents;else{const r=u.getParent(m);if(r){if(isScalar5(m)){if(m.value){if(isPair3(r)){if(r.value===m){if(f.trim().length>0&&f.indexOf(":")<0){const e=this.createTempObjNode(p,m,u),t=u.getParent(r);if(isSeq6(u.internalDocument.contents)){const t=indexOf(u.internalDocument.contents,r);"number"==typeof t&&(u.internalDocument.set(t,e),u.updateFromInternalDocument())}else t&&(isMap7(t)||isSeq6(t))?(t.set(r.key,e),u.updateFromInternalDocument()):(u.internalDocument.set(r.key,e),u.updateFromInternalDocument());i=e.items[0],m=e}else if(0===f.trim().length){const e=u.getParent(r);e&&(m=e)}}else if(r.key===m){const e=u.getParent(r);i=r,e&&(m=e)}}else if(isSeq6(r))if(f.trim().length>0){const e=this.createTempObjNode(p,m,u);r.delete(m),r.add(e),u.updateFromInternalDocument(),m=e}else m=r}else if(null===m.value)if(isPair3(r)){if(r.key===m)m=r;else if(isNode4(r.key)&&r.key.range){const n=u.getParent(r);if(h&&n&&isMap7(n)&&isMapContainsEmptyPair(n))m=n;else{const o=e.positionAt(r.key.range[0]);if(t.character>o.character&&t.line!==o.line){const e=this.createTempObjNode(p,m,u);n&&(isMap7(n)||isSeq6(n))?(n.set(r.key,e),u.updateFromInternalDocument()):(u.internalDocument.set(r.key,e),u.updateFromInternalDocument()),i=e.items[0],m=e}else o.character===t.character&&n&&(m=n)}}}else if(isSeq6(r))if("-"!==f.charAt(t.character-1)){const e=this.createTempObjNode(p,m,u);r.delete(m),r.add(e),u.updateFromInternalDocument(),m=e}else if("-"===f.charAt(t.character-1)){const e=this.createTempObjNode("",m,u);r.delete(m),r.add(e),u.updateFromInternalDocument(),m=e}else m=r}else if(isMap7(m)&&!h&&0===f.trim().length&&isSeq6(r)){const e=a.getLineContent(t.line+1);a.getLineCount()!==t.line+1&&0!==e.trim().length||(m=r)}}else if(isScalar5(m)){const e=this.createTempObjNode(p,m,u);u.internalDocument.contents=e,u.updateFromInternalDocument(),i=e.items[0],m=e}else if(isMap7(m))for(const e of m.items)isNode4(e.value)&&e.value.range&&e.value.range[0]===l+1&&(m=e.value);else if(isSeq6(m)&&"-"!==f.charAt(t.character-1)){const e=this.createTempObjNode(p,m,u);e.items=[],u.updateFromInternalDocument();for(const t of m.items)isMap7(t)&&t.items.forEach((t=>{e.items.push(t)}));m=e}}if(m&&isMap7(m)){const e=m.items;for(const t of e)i&&i===t||isScalar5(t.key)&&(v[t.key.value+""]=CompletionItemBase.create(existingProposeItem));this.addPropertyCompletions(r,u,m,d,"",S,a,y,n),!r&&p.length>0&&'"'!==c.charAt(l-p.length-1)&&S.add({kind:CompletionItemKind2.Property,label:p,insertText:this.getInsertTextForProperty(p,null,""),insertTextFormat:InsertTextFormat2.Snippet})}const g={};this.getValueCompletions(r,u,m,l,e,S,g,n)}catch(e){null==(i=this.telemetry)||i.sendError("yaml.completion.error",{error:convertErrorToTelemetryMsg(e)})}this.finalizeParentCompletion(o);const b=o.items.filter(((e,t,r)=>t===r.findIndex((t=>t.label===e.label&&t.insertText===e.insertText&&t.kind===e.kind))));return(null==b?void 0:b.length)>0&&(o.items=b),o}updateCompletionText(e,t){e.insertText=t,e.textEdit&&(e.textEdit.newText=t)}mergeSimpleInsertTexts(e,t,r,n){const i=e=>e.includes("\n"),o=e=>{const t=e.indexOf("\n");return t>0&&0===e.substring(t,e.length).trim().length};if(i(t)||i(r))return n&&o(t)&&!o(r)&&!r.startsWith("\n")?r:void 0;const s=this.getValuesFromInsertText(t),a=this.getValuesFromInsertText(r),l=Array.prototype.concat(s,a);return l.length?1===l.length?`${e}: \${1:${l[0]}}`:`${e}: \${1|${l.join(",")}|}`:void 0}getValuesFromInsertText(e){const t=e.substring(e.indexOf(":")+1).trim();if(!t)return[];const r=t.match(/^\${1[|:]([^|]*)+\|?}$/);return r?r[1].split(","):[t]}finalizeParentCompletion(e){e.items.forEach((e=>{if(isParentCompletionItem(e)){const t=e.parent.indent||"";let r=(e=>{let t=0;return e.map((e=>{const r=e.match(/\$([0-9]+)|\${[0-9]+:/g);if(!r)return e;const n=r.map((e=>+e.replace(/\${([0-9]+)[:|]/g,"$1").replace("$",""))).reduce(((e,t)=>t>e?t:e),0),i=e.replace(/\$([0-9]+)/g,((e,r)=>"$"+(+r+t))).replace(/\${([0-9]+)[:|]/g,((e,r)=>"${"+(+r+t)+":"));return t+=n,i}))})(e.parent.insertTexts).join(`\n${t}`);r.endsWith("$1")&&(r=r.substring(0,r.length-2)),e.insertText=this.arrayPrefixIndentation+r,e.textEdit&&(e.textEdit.newText=e.insertText);const n=r.replace(/\${[0-9]+[:|](.*)}/g,((e,t)=>t)).replace(/\$([0-9]+)/g,""),i=e.documentation?[e.documentation,"","----",""]:[];e.documentation={kind:MarkupKind3.Markdown,value:[...i,"```yaml",t+n,"```"].join("\n")},delete e.parent}}))}createTempObjNode(e,t,r){const n={};n[e]=null;const i=r.internalDocument.createNode(n);return i.range=t.range,i.items[0].key.range=t.range,i.items[0].value.range=t.range,i}addPropertyCompletions(e,t,r,n,i,o,s,a,l){var c,u,m;const h=t.getMatchingSchemas(e.schema,-1,null,l),p=s.getText(a),f=s.getLineContent(a.start.line),d=0===f.trim().length,g=-1!==f.indexOf(":"),y=0===f.trimLeft().indexOf("-"),v=t.getParent(r),S=h.find((e=>e.node.internalNode===n&&e.schema.properties)),b=h.filter((e=>e.schema.oneOf)).map((e=>e.schema.oneOf))[0];let x=!1;(null==b?void 0:b.length)<h.length&&(null==b||b.forEach(((e,t)=>{var r,n;(null==(r=h[t])?void 0:r.schema.oneOf)||(null==(n=h[t])?void 0:n.schema.properties)!==e.properties||(x=!0)})));for(const e of h){if((e.node.internalNode===r&&!S||e.node.internalNode===n&&!g||(null==(c=e.node.parent)?void 0:c.internalNode)===n&&!g)&&!e.inverted){this.collectDefaultSnippets(e.schema,i,o,{newLineFirst:!1,indentFirstObject:!1,shouldIndentWithTab:y});const t=e.schema.properties;if(t){const l=e.schema.maxProperties;if(void 0===l||void 0===r.items||r.items.length<l||r.items.length===l&&!d)for(const l in t)if(Object.prototype.hasOwnProperty.call(t,l)){const c=t[l];if("object"==typeof c&&!c.deprecationMessage&&!c.doNotSuggest){let t,h="";if(v&&isSeq6(v)&&r.items.length<=1&&!d){const e=s.getText(),t=e.lastIndexOf("-",r.range[0]-1);if(t>=0){const n=a.end.character-a.start.character;h=" "+e.slice(t+1,r.range[1]-n)}}h+=this.arrayPrefixIndentation,"array"===c.type&&(t=r.items.find((e=>isScalar5(e.key)&&e.key.range&&e.key.value===l&&isScalar5(e.value)&&!e.value.value&&s.getPosition(e.key.range[2]).line===a.end.line-1)))&&t&&(Array.isArray(c.items)?this.addSchemaValueCompletions(c.items[0],i,o,{},"property"):"object"==typeof c.items&&"object"===c.items.type&&this.addArrayItemValueCompletion(c.items,i,o));let f=l;l.startsWith(p)&&g||(f=this.getInsertTextForProperty(l,c,i,h+this.indentation));const y=isScalar5(n)&&null===n.value||isMap7(n)&&0===n.items.length,S=(null==(u=e.schema.required)?void 0:u.length)>0;this.parentSkeletonSelectedFirst&&y&&S||o.add({kind:CompletionItemKind2.Property,label:l,insertText:f,insertTextFormat:InsertTextFormat2.Snippet,documentation:this.fromMarkup(c.markdownDescription)||c.description||""},x),(null==(m=e.schema.required)?void 0:m.includes(l))&&o.add({label:l,insertText:this.getInsertTextForProperty(l,c,i,h+this.indentation),insertTextFormat:InsertTextFormat2.Snippet,documentation:this.fromMarkup(c.markdownDescription)||c.description||"",parent:{schema:e.schema,indent:h}})}}}if(v&&isSeq6(v)&&isPrimitiveType(e.schema)&&this.addSchemaValueCompletions(e.schema,i,o,{},"property",Array.isArray(v.items)),e.schema.propertyNames&&e.schema.additionalProperties&&"object"===e.schema.type){const t=asSchema2(e.schema.propertyNames),r=t.title||"property";o.add({kind:CompletionItemKind2.Property,label:r,insertText:`\${1:${r}}: `,insertTextFormat:InsertTextFormat2.Snippet,documentation:this.fromMarkup(t.markdownDescription)||t.description||""})}}v&&e.node.internalNode===v&&e.schema.defaultSnippets&&(1===r.items.length?this.collectDefaultSnippets(e.schema,i,o,{newLineFirst:!1,indentFirstObject:!1,shouldIndentWithTab:!0},1):this.collectDefaultSnippets(e.schema,i,o,{newLineFirst:!1,indentFirstObject:!0,shouldIndentWithTab:!1},1))}}getValueCompletions(e,t,r,n,i,o,s,a){let l=null;if(r&&isScalar5(r)&&(r=t.getParent(r)),r){if(isPair3(r)){const e=r.value;if(e&&e.range&&n>e.range[0]+e.range[2])return;l=isScalar5(r.key)?r.key.value+"":null,r=t.getParent(r)}if(r&&(null!==l||isSeq6(r))){const c="",u=t.getMatchingSchemas(e.schema,-1,null,a);for(const e of u)if(e.node.internalNode===r&&!e.inverted&&e.schema){if(e.schema.items&&(this.collectDefaultSnippets(e.schema,c,o,{newLineFirst:!1,indentFirstObject:!1,shouldIndentWithTab:!1}),isSeq6(r)&&r.items))if(Array.isArray(e.schema.items)){const t=this.findItemAtOffset(r,i,n);t<e.schema.items.length&&this.addSchemaValueCompletions(e.schema.items[t],c,o,s,"value")}else"object"!=typeof e.schema.items||"object"!==e.schema.items.type&&!isAnyOfAllOfOneOfType(e.schema.items)?this.addSchemaValueCompletions(e.schema.items,c,o,s,"value"):this.addSchemaValueCompletions(e.schema.items,c,o,s,"value",!0);if(e.schema.properties){const t=e.schema.properties[l];t&&this.addSchemaValueCompletions(t,c,o,s,"value")}else e.schema.additionalProperties&&this.addSchemaValueCompletions(e.schema.additionalProperties,c,o,s,"value")}s.boolean&&(this.addBooleanValueCompletion(!0,c,o),this.addBooleanValueCompletion(!1,c,o)),s.null&&this.addNullValueCompletion(c,o)}}else this.addSchemaValueCompletions(e.schema,"",o,s,"value")}addArrayItemValueCompletion(e,t,r,n){const i=getSchemaTypeName(e),o=`- ${this.getInsertTextForObject(e,t).insertText.trimLeft()}`,s=i?" type `"+i+"`":"",a=e.description?" ("+e.description+")":"",l=this.getDocumentationWithMarkdownText(`Create an item of an array${s}${a}`,o);r.add({kind:this.getSuggestionKind(e.type),label:"- (array item) "+(i||n),documentation:l,insertText:o,insertTextFormat:InsertTextFormat2.Snippet})}getInsertTextForProperty(e,t,r,n=this.indentation){const i=this.getInsertTextForValue(e,"","string"),o=i+":";let s,a=0;if(t){let e=Array.isArray(t.type)?t.type[0]:t.type;if(e||(t.properties?e="object":t.items?e="array":t.anyOf&&(e="anyOf")),Array.isArray(t.defaultSnippets)){if(1===t.defaultSnippets.length){const e=t.defaultSnippets[0].body;isDefined2(e)&&(s=this.getInsertTextForSnippetValue(e,"",{newLineFirst:!0,indentFirstObject:!1,shouldIndentWithTab:!1},[],1),s.startsWith(" ")||s.startsWith("\n")||(s=" "+s))}a+=t.defaultSnippets.length}if(t.enum&&(s||1!==t.enum.length||(s=" "+this.getInsertTextForGuessedValue(t.enum[0],"",e)),a+=t.enum.length),t.const&&(s||(s=this.getInsertTextForGuessedValue(t.const,"",e),s=evaluateTab1Symbol(s),s=" "+s),a++),isDefined2(t.default)&&(s||(s=" "+this.getInsertTextForGuessedValue(t.default,"",e)),a++),Array.isArray(t.examples)&&t.examples.length&&(s||(s=" "+this.getInsertTextForGuessedValue(t.examples[0],"",e)),a+=t.examples.length),t.properties)return`${o}\n${this.getInsertTextForObject(t,r,n).insertText}`;if(t.items)return`${o}\n${n}- ${this.getInsertTextForArray(t.items,r,1,n).insertText}`;if(0===a)switch(e){case"boolean":case"string":case"anyOf":s=" $1";break;case"object":s=`\n${n}`;break;case"array":s=`\n${n}- `;break;case"number":case"integer":s=" ${1:0}";break;case"null":s=" ${1:null}";break;default:return i}}return(!s||a>1)&&(s=" $1"),o+s+r}getInsertTextForObject(e,t,r=this.indentation,n=1){let i="";return e.properties?(Object.keys(e.properties).forEach((o=>{const s=e.properties[o];let a=Array.isArray(s.type)?s.type[0]:s.type;if(a||(s.anyOf&&(a="anyOf"),s.properties&&(a="object"),s.items&&(a="array")),e.required&&e.required.indexOf(o)>-1)switch(a){case"boolean":case"string":case"number":case"integer":case"anyOf":{let e=s.default||s.const;e?("string"===a&&(e=convertToStringValue(e)),i+=`${r}${o}: \${${n++}:${e}}\n`):i+=`${r}${o}: $${n++}\n`;break}case"array":{const e=this.getInsertTextForArray(s.items,t,n++,r),a=e.insertText.split("\n");let l=e.insertText;if(a.length>1){for(let e=1;e<a.length;e++){const t=a[e];a[e]=`  ${t}`}l=a.join("\n")}n=e.insertIndex,i+=`${r}${o}:\n${r}${this.indentation}- ${l}\n`}break;case"object":{const e=this.getInsertTextForObject(s,t,`${r}${this.indentation}`,n++);n=e.insertIndex,i+=`${r}${o}:\n${e.insertText}\n`}}else if(!this.disableDefaultProperties&&void 0!==s.default)switch(a){case"boolean":case"number":case"integer":i+=`${r}${"null"===o?this.getInsertTextForValue(o,"","string"):o}: \${${n++}:${s.default}}\n`;break;case"string":i+=`${r}${o}: \${${n++}:${convertToStringValue(s.default)}}\n`}})),0===i.trim().length&&(i=`${r}$${n++}\n`),i=i.trimRight()+t,{insertText:i,insertIndex:n}):(i=`${r}$${n++}\n`,{insertText:i,insertIndex:n})}getInsertTextForArray(e,t,r=1,n=this.indentation){let i="";if(!e)return i="$"+r++,{insertText:i,insertIndex:r};let o=Array.isArray(e.type)?e.type[0]:e.type;switch(o||(e.properties&&(o="object"),e.items&&(o="array")),e.type){case"boolean":i=`\${${r++}:false}`;break;case"number":case"integer":i=`\${${r++}:0}`;break;case"string":i=`\${${r++}:""}`;break;case"object":{const o=this.getInsertTextForObject(e,t,`${n}  `,r++);i=o.insertText.trimLeft(),r=o.insertIndex}}return{insertText:i,insertIndex:r}}getInsertTextForGuessedValue(e,t,r){switch(typeof e){case"object":return null===e?"${1:null}"+t:this.getInsertTextForValue(e,t,r);case"string":{let n=JSON.stringify(e);return n=n.substr(1,n.length-2),n=this.getInsertTextForPlainText(n),"string"===r&&(n=convertToStringValue(n)),"${1:"+n+"}"+t}case"number":case"boolean":return"${1:"+e+"}"+t}return this.getInsertTextForValue(e,t,r)}getInsertTextForPlainText(e){return e.replace(/[\\$}]/g,"\\$&")}getInsertTextForValue(e,t,r){if(null===e)return"null";switch(typeof e){case"object":{const r=this.indentation;return this.getInsertTemplateForValue(e,r,{index:1},t)}case"number":case"boolean":return this.getInsertTextForPlainText(e+t)}return"string"===(r=Array.isArray(r)?r[0]:r)&&(e=convertToStringValue(e)),this.getInsertTextForPlainText(e+t)}getInsertTemplateForValue(e,t,r,n){if(Array.isArray(e)){let n="\n";for(const i of e)n+=`${t}- \${${r.index++}:${i}}\n`;return n}if("object"==typeof e){let i="\n";for(const o in e)if(Object.prototype.hasOwnProperty.call(e,o)){const s=e[o];let a;i+=`${t}\${${r.index++}:${o}}:`,a="object"==typeof s?`${this.getInsertTemplateForValue(s,t+this.indentation,r,n)}`:` \${${r.index++}:${this.getInsertTextForPlainText(s+n)}}\n`,i+=`${a}`}return i}return this.getInsertTextForPlainText(e+n)}addSchemaValueCompletions(e,t,r,n,i,o){"object"==typeof e&&(this.addEnumValueCompletions(e,t,r,o),this.addDefaultValueCompletions(e,t,r),this.collectTypes(e,n),o&&"value"===i&&!isAnyOfAllOfOneOfType(e)&&this.addArrayItemValueCompletion(e,t,r),Array.isArray(e.allOf)&&e.allOf.forEach((e=>this.addSchemaValueCompletions(e,t,r,n,i,o))),Array.isArray(e.anyOf)&&e.anyOf.forEach((e=>this.addSchemaValueCompletions(e,t,r,n,i,o))),Array.isArray(e.oneOf)&&e.oneOf.forEach((e=>this.addSchemaValueCompletions(e,t,r,n,i,o))))}collectTypes(e,t){if(Array.isArray(e.enum)||isDefined2(e.const))return;const r=e.type;Array.isArray(r)?r.forEach((function(e){return t[e]=!0})):r&&(t[r]=!0)}addDefaultValueCompletions(e,t,r,n=0){let i=!1;if(isDefined2(e.default)){let o,s=e.type,a=e.default;for(let e=n;e>0;e--)a=[a],s="array";o="object"==typeof a?"Default value":a.toString().replace(doubleQuotesEscapeRegExp,'"'),r.add({kind:this.getSuggestionKind(s),label:o,insertText:this.getInsertTextForValue(a,t,s),insertTextFormat:InsertTextFormat2.Snippet,detail:localize9("json.suggest.default","Default value")}),i=!0}Array.isArray(e.examples)&&e.examples.forEach((o=>{let s=e.type,a=o;for(let e=n;e>0;e--)a=[a],s="array";r.add({kind:this.getSuggestionKind(s),label:this.getLabelForValue(a),insertText:this.getInsertTextForValue(a,t,s),insertTextFormat:InsertTextFormat2.Snippet}),i=!0})),this.collectDefaultSnippets(e,t,r,{newLineFirst:!0,indentFirstObject:!0,shouldIndentWithTab:!0}),i||"object"!=typeof e.items||Array.isArray(e.items)||this.addDefaultValueCompletions(e.items,t,r,n+1)}addEnumValueCompletions(e,t,r,n){if(isDefined2(e.const)&&!n&&r.add({kind:this.getSuggestionKind(e.type),label:this.getLabelForValue(e.const),insertText:this.getInsertTextForValue(e.const,t,e.type),insertTextFormat:InsertTextFormat2.Snippet,documentation:this.fromMarkup(e.markdownDescription)||e.description}),Array.isArray(e.enum))for(let n=0,i=e.enum.length;n<i;n++){const i=e.enum[n];let o=this.fromMarkup(e.markdownDescription)||e.description;e.markdownEnumDescriptions&&n<e.markdownEnumDescriptions.length&&this.doesSupportMarkdown()?o=this.fromMarkup(e.markdownEnumDescriptions[n]):e.enumDescriptions&&n<e.enumDescriptions.length&&(o=e.enumDescriptions[n]),r.add({kind:this.getSuggestionKind(e.type),label:this.getLabelForValue(i),insertText:this.getInsertTextForValue(i,t,e.type),insertTextFormat:InsertTextFormat2.Snippet,documentation:o})}}getLabelForValue(e){return null===e?"null":Array.isArray(e)?JSON.stringify(e):""+e}collectDefaultSnippets(e,t,r,n,i=0){if(Array.isArray(e.defaultSnippets))for(const o of e.defaultSnippets){let s,a,l=e.type,c=o.body,u=o.label;if(isDefined2(c)){const a=o.type||e.type;if(0===i&&"array"===a){const e={};Object.keys(c).forEach(((t,r)=>{0!==r||t.startsWith("-")?e[`  ${t}`]=c[t]:e[`- ${t}`]=c[t]})),c=e}const l=Object.keys(r.proposed).filter((e=>r.proposed[e].label===existingProposeItem));if(s=this.getInsertTextForSnippetValue(c,t,n,l),""===s&&c)continue;u=u||this.getLabelForSnippetValue(c)}else if("string"==typeof o.bodyText){let e="",r="",n="";for(let t=i;t>0;t--)e=e+n+"[\n",r=r+"\n"+n+"]",n+=this.indentation,l="array";s=e+n+o.bodyText.split("\n").join("\n"+n)+r+t,u=u||s,a=s.replace(/[\n]/g,"")}r.add({kind:o.suggestionKind||this.getSuggestionKind(l),label:u,sortText:o.sortText||o.label,documentation:this.fromMarkup(o.markdownDescription)||o.description,insertText:s,insertTextFormat:InsertTextFormat2.Snippet,filterText:a})}}getInsertTextForSnippetValue(e,t,r,n,i){return stringifyObject2(e,"",(e=>{if("string"==typeof e){if("^"===e[0])return e.substr(1);if("true"===e||"false"===e)return`"${e}"`}return e}),{...r,indentation:this.indentation,existingProps:n},i)+t}addBooleanValueCompletion(e,t,r){r.add({kind:this.getSuggestionKind("boolean"),label:e?"true":"false",insertText:this.getInsertTextForValue(e,t,"boolean"),insertTextFormat:InsertTextFormat2.Snippet,documentation:""})}addNullValueCompletion(e,t){t.add({kind:this.getSuggestionKind("null"),label:"null",insertText:"null"+e,insertTextFormat:InsertTextFormat2.Snippet,documentation:""})}getLabelForSnippetValue(e){return JSON.stringify(e).replace(/\$\{\d+:([^}]+)\}|\$\d+/g,"$1")}getCustomTagValueCompletions(e){filterInvalidCustomTags(this.customTags).forEach((t=>{const r=t.split(" ")[0];this.addCustomTagValueCompletion(e," ",r)}))}addCustomTagValueCompletion(e,t,r){e.add({kind:this.getSuggestionKind("string"),label:r,insertText:r+t,insertTextFormat:InsertTextFormat2.Snippet,documentation:""})}getDocumentationWithMarkdownText(e,t){let r=e;return this.doesSupportMarkdown()&&(t=t.replace(/\${[0-9]+[:|](.*)}/g,((e,t)=>t)).replace(/\$([0-9]+)/g,""),r=this.fromMarkup(`${e}\n \`\`\`\n${t}\n\`\`\``)),r}getSuggestionKind(e){if(Array.isArray(e)){const t=e;e=t.length>0?t[0]:null}if(!e)return CompletionItemKind2.Value;switch(e){case"string":default:return CompletionItemKind2.Value;case"object":return CompletionItemKind2.Module;case"property":return CompletionItemKind2.Property}}getCurrentWord(e,t){let r=t-1;const n=e.getText();for(;r>=0&&-1===' \t\n\r\v":{[,]}'.indexOf(n.charAt(r));)r--;return n.substring(r+1,t)}fromMarkup(e){if(e&&this.doesSupportMarkdown())return{kind:MarkupKind3.Markdown,value:e}}doesSupportMarkdown(){if(void 0===this.supportsMarkdown){const e=this.clientCapabilities.textDocument&&this.clientCapabilities.textDocument.completion;this.supportsMarkdown=e&&e.completionItem&&Array.isArray(e.completionItem.documentationFormat)&&-1!==e.completionItem.documentationFormat.indexOf(MarkupKind3.Markdown)}return this.supportsMarkdown}findItemAtOffset(e,t,r){for(let t=e.items.length-1;t>=0;t--){const n=e.items[t];if(isNode4(n)&&n.range){if(r>n.range[1])return t;if(r>=n.range[0])return t}}return 0}},isNumberExp=/^\d+$/;function convertToStringValue(e){let t;if(t="string"==typeof e?e:""+e,0===t.length)return t;if("true"===t||"false"===t||"null"===t||isNumberExp.test(t))return`"${t}"`;-1!==t.indexOf('"')&&(t=t.replace(doubleQuotesEscapeRegExp,'"'));let r=!isNaN(parseInt(t))||"@"===t.charAt(0);if(!r){let e=t.indexOf(":",0);for(;e>0&&e<t.length;e=t.indexOf(":",e+1)){if(e===t.length-1){r=!0;break}const n=t.charAt(e+1);if("\t"===n||" "===n){r=!0;break}}}return r&&(t=`"${t}"`),t}function evaluateTab1Symbol(e){return e.replace(/\$\{1:(.*)\}/,"$1")}function isParentCompletionItem(e){return"parent"in e}function JSONSchemaSelection(){}import{LocationLink,Range as Range14}from"vscode-languageserver-types";import{isAlias as isAlias3}from"yaml";var SchemaPriority,YamlDefinition=class{constructor(e){this.telemetry=e}getDefinition(e,t){var r;try{const r=yamlDocumentsCache.getYamlDocument(e),n=e.offsetAt(t.position),i=matchOffsetToDocument(n,r);if(i){const[t]=i.getNodeFromPosition(n,new TextBuffer(e));if(t&&isAlias3(t)){const r=t.resolve(i.internalDocument);if(r&&r.range){const t=Range14.create(e.positionAt(r.range[0]),e.positionAt(r.range[2])),n=Range14.create(e.positionAt(r.range[0]),e.positionAt(r.range[1]));return[LocationLink.create(e.uri,t,n)]}}}}catch(e){null==(r=this.telemetry)||r.sendError("yaml.definition.error",{error:convertErrorToTelemetryMsg(e)})}}};import{SelectionRange as SelectionRange2}from"vscode-languageserver-types";function getSelectionRanges2(e,t){if(!e)return;const r=yamlDocumentsCache.getYamlDocument(e);return t.map((t=>{const n=function(t){const n=e.offsetAt(t),i=[];for(const o of r.documents){let r,s,a=!0;for(o.visit((i=>{if(i.offset+i.length<n)return!0;let o=i.offset;if(o>n){const r=e.positionAt(o);if(r.line!==t.line)return!0;const i={line:r.line,character:0};if(0!==e.getText({start:i,end:r}).trim().length)return!0;if(o=e.offsetAt(i),o>n)return!0}return(!r||o>=r.offset)&&(r=i,s=o),!0}));r;){const t=a?s:r.offset,n=r.offset+r.length,o={start:e.positionAt(t),end:e.positionAt(n)},l=e.getText(o),c=l.trimEnd(),u=l.length-c.length;u>0&&(o.end=e.positionAt(n-u));const m=(e,t)=>c.startsWith(e)&&c.endsWith(t||e);("string"===r.type&&(m("'")||m('"'))||"object"===r.type&&m("{","}")||"array"===r.type&&m("[","]"))&&i.push({start:e.positionAt(t+1),end:e.positionAt(n-1)}),i.push(o),r=r.parent,a=!1}if(i.length>0)break}return i.reverse()}(t);let i;for(const e of n)i=SelectionRange2.create(e,i);return i||(i=SelectionRange2.create({start:t,end:t})),i}))}function getLanguageService(e){const t=new YAMLSchemaService(e.schemaRequestService,e.workspaceContext),r=new YamlCompletion(t,e.clientCapabilities,yamlDocumentsCache,e.telemetry),n=new YAMLHover(t,e.telemetry),i=new YAMLDocumentSymbols(t,e.telemetry),o=new YAMLValidation(t,e.telemetry),s=new YAMLFormatter,a=new YamlCodeActions(e.clientCapabilities),l=new YamlCodeLens(t,e.telemetry),c=new YamlLinks(e.telemetry),u=new YamlDefinition(e.telemetry);return new JSONSchemaSelection(t,e.yamlSettings,e.connection),{configure:e=>{t.clearExternalSchemas(),e.schemas&&(t.schemaPriorityMapping=new Map,e.schemas.forEach((e=>{const r=e.priority?e.priority:0;t.addSchemaPriority(e.uri,r),t.registerExternalSchema(e.uri,e.fileMatch,e.schema,e.name,e.description,e.versions)}))),o.configure(e),n.configure(e),r.configure(e),s.configure(e),a.configure(e)},registerCustomSchemaProvider:e=>{t.registerCustomSchemaProvider(e)},findLinks:c.findLinks.bind(c),doComplete:r.doComplete.bind(r),doValidation:o.doValidation.bind(o),doHover:n.doHover.bind(n),findDocumentSymbols:i.findDocumentSymbols.bind(i),findDocumentSymbols2:i.findHierarchicalDocumentSymbols.bind(i),doDefinition:u.getDefinition.bind(u),resetSchema:e=>t.onResourceChange(e),doFormat:s.format.bind(s),doDocumentOnTypeFormatting:doDocumentOnTypeFormatting,addSchema:(e,r)=>t.saveSchema(e,r),deleteSchema:e=>t.deleteSchema(e),modifySchemaContent:e=>t.addContent(e),deleteSchemaContent:e=>t.deleteContent(e),deleteSchemasWhole:e=>t.deleteSchemas(e),getFoldingRanges:getFoldingRanges2,getSelectionRanges:getSelectionRanges2,getCodeAction:(e,t)=>a.getCodeAction(e,t),getCodeLens:e=>l.getCodeLens(e),resolveCodeLens:e=>l.resolveCodeLens(e)}}async function schemaRequestService(e){const t=await fetch(e);if(t.ok)return t.text();throw new Error(`Schema request failed for ${e}`)}!function(e){e[e.SchemaStore=1]="SchemaStore",e[e.SchemaAssociation=2]="SchemaAssociation",e[e.Settings=3]="Settings"}(SchemaPriority||(SchemaPriority={}));var telemetry={send(){},sendError(e,t){console.error("monaco-yaml",e,t)},sendTrack(){}},workspaceContext={resolveRelativePath:(e,t)=>String(new URL(e,t))};initialize(((e,{enableSchemaRequest:t,...r})=>{const n=getLanguageService({schemaRequestService:t?schemaRequestService:null,telemetry:telemetry,workspaceContext:workspaceContext}),i=t=>(r,...n)=>{const i=e.getMirrorModels();for(const e of i)if(String(e.uri)===r)return t(TextDocument2.create(r,"yaml",e.version,e.getValue()),...n)};return n.configure(r),{doValidation:i((e=>n.doValidation(e,Boolean(r.isKubernetes)))),doComplete:i(((e,t)=>n.doComplete(e,t,Boolean(r.isKubernetes)))),doDefinition:i(((e,t)=>n.doDefinition(e,{position:t,textDocument:e}))),doHover:i(((e,t)=>n.doHover(e,t))),format:i((e=>n.doFormat(e,{}))),resetSchema:e=>n.resetSchema(e),findDocumentSymbols:i((e=>n.findDocumentSymbols2(e,{}))),findLinks:i((e=>n.findLinks(e))),getCodeAction:i(((e,t,r)=>n.getCodeAction(e,{range:t,textDocument:e,context:r}))),getFoldingRanges:i((e=>n.getFoldingRanges(e,{lineFoldingOnly:!0})))}}));
//# sourceMappingURL=/sm/fda78ce1ae0d02ac72966fa37b5e6c2cdd9d378701c5d87fd095a7da153b1d0d.map